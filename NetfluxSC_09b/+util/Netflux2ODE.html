<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of Netflux2ODE</title>
  <meta name="keywords" content="Netflux2ODE">
  <meta name="description" content="Generates the system of differential equations">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">NetfluxSC_09b</a> &gt; <a href="index.html">+util</a> &gt; Netflux2ODE.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for NetfluxSC_09b\+util&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>Netflux2ODE
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>Generates the system of differential equations</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [paramList,ODElist,CNAerror] = Netflux2ODE(cnamodel,xlsfilename) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Generates the system of differential equations

   NETFLUX2ODE takes the cnamodel structure generated by xls2Netflux and
   generates the system of normalized Hill differential equations. Outputs
   ODElist and paramList are send to ODE to solve. Version 0.08a
   08/30/2011 by JJS</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function reactions = calcReactions(interMat,notMat,speciesNames)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [paramList,ODElist,CNAerror] = Netflux2ODE(cnamodel,xlsfilename)</a>
0002 <span class="comment">% Generates the system of differential equations</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%   NETFLUX2ODE takes the cnamodel structure generated by xls2Netflux and</span>
0005 <span class="comment">%   generates the system of normalized Hill differential equations. Outputs</span>
0006 <span class="comment">%   ODElist and paramList are send to ODE to solve. Version 0.08a</span>
0007 <span class="comment">%   08/30/2011 by JJS</span>
0008 
0009 <span class="comment">%% pull in info from cnamodel</span>
0010 interMat = cnamodel.interMat;
0011 notMat = cnamodel.notMat;
0012 cnaspecies = cnamodel.specID;
0013 modelname = cnamodel.net_var_name;
0014 
0015 speciesNames = strtrim(mat2cell(cnaspecies,ones(size(cnaspecies,1),1),size(cnaspecies,2)));   <span class="comment">% store species as a cell array</span>
0016 numspecies = size(interMat,1);
0017 numrxns = size(interMat,2);
0018 
0019 <span class="comment">%% read parameters from Excel file;</span>
0020 [paramList, CNAerror] = util.getNetfluxParams(xlsfilename);
0021 
0022 <span class="comment">%% Create ODElist, a cell array of strings containing the ODEs</span>
0023 reactions = <a href="#_sub1" class="code" title="subfunction reactions = calcReactions(interMat,notMat,speciesNames)">calcReactions</a>(interMat,notMat,speciesNames);
0024 mapVar = cell(numspecies,1);
0025 <span class="keyword">for</span> i = 1:numspecies
0026     mapVar{i} = sprintf(<span class="string">'%s = %d;'</span>,speciesNames{i},i);
0027 <span class="keyword">end</span>
0028 ODEList = cell(numspecies+1,1);
0029 ODEList{1} = sprintf(<span class="string">'dydt = zeros(%i,1);'</span>,numspecies); <span class="comment">%Create matrix of Strings with Differential Equations</span>
0030 
0031 <span class="comment">%Create matrix of Strings with Differential Equations</span>
0032 <span class="keyword">for</span> i=1:numspecies
0033     s = speciesNames{i};
0034     <span class="keyword">if</span> (exist(<span class="string">'ymaxTxt'</span>) &amp;&amp; isnan(ymax(i)) ),   <span class="comment">% ymax specified as text instead of #</span>
0035         ymaxStr = ymaxTxt{i};
0036     <span class="keyword">else</span>
0037         ymaxStr = [<span class="string">'ymax('</span> s <span class="string">')'</span>];
0038     <span class="keyword">end</span>
0039     ODEList{i+1} = sprintf(<span class="string">'dydt(%s) = (%s*%s - y(%s))/tau(%s);'</span>,s,reactions{i},ymaxStr,s,s);
0040 <span class="keyword">end</span>
0041 ODElist = vertcat(mapVar,ODEList);
0042 
0043 <span class="comment">%% function calcReactions</span>
0044 <a name="_sub1" href="#_subfunctions" class="code">function reactions = calcReactions(interMat,notMat,speciesNames)</a>
0045 numspecies = size(interMat,1);
0046 numrxns = size(interMat,2);
0047 
0048 <span class="comment">% generate reaction strings for each reaction of the form: act(y(A),rpar(:,1))</span>
0049 <span class="keyword">for</span> i = 1:numrxns
0050     reactants = find(interMat(:,i)==-1);
0051     <span class="keyword">if</span> isempty(reactants),                  <span class="comment">% input reaction, of the form: rpar(1,3)</span>
0052         str = [<span class="string">'rpar(1,'</span> num2str(i) <span class="string">')'</span>];
0053     <span class="keyword">elseif</span> length(reactants)==1,            <span class="comment">% single reactant, of the form: act(y(A),rpar(:,1))</span>
0054         <span class="keyword">if</span> notMat(reactants,i) == 0
0055             str = [<span class="string">'inhib(y('</span> speciesNames{reactants} <span class="string">'),rpar(:,'</span>,num2str(i),<span class="string">'))'</span>];
0056         <span class="keyword">else</span>
0057             str = [<span class="string">'act(y('</span> speciesNames{reactants} <span class="string">'),rpar(:,'</span>,num2str(i),<span class="string">'))'</span>];
0058         <span class="keyword">end</span>
0059     <span class="keyword">else</span>,                                   <span class="comment">% multiple reactants, of the form: AND(rpar(:,5),act(y(A),rpar(:,5)),inhib(y(B),rpar(:,5))</span>
0060         str = [<span class="string">'AND(rpar(:,'</span>,num2str(i),<span class="string">'),'</span>];
0061         <span class="keyword">for</span> j = 1:length(reactants)         <span class="comment">% loop over each reactant</span>
0062             <span class="keyword">if</span> notMat(reactants(j),i) == 0
0063                 str = [str <span class="string">'inhib(y('</span> speciesNames{reactants(j)} <span class="string">'),rpar(:,'</span>,num2str(i),<span class="string">'))'</span>];
0064             <span class="keyword">else</span>
0065                 str = [str <span class="string">'act(y('</span> speciesNames{reactants(j)} <span class="string">'),rpar(:,'</span>,num2str(i),<span class="string">'))'</span>];
0066             <span class="keyword">end</span>
0067             <span class="keyword">if</span> j&lt;length(reactants), <span class="comment">% more reactants to come</span>
0068                 str = [str <span class="string">','</span>];
0069             <span class="keyword">end</span>
0070         <span class="keyword">end</span>
0071         str = [str <span class="string">')'</span>]; <span class="comment">% cap with close parentheses</span>
0072     <span class="keyword">end</span>
0073     rxnString{i} = str;
0074 <span class="keyword">end</span>
0075 
0076 <span class="comment">% combine relevant reactions for each species, using nested ORs if needed</span>
0077 <span class="keyword">for</span> i=1:numspecies
0078     rxnList = find(interMat(i,:)==1);  <span class="comment">% find reactions that affect specie 'i'</span>
0079     <span class="keyword">if</span> isempty(rxnList)              <span class="comment">% 0 reactions for that specie</span>
0080         reactions{i} = <span class="string">'0'</span>;
0081     <span class="keyword">elseif</span> length(rxnList)==1,         <span class="comment">% 1 reaction for that specie</span>
0082         reactions{i} = rxnString{rxnList};
0083     <span class="keyword">elseif</span> length(rxnList)&gt;1           <span class="comment">% combine reactions with nested 'OR's</span>
0084         str = <span class="string">''</span>;
0085         <span class="keyword">for</span> j = 1:length(rxnList)-1
0086             str = [str <span class="string">'OR('</span> rxnString{rxnList(j)} <span class="string">','</span>];
0087         <span class="keyword">end</span>
0088         str = [str rxnString{rxnList(end)} repmat(<span class="string">')'</span>,1,j)];
0089         reactions{i} = str;
0090     <span class="keyword">end</span>
0091 <span class="keyword">end</span>
0092</pre></div>
<hr><address>Generated on Thu 07-Aug-2014 13:40:59 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>