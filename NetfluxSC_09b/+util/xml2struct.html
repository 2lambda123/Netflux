<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of xml2struct</title>
  <meta name="keywords" content="xml2struct">
  <meta name="description" content="Convert xml file into a MATLAB structure">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">NetfluxSC_09b</a> &gt; <a href="index.html">+util</a> &gt; xml2struct.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for NetfluxSC_09b\+util&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>xml2struct
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>Convert xml file into a MATLAB structure</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [ s ] = xml2struct( file ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">Convert xml file into a MATLAB structure
 This function was acquired from the Mathworks File Exchange. 
 [ s ] = xml2struct( file )

 A file containing:
 &lt;XMLname attrib1=&quot;Some value&quot;&gt;
   &lt;Element&gt;Some text&lt;/Element&gt;
   &lt;DifferentElement attrib2=&quot;2&quot;&gt;Some more text&lt;/Element&gt;
   &lt;DifferentElement attrib3=&quot;2&quot; attrib4=&quot;1&quot;&gt;Even more text&lt;/DifferentElement&gt;
 &lt;/XMLname&gt;

 Will produce:
 s.XMLname.Attributes.attrib1 = &quot;Some value&quot;;
 s.XMLname.Element.Text = &quot;Some text&quot;;
 s.XMLname.DifferentElement{1}.Attributes.attrib2 = &quot;2&quot;;
 s.XMLname.DifferentElement{1}.Text = &quot;Some more text&quot;;
 s.XMLname.DifferentElement{2}.Attributes.attrib3 = &quot;2&quot;;
 s.XMLname.DifferentElement{2}.Attributes.attrib4 = &quot;1&quot;;
 s.XMLname.DifferentElement{2}.Text = &quot;Even more text&quot;;

 Please note that the following characters are substituted
 '-' by '_dash_', ':' by '_colon_' and '.' by '_dot_'

 Written by W. Falkena, ASTI, TUDelft, 21-08-2010
 Attribute parsing speed increased by 40% by A. Wanner, 14-6-2011
 Added CDATA support by I. Smirnov, 20-3-2012

 Modified by X. Mo, University of Wisconsin, 12-5-2012</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="xml2struct.html" class="code" title="function [ s ] = xml2struct( file )">xml2struct</a>	Convert xml file into a MATLAB structure</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="xml2struct.html" class="code" title="function [ s ] = xml2struct( file )">xml2struct</a>	Convert xml file into a MATLAB structure</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [children,ptext,textflag] = parseChildNodes(theNode)</a></li><li><a href="#_sub2" class="code">function [text,name,attr,childs,textflag] = getNodeData(theNode)</a></li><li><a href="#_sub3" class="code">function attributes = parseAttributes(theNode)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [ s ] = xml2struct( file )</a>
0002 <span class="comment">%Convert xml file into a MATLAB structure</span>
0003 <span class="comment">% This function was acquired from the Mathworks File Exchange.</span>
0004 <span class="comment">% [ s ] = xml2struct( file )</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% A file containing:</span>
0007 <span class="comment">% &lt;XMLname attrib1=&quot;Some value&quot;&gt;</span>
0008 <span class="comment">%   &lt;Element&gt;Some text&lt;/Element&gt;</span>
0009 <span class="comment">%   &lt;DifferentElement attrib2=&quot;2&quot;&gt;Some more text&lt;/Element&gt;</span>
0010 <span class="comment">%   &lt;DifferentElement attrib3=&quot;2&quot; attrib4=&quot;1&quot;&gt;Even more text&lt;/DifferentElement&gt;</span>
0011 <span class="comment">% &lt;/XMLname&gt;</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% Will produce:</span>
0014 <span class="comment">% s.XMLname.Attributes.attrib1 = &quot;Some value&quot;;</span>
0015 <span class="comment">% s.XMLname.Element.Text = &quot;Some text&quot;;</span>
0016 <span class="comment">% s.XMLname.DifferentElement{1}.Attributes.attrib2 = &quot;2&quot;;</span>
0017 <span class="comment">% s.XMLname.DifferentElement{1}.Text = &quot;Some more text&quot;;</span>
0018 <span class="comment">% s.XMLname.DifferentElement{2}.Attributes.attrib3 = &quot;2&quot;;</span>
0019 <span class="comment">% s.XMLname.DifferentElement{2}.Attributes.attrib4 = &quot;1&quot;;</span>
0020 <span class="comment">% s.XMLname.DifferentElement{2}.Text = &quot;Even more text&quot;;</span>
0021 <span class="comment">%</span>
0022 <span class="comment">% Please note that the following characters are substituted</span>
0023 <span class="comment">% '-' by '_dash_', ':' by '_colon_' and '.' by '_dot_'</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% Written by W. Falkena, ASTI, TUDelft, 21-08-2010</span>
0026 <span class="comment">% Attribute parsing speed increased by 40% by A. Wanner, 14-6-2011</span>
0027 <span class="comment">% Added CDATA support by I. Smirnov, 20-3-2012</span>
0028 <span class="comment">%</span>
0029 <span class="comment">% Modified by X. Mo, University of Wisconsin, 12-5-2012</span>
0030 
0031     <span class="keyword">if</span> (nargin &lt; 1)
0032         clc;
0033         help <a href="xml2struct.html" class="code" title="function [ s ] = xml2struct( file )">xml2struct</a>
0034         <span class="keyword">return</span>
0035     <span class="keyword">end</span>
0036     
0037     <span class="keyword">if</span> isa(file, <span class="string">'org.apache.xerces.dom.DeferredDocumentImpl'</span>) || isa(file, <span class="string">'org.apache.xerces.dom.DeferredElementImpl'</span>)
0038         <span class="comment">% input is a java xml object</span>
0039         xDoc = file;
0040     <span class="keyword">else</span>
0041         <span class="comment">%check for existance</span>
0042         <span class="keyword">if</span> (exist(file,<span class="string">'file'</span>) == 0)
0043             <span class="comment">%Perhaps the xml extension was omitted from the file name. Add the</span>
0044             <span class="comment">%extension and try again.</span>
0045             <span class="keyword">if</span> (isempty(strfind(file,<span class="string">'.xml'</span>)))
0046                 file = [file <span class="string">'.xml'</span>];
0047             <span class="keyword">end</span>
0048             
0049             <span class="keyword">if</span> (exist(file,<span class="string">'file'</span>) == 0)
0050                 error([<span class="string">'The file '</span> file <span class="string">' could not be found'</span>]);
0051             <span class="keyword">end</span>
0052         <span class="keyword">end</span>
0053         <span class="comment">%read the xml file</span>
0054         xDoc = xmlread(file);
0055     <span class="keyword">end</span>
0056     
0057     <span class="comment">%parse xDoc into a MATLAB structure</span>
0058     s = <a href="#_sub1" class="code" title="subfunction [children,ptext,textflag] = parseChildNodes(theNode)">parseChildNodes</a>(xDoc);
0059     
0060 <span class="keyword">end</span>
0061 
0062 <span class="comment">% ----- Subfunction parseChildNodes -----</span>
0063 <a name="_sub1" href="#_subfunctions" class="code">function [children,ptext,textflag] = parseChildNodes(theNode)</a>
0064     <span class="comment">% Recurse over node children.</span>
0065     children = struct;
0066     ptext = struct; textflag = <span class="string">'Text'</span>;
0067     <span class="keyword">if</span> hasChildNodes(theNode)
0068         childNodes = getChildNodes(theNode);
0069         numChildNodes = getLength(childNodes);
0070 
0071         <span class="keyword">for</span> count = 1:numChildNodes
0072             theChild = item(childNodes,count-1);
0073             [text,name,attr,childs,textflag] = <a href="#_sub2" class="code" title="subfunction [text,name,attr,childs,textflag] = getNodeData(theNode)">getNodeData</a>(theChild);
0074             
0075             <span class="keyword">if</span> (~strcmp(name,<span class="string">'#text'</span>) &amp;&amp; ~strcmp(name,<span class="string">'#comment'</span>) &amp;&amp; ~strcmp(name,<span class="string">'#cdata_dash_section'</span>))
0076                 <span class="comment">%XML allows the same elements to be defined multiple times,</span>
0077                 <span class="comment">%put each in a different cell</span>
0078                 <span class="keyword">if</span> (isfield(children,name))
0079                     <span class="keyword">if</span> (~iscell(children.(name)))
0080                         <span class="comment">%put existsing element into cell format</span>
0081                         children.(name) = {children.(name)};
0082                     <span class="keyword">end</span>
0083                     index = length(children.(name))+1;
0084                     <span class="comment">%add new element</span>
0085                     children.(name){index} = childs;
0086                     <span class="keyword">if</span>(~isempty(fieldnames(text)))
0087                         children.(name){index} = text; 
0088                     <span class="keyword">end</span>
0089                     <span class="keyword">if</span>(~isempty(attr)) 
0090                         children.(name){index}.(<span class="string">'Attributes'</span>) = attr; 
0091                     <span class="keyword">end</span>
0092                 <span class="keyword">else</span>
0093                     <span class="comment">%add previously unknown (new) element to the structure</span>
0094                     children.(name) = childs;
0095                     <span class="keyword">if</span>(~isempty(text) &amp;&amp; ~isempty(fieldnames(text)))
0096                         children.(name) = text; 
0097                     <span class="keyword">end</span>
0098                     <span class="keyword">if</span>(~isempty(attr)) 
0099                         children.(name).(<span class="string">'Attributes'</span>) = attr; 
0100                     <span class="keyword">end</span>
0101                 <span class="keyword">end</span>
0102             <span class="keyword">else</span>
0103                 ptextflag = <span class="string">'Text'</span>;
0104                 <span class="keyword">if</span> (strcmp(name, <span class="string">'#cdata_dash_section'</span>))
0105                     ptextflag = <span class="string">'CDATA'</span>;
0106                 <span class="keyword">elseif</span> (strcmp(name, <span class="string">'#comment'</span>))
0107                     ptextflag = <span class="string">'Comment'</span>;
0108                 <span class="keyword">end</span>
0109                 
0110                 <span class="comment">%this is the text in an element (i.e., the parentNode)</span>
0111                 <span class="keyword">if</span> (~isempty(regexprep(text.(textflag),<span class="string">'[\s]*'</span>,<span class="string">''</span>)))
0112                     <span class="keyword">if</span> (~isfield(ptext,ptextflag) || isempty(ptext.(ptextflag)))
0113                         ptext.(ptextflag) = text.(textflag);
0114                     <span class="keyword">else</span>
0115                         <span class="comment">%what to do when element data is as follows:</span>
0116                         <span class="comment">%&lt;element&gt;Text &lt;!--Comment--&gt; More text&lt;/element&gt;</span>
0117                         
0118                         <span class="comment">%put the text in different cells:</span>
0119                         <span class="comment">% if (~iscell(ptext)) ptext = {ptext}; end</span>
0120                         <span class="comment">% ptext{length(ptext)+1} = text;</span>
0121                         
0122                         <span class="comment">%just append the text</span>
0123                         ptext.(ptextflag) = [ptext.(ptextflag) text.(textflag)];
0124                     <span class="keyword">end</span>
0125                 <span class="keyword">end</span>
0126             <span class="keyword">end</span>
0127             
0128         <span class="keyword">end</span>
0129     <span class="keyword">end</span>
0130 <span class="keyword">end</span>
0131 
0132 <span class="comment">% ----- Subfunction getNodeData -----</span>
0133 <a name="_sub2" href="#_subfunctions" class="code">function [text,name,attr,childs,textflag] = getNodeData(theNode)</a>
0134     <span class="comment">% Create structure of node info.</span>
0135     
0136     <span class="comment">%make sure name is allowed as structure name</span>
0137     name = toCharArray(getNodeName(theNode))';
0138     name = strrep(name, <span class="string">'-'</span>, <span class="string">'_dash_'</span>);
0139     name = strrep(name, <span class="string">':'</span>, <span class="string">'_colon_'</span>);
0140     name = strrep(name, <span class="string">'.'</span>, <span class="string">'_dot_'</span>);
0141 
0142     attr = <a href="#_sub3" class="code" title="subfunction attributes = parseAttributes(theNode)">parseAttributes</a>(theNode);
0143     <span class="keyword">if</span> (isempty(fieldnames(attr))) 
0144         attr = []; 
0145     <span class="keyword">end</span>
0146     
0147     <span class="comment">%parse child nodes</span>
0148     [childs,text,textflag] = <a href="#_sub1" class="code" title="subfunction [children,ptext,textflag] = parseChildNodes(theNode)">parseChildNodes</a>(theNode);
0149     
0150     <span class="keyword">if</span> (isempty(fieldnames(childs)) &amp;&amp; isempty(fieldnames(text)))
0151         <span class="comment">%get the data of any childless nodes</span>
0152         <span class="comment">% faster than if any(strcmp(methods(theNode), 'getData'))</span>
0153         <span class="comment">% no need to try-catch (?)</span>
0154         <span class="comment">% faster than text = char(getData(theNode));</span>
0155         text.(textflag) = toCharArray(getTextContent(theNode))';
0156     <span class="keyword">end</span>
0157     
0158 <span class="keyword">end</span>
0159 
0160 <span class="comment">% ----- Subfunction parseAttributes -----</span>
0161 <a name="_sub3" href="#_subfunctions" class="code">function attributes = parseAttributes(theNode)</a>
0162     <span class="comment">% Create attributes structure.</span>
0163 
0164     attributes = struct;
0165     <span class="keyword">if</span> hasAttributes(theNode)
0166        theAttributes = getAttributes(theNode);
0167        numAttributes = getLength(theAttributes);
0168 
0169        <span class="keyword">for</span> count = 1:numAttributes
0170             <span class="comment">%attrib = item(theAttributes,count-1);</span>
0171             <span class="comment">%attr_name = regexprep(char(getName(attrib)),'[-:.]','_');</span>
0172             <span class="comment">%attributes.(attr_name) = char(getValue(attrib));</span>
0173 
0174             <span class="comment">%Suggestion of Adrian Wanner</span>
0175             str = toCharArray(toString(item(theAttributes,count-1)))';
0176             k = strfind(str,<span class="string">'='</span>); 
0177             attr_name = str(1:(k(1)-1));
0178             attr_name = strrep(attr_name, <span class="string">'-'</span>, <span class="string">'_dash_'</span>);
0179             attr_name = strrep(attr_name, <span class="string">':'</span>, <span class="string">'_colon_'</span>);
0180             attr_name = strrep(attr_name, <span class="string">'.'</span>, <span class="string">'_dot_'</span>);
0181             attributes.(attr_name) = str((k(1)+2):(end-1));
0182        <span class="keyword">end</span>
0183     <span class="keyword">end</span>
0184 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 07-Aug-2014 13:40:59 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>