<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of findjobj</title>
  <meta name="keywords" content="findjobj">
  <meta name="description" content="findjobj Find java objects contained within a specified java container or Matlab GUI handle">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">NetfluxSC_09b</a> &gt; <a href="index.html">+util</a> &gt; findjobj.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for NetfluxSC_09b\+util&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>findjobj
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>findjobj Find java objects contained within a specified java container or Matlab GUI handle</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [handles,levels,parentIdx,listing] = findjobj(container,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">findjobj Find java objects contained within a specified java container or Matlab GUI handle

 Syntax:
    [handles, levels, parentIds, listing] = findjobj(container, 'PropName',PropValue(s), ...)

 Input parameters:
    container - optional handle to java container uipanel or figure. If unsupplied then current figure will be used
    'PropName',PropValue - optional list of property pairs (case insensitive). PropName may also be named -PropName
         'position' - filter results based on those elements that contain the specified X,Y position or a java element
                      Note: specify a Matlab position (X,Y = pixels from bottom left corner), not a java one
         'size'     - filter results based on those elements that have the specified W,H (in pixels)
         'class'    - filter results based on those elements that contain the substring  (or java class) PropValue
                      Note1: filtering is case insensitive and relies on regexp, so you can pass wildcards etc.
                      Note2: '-class' is an undocumented findobj PropName, but only works on Matlab (not java) classes
         'property' - filter results based on those elements that possess the specified case-insensitive property string
                      Note1: passing a property value is possible if the argument following 'property' is a cell in the
                             format of {'propName','propValue'}. Example: FINDJOBJ(...,'property',{'Text','click me'})
                      Note2: partial property names (e.g. 'Tex') are accepted, as long as they're not ambiguous
         'depth'    - filter results based on specified depth. 0=top-level, Inf=all levels (default=Inf)
         'flat'     - same as specifying: 'depth',0
         'not'      - negates the following filter: 'not','class','c' returns all elements EXCEPT those with class 'c'
         'persist'  - persist figure components information, allowing much faster results for subsequent invocations
         'nomenu'   - skip menu processing, for &quot;lean&quot; list of handles &amp; much faster processing;
                      This option is the default for HG containers but not for figure, Java or no container
         'print'    - display all java elements in a hierarchical list, indented appropriately
                      Note1: optional PropValue of element index or handle to java container
                      Note2: normally this option would be placed last, after all filtering is complete. Placing this
                             option before some filters enables debug print-outs of interim filtering results.
                      Note3: output is to the Matlab command window unless the 'listing' (4th) output arg is requested
         'list'     - same as 'print'
         'debug'    - list found component positions in the Command Window

 Output parameters:
    handles   - list of handles to java elements
    levels    - list of corresponding hierarchy level of the java elements (top=0)
    parentIds - list of indexes (in unfiltered handles) of the parent container of the corresponding java element
    listing   - results of 'print'/'list' options (empty if these options were not specified)

    Note: If no output parameter is specified, then an interactive window will be displayed with a
    ^^^^  tree view of all container components, their properties and callbacks.

 Examples:
    findjobj;                     % display list of all javaelements of currrent figure in an interactive GUI
    handles = findjobj;           % get list of all java elements of current figure (inc. menus, toolbars etc.)
    findjobj('print');            % list all java elements in current figure
    findjobj('print',6);          % list all java elements in current figure, contained within its 6th element
    handles = findjobj(hButton);                                     % hButton is a matlab button
    handles = findjobj(gcf,'position',getpixelposition(hButton,1));  % same as above but also return hButton's panel
    handles = findjobj(hButton,'persist');                           % same as above, persist info for future reuse
    handles = findjobj('class','pushbutton');                        % get all pushbuttons in current figure
    handles = findjobj('class','pushbutton','position',123,456);     % get all pushbuttons at the specified position
    handles = findjobj(gcf,'class','pushbutton','size',23,15);       % get all pushbuttons with the specified size
    handles = findjobj('property','Text','not','class','button');    % get all non-button elements with 'text' property
    handles = findjobj('-property',{'Text','click me'});             % get all elements with 'text' property = 'click me'

 Sample usage:
    hButton = uicontrol('string','click me');
    jButton = findjobj(hButton,'nomenu');
      % or: jButton = findjobj('property',{'Text','click me'});
    jButton.setFlyOverAppearance(1);
    jButton.setCursor(java.awt.Cursor.getPredefinedCursor(java.awt.Cursor.HAND_CURSOR));
    set(jButton,'FocusGainedCallback',@myMatlabFunction);   % some 30 callback points available...
    jButton.get;   % list all changeable properties...

    hEditbox = uicontrol('style',edit');
    jEditbox = findjobj(hEditbox,'nomenu');
    jEditbox.setCaretColor(java.awt.Color.red);
    jEditbox.KeyTypedCallback = @myCallbackFunc;  % many more callbacks where this came from...
    jEdit.requestFocus;

 Known issues/limitations:
    - Cannot currently process multiple container objects - just one at a time
    - Initial processing is a bit slow when the figure is laden with many UI components (so better use 'persist')
    - Passing a simple container Matlab handle is currently filtered by its position+size: should find a better way to do this
    - Matlab uipanels are not implemented as simple java panels, and so they can't be found using this utility
    - Labels have a write-only text property in java, so they can't be found using the 'property',{'Text','string'} notation

 Warning:
    This code heavily relies on undocumented and unsupported Matlab functionality.
    It works on Matlab 7+, but use at your own risk!

 Bugs and suggestions:
    Please send to Yair Altman (altmany at gmail dot com)

 Change log:
    2010-04-21: Minor fix to support combo-boxes (aka drop-down, popup-menu) on Windows
    2010-03-17: Important release: Fixes for R2010a, debug listing, objects not found, component containers that should be ignored etc.
    2010-02-04: Forced an EDT redraw before processing; warned if requested handle is invisible
    2010-01-18: Found a way to display label text next to the relevant node name
    2009-10-28: Fixed uitreenode warning
    2009-10-27: Fixed auto-collapse of invisible container nodes; added dynamic tree tooltips &amp; context-menu; minor fix to version-check display
    2009-09-30: Fix for Matlab 7.0 as suggested by Oliver W; minor GUI fix (classname font)
    2009-08-07: Fixed edge-case of missing JIDE tables
    2009-05-24: Added support for future Matlab versions that will not support JavaFrame
    2009-05-15: Added sanity checks for axes items
    2009-04-28: Added 'debug' input arg; increased size tolerance 1px =&gt; 2px
    2009-04-23: Fixed location of popupmenus (always 20px high despite what's reported by Matlab...); fixed uiinspect processing issues; added blog link; narrower action buttons
    2009-04-09: Automatic 'nomenu' for uicontrol inputs; significant performance improvement
    2009-03-31: Fixed position of some Java components; fixed properties tooltip; fixed node visibility indication
    2009-02-26: Indicated components visibility (&amp; auto-collapse non-visible containers); auto-highlight selected component; fixes in node icons, figure title &amp; tree refresh; improved error handling; display FindJObj version update description if available
    2009-02-24: Fixed update check; added dedicated labels icon
    2009-02-18: Fixed compatibility with old Matlab versions
    2009-02-08: Callbacks table fixes; use uiinspect if available; fix update check according to new FEX website
    2008-12-17: R2008b compatibility
    2008-09-10: Fixed minor bug as per Johnny Smith
    2007-11-14: Fixed edge case problem with class properties tooltip; used existing object icon if available; added checkbox option to hide standard callbacks
    2007-08-15: Fixed object naming relative property priorities; added sanity check for illegal container arg; enabled desktop (0) container; cleaned up warnings about special class objects
    2007-08-03: Fixed minor tagging problems with a few Java sub-classes; displayed UIClassID if text/name/tag is unavailable
    2007-06-15: Fixed problems finding HG components found by J. Wagberg
    2007-05-22: Added 'nomenu' option for improved performance; fixed 'export handles' bug; fixed handle-finding/display bugs; &quot;cleaner&quot; error handling
    2007-04-23: HTMLized classname tooltip; returned top-level figure Frame handle for figure container; fixed callbacks table; auto-checked newer version; fixed Matlab 7.2 compatibility issue; added HG objects tree
    2007-04-19: Fixed edge case of missing figure; displayed tree hierarchy in interactive GUI if no output args; workaround for figure sub-menus invisible unless clicked
    2007-04-04: Improved performance; returned full listing results in 4th output arg; enabled partial property names &amp; property values; automatically filtered out container panels if children also returned; fixed finding sub-menu items
    2007-03-20: First version posted on the MathWorks file exchange: &lt;a href=&quot;http://www.mathworks.com/matlabcentral/fileexchange/loadFile.do?objectId=14317&quot;&gt;http://www.mathworks.com/matlabcentral/fileexchange/loadFile.do?objectId=14317&lt;/a&gt;

 See also:
    java, handle, findobj, findall, javaGetHandles, uiinspect (on the File Exchange)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="findjobj.html" class="code" title="function [handles,levels,parentIdx,listing] = findjobj(container,varargin)">findjobj</a>	findjobj Find java objects contained within a specified java container or Matlab GUI handle</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="findjobj.html" class="code" title="function [handles,levels,parentIdx,listing] = findjobj(container,varargin)">findjobj</a>	findjobj Find java objects contained within a specified java container or Matlab GUI handle</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function warnInvisible</a></li><li><a href="#_sub2" class="code">function [flag,idx] = paramSupplied(paramsList,paramName)</a></li><li><a href="#_sub3" class="code">function curFig = getCurrentFigure</a></li><li><a href="#_sub4" class="code">function [jRootPane,contentSize] = getRootPanel(hFig)</a></li><li><a href="#_sub5" class="code">function traverseContainer(jcontainer,level,parent)</a></li><li><a href="#_sub6" class="code">function xy = getXY(jcontainer)</a></li><li><a href="#_sub7" class="code">function numMenuComponents  = getNumMenuComponents(jcontainer)</a></li><li><a href="#_sub8" class="code">function nodeRemovedFlag = removeDuplicateNode(thisIdx)</a></li><li><a href="#_sub9" class="code">function processArgs(varargin)</a></li><li><a href="#_sub10" class="code">function [varargin,listing] = processPrintArgs(varargin)</a></li><li><a href="#_sub11" class="code">function [varargin,foundIdx] = processPositionArgs(varargin)</a></li><li><a href="#_sub12" class="code">function [varargin,foundIdx] = processSizeArgs(varargin)</a></li><li><a href="#_sub13" class="code">function [varargin,foundIdx] = processClassArgs(varargin)</a></li><li><a href="#_sub14" class="code">function [varargin,foundIdx] = processPropertyArgs(varargin)</a></li><li><a href="#_sub15" class="code">function [varargin,foundIdx] = processDepthArgs(varargin)</a></li><li><a href="#_sub16" class="code">function data = charizeData(data)</a></li><li><a href="#_sub17" class="code">function [cbData, cbHeaders, cbTableEnabled] = getCbsData(obj, stripStdCbsFlag)</a></li><li><a href="#_sub18" class="code">function divLocation = getRalativeDivlocation(jDiv)</a></li><li><a href="#_sub19" class="code">function setTreeNodeIcon(treenode,container)</a></li><li><a href="#_sub20" class="code">function presentObjectTree()</a></li><li><a href="#_sub21" class="code">function resizeImg(varargin)</a></li><li><a href="#_sub22" class="code">function identifiers = disableDbstopError</a></li><li><a href="#_sub23" class="code">function restoreDbstopError(identifiers)</a></li><li><a href="#_sub24" class="code">function expandNode(progressBar, tree, tree_h, parentNode, parentRow)</a></li><li><a href="#_sub25" class="code">function hButton = createJButton(nameStr, handler, toolTipText)</a></li><li><a href="#_sub26" class="code">function flashComponent(jComps,delaySecs,numTimes)</a></li><li><a href="#_sub27" class="code">function nodeSelected(src, evd, tree)</a></li><li><a href="#_sub28" class="code">function result = iff(test,trueVal,falseVal)</a></li><li><a href="#_sub29" class="code">function dataFieldsStr = getPropsHtml(nodeHandle, dataFields)</a></li><li><a href="#_sub30" class="code">function updateNodeTooltip(nodeHandle, uiObject)</a></li><li><a href="#_sub31" class="code">function nodeExpanded(src, evd, tree)</a></li><li><a href="#_sub32" class="code">function iconImage = setIconSize(iconImage)</a></li><li><a href="#_sub33" class="code">function nodes = getChildrenNodes(tree, parentNode, isRootHGNode)</a></li><li><a href="#_sub34" class="code">function [nodeName, nodeTitle] = getNodeName(hndl,charsLimit)</a></li><li><a href="#_sub35" class="code">function evNames = stripStdCbs(evNames)</a></li><li><a href="#_sub36" class="code">function cbHideStdCbs_Callback(src, evd, varargin)</a></li><li><a href="#_sub37" class="code">function btWebsite_Callback(src, evd, varargin)</a></li><li><a href="#_sub38" class="code">function btRefresh_Callback(src, evd, varargin)</a></li><li><a href="#_sub39" class="code">function btExport_Callback(src, evd, varargin)</a></li><li><a href="#_sub40" class="code">function btFocus_Callback(src, evd, varargin)</a></li><li><a href="#_sub41" class="code">function btInspect_Callback(src, evd, varargin)</a></li><li><a href="#_sub42" class="code">function btCheckFex_Callback(src, evd, varargin)</a></li><li><a href="#_sub43" class="code">function checkVersion()</a></li><li><a href="#_sub44" class="code">function object = getTopSelectedObject(jTree, root)</a></li><li><a href="#_sub45" class="code">function tbCallbacksChanged(src, evd)</a></li><li><a href="#_sub46" class="code">function revertCbTableModification(table, modifiedRowIdx, modifiedColIdx, cbName, object, errMsg)</a></li><li><a href="#_sub47" class="code">function labelPositions = getLabelsJavaPos(container)</a></li><li><a href="#_sub48" class="code">function traverseHGContainer(hcontainer,level,parent)</a></li><li><a href="#_sub49" class="code">function dispError</a></li><li><a href="#_sub50" class="code">function flag = ischar(data)</a></li><li><a href="#_sub51" class="code">function jmenu = setTreeContextMenu(obj,node,tree_h)</a></li><li><a href="#_sub52" class="code">function treeMousePressedCallback(hTree, eventData, tree_h)</a></li><li><a href="#_sub53" class="code">function menuRemoveItem(hObj,eventData,jmenu,item)</a></li><li><a href="#_sub54" class="code">function nodeTitleStr = getNodeTitleStr(obj,node)</a></li><li><a href="#_sub55" class="code">function treeMouseMovedCallback(hTree, eventData)</a></li><li><a href="#_sub56" class="code">function requestFocus(hTree, eventData, obj)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [handles,levels,parentIdx,listing] = findjobj(container,varargin)</a>
0002 <span class="comment">%findjobj Find java objects contained within a specified java container or Matlab GUI handle</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Syntax:</span>
0005 <span class="comment">%    [handles, levels, parentIds, listing] = findjobj(container, 'PropName',PropValue(s), ...)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% Input parameters:</span>
0008 <span class="comment">%    container - optional handle to java container uipanel or figure. If unsupplied then current figure will be used</span>
0009 <span class="comment">%    'PropName',PropValue - optional list of property pairs (case insensitive). PropName may also be named -PropName</span>
0010 <span class="comment">%         'position' - filter results based on those elements that contain the specified X,Y position or a java element</span>
0011 <span class="comment">%                      Note: specify a Matlab position (X,Y = pixels from bottom left corner), not a java one</span>
0012 <span class="comment">%         'size'     - filter results based on those elements that have the specified W,H (in pixels)</span>
0013 <span class="comment">%         'class'    - filter results based on those elements that contain the substring  (or java class) PropValue</span>
0014 <span class="comment">%                      Note1: filtering is case insensitive and relies on regexp, so you can pass wildcards etc.</span>
0015 <span class="comment">%                      Note2: '-class' is an undocumented findobj PropName, but only works on Matlab (not java) classes</span>
0016 <span class="comment">%         'property' - filter results based on those elements that possess the specified case-insensitive property string</span>
0017 <span class="comment">%                      Note1: passing a property value is possible if the argument following 'property' is a cell in the</span>
0018 <span class="comment">%                             format of {'propName','propValue'}. Example: FINDJOBJ(...,'property',{'Text','click me'})</span>
0019 <span class="comment">%                      Note2: partial property names (e.g. 'Tex') are accepted, as long as they're not ambiguous</span>
0020 <span class="comment">%         'depth'    - filter results based on specified depth. 0=top-level, Inf=all levels (default=Inf)</span>
0021 <span class="comment">%         'flat'     - same as specifying: 'depth',0</span>
0022 <span class="comment">%         'not'      - negates the following filter: 'not','class','c' returns all elements EXCEPT those with class 'c'</span>
0023 <span class="comment">%         'persist'  - persist figure components information, allowing much faster results for subsequent invocations</span>
0024 <span class="comment">%         'nomenu'   - skip menu processing, for &quot;lean&quot; list of handles &amp; much faster processing;</span>
0025 <span class="comment">%                      This option is the default for HG containers but not for figure, Java or no container</span>
0026 <span class="comment">%         'print'    - display all java elements in a hierarchical list, indented appropriately</span>
0027 <span class="comment">%                      Note1: optional PropValue of element index or handle to java container</span>
0028 <span class="comment">%                      Note2: normally this option would be placed last, after all filtering is complete. Placing this</span>
0029 <span class="comment">%                             option before some filters enables debug print-outs of interim filtering results.</span>
0030 <span class="comment">%                      Note3: output is to the Matlab command window unless the 'listing' (4th) output arg is requested</span>
0031 <span class="comment">%         'list'     - same as 'print'</span>
0032 <span class="comment">%         'debug'    - list found component positions in the Command Window</span>
0033 <span class="comment">%</span>
0034 <span class="comment">% Output parameters:</span>
0035 <span class="comment">%    handles   - list of handles to java elements</span>
0036 <span class="comment">%    levels    - list of corresponding hierarchy level of the java elements (top=0)</span>
0037 <span class="comment">%    parentIds - list of indexes (in unfiltered handles) of the parent container of the corresponding java element</span>
0038 <span class="comment">%    listing   - results of 'print'/'list' options (empty if these options were not specified)</span>
0039 <span class="comment">%</span>
0040 <span class="comment">%    Note: If no output parameter is specified, then an interactive window will be displayed with a</span>
0041 <span class="comment">%    ^^^^  tree view of all container components, their properties and callbacks.</span>
0042 <span class="comment">%</span>
0043 <span class="comment">% Examples:</span>
0044 <span class="comment">%    findjobj;                     % display list of all javaelements of currrent figure in an interactive GUI</span>
0045 <span class="comment">%    handles = findjobj;           % get list of all java elements of current figure (inc. menus, toolbars etc.)</span>
0046 <span class="comment">%    findjobj('print');            % list all java elements in current figure</span>
0047 <span class="comment">%    findjobj('print',6);          % list all java elements in current figure, contained within its 6th element</span>
0048 <span class="comment">%    handles = findjobj(hButton);                                     % hButton is a matlab button</span>
0049 <span class="comment">%    handles = findjobj(gcf,'position',getpixelposition(hButton,1));  % same as above but also return hButton's panel</span>
0050 <span class="comment">%    handles = findjobj(hButton,'persist');                           % same as above, persist info for future reuse</span>
0051 <span class="comment">%    handles = findjobj('class','pushbutton');                        % get all pushbuttons in current figure</span>
0052 <span class="comment">%    handles = findjobj('class','pushbutton','position',123,456);     % get all pushbuttons at the specified position</span>
0053 <span class="comment">%    handles = findjobj(gcf,'class','pushbutton','size',23,15);       % get all pushbuttons with the specified size</span>
0054 <span class="comment">%    handles = findjobj('property','Text','not','class','button');    % get all non-button elements with 'text' property</span>
0055 <span class="comment">%    handles = findjobj('-property',{'Text','click me'});             % get all elements with 'text' property = 'click me'</span>
0056 <span class="comment">%</span>
0057 <span class="comment">% Sample usage:</span>
0058 <span class="comment">%    hButton = uicontrol('string','click me');</span>
0059 <span class="comment">%    jButton = findjobj(hButton,'nomenu');</span>
0060 <span class="comment">%      % or: jButton = findjobj('property',{'Text','click me'});</span>
0061 <span class="comment">%    jButton.setFlyOverAppearance(1);</span>
0062 <span class="comment">%    jButton.setCursor(java.awt.Cursor.getPredefinedCursor(java.awt.Cursor.HAND_CURSOR));</span>
0063 <span class="comment">%    set(jButton,'FocusGainedCallback',@myMatlabFunction);   % some 30 callback points available...</span>
0064 <span class="comment">%    jButton.get;   % list all changeable properties...</span>
0065 <span class="comment">%</span>
0066 <span class="comment">%    hEditbox = uicontrol('style',edit');</span>
0067 <span class="comment">%    jEditbox = findjobj(hEditbox,'nomenu');</span>
0068 <span class="comment">%    jEditbox.setCaretColor(java.awt.Color.red);</span>
0069 <span class="comment">%    jEditbox.KeyTypedCallback = @myCallbackFunc;  % many more callbacks where this came from...</span>
0070 <span class="comment">%    jEdit.requestFocus;</span>
0071 <span class="comment">%</span>
0072 <span class="comment">% Known issues/limitations:</span>
0073 <span class="comment">%    - Cannot currently process multiple container objects - just one at a time</span>
0074 <span class="comment">%    - Initial processing is a bit slow when the figure is laden with many UI components (so better use 'persist')</span>
0075 <span class="comment">%    - Passing a simple container Matlab handle is currently filtered by its position+size: should find a better way to do this</span>
0076 <span class="comment">%    - Matlab uipanels are not implemented as simple java panels, and so they can't be found using this utility</span>
0077 <span class="comment">%    - Labels have a write-only text property in java, so they can't be found using the 'property',{'Text','string'} notation</span>
0078 <span class="comment">%</span>
0079 <span class="comment">% Warning:</span>
0080 <span class="comment">%    This code heavily relies on undocumented and unsupported Matlab functionality.</span>
0081 <span class="comment">%    It works on Matlab 7+, but use at your own risk!</span>
0082 <span class="comment">%</span>
0083 <span class="comment">% Bugs and suggestions:</span>
0084 <span class="comment">%    Please send to Yair Altman (altmany at gmail dot com)</span>
0085 <span class="comment">%</span>
0086 <span class="comment">% Change log:</span>
0087 <span class="comment">%    2010-04-21: Minor fix to support combo-boxes (aka drop-down, popup-menu) on Windows</span>
0088 <span class="comment">%    2010-03-17: Important release: Fixes for R2010a, debug listing, objects not found, component containers that should be ignored etc.</span>
0089 <span class="comment">%    2010-02-04: Forced an EDT redraw before processing; warned if requested handle is invisible</span>
0090 <span class="comment">%    2010-01-18: Found a way to display label text next to the relevant node name</span>
0091 <span class="comment">%    2009-10-28: Fixed uitreenode warning</span>
0092 <span class="comment">%    2009-10-27: Fixed auto-collapse of invisible container nodes; added dynamic tree tooltips &amp; context-menu; minor fix to version-check display</span>
0093 <span class="comment">%    2009-09-30: Fix for Matlab 7.0 as suggested by Oliver W; minor GUI fix (classname font)</span>
0094 <span class="comment">%    2009-08-07: Fixed edge-case of missing JIDE tables</span>
0095 <span class="comment">%    2009-05-24: Added support for future Matlab versions that will not support JavaFrame</span>
0096 <span class="comment">%    2009-05-15: Added sanity checks for axes items</span>
0097 <span class="comment">%    2009-04-28: Added 'debug' input arg; increased size tolerance 1px =&gt; 2px</span>
0098 <span class="comment">%    2009-04-23: Fixed location of popupmenus (always 20px high despite what's reported by Matlab...); fixed uiinspect processing issues; added blog link; narrower action buttons</span>
0099 <span class="comment">%    2009-04-09: Automatic 'nomenu' for uicontrol inputs; significant performance improvement</span>
0100 <span class="comment">%    2009-03-31: Fixed position of some Java components; fixed properties tooltip; fixed node visibility indication</span>
0101 <span class="comment">%    2009-02-26: Indicated components visibility (&amp; auto-collapse non-visible containers); auto-highlight selected component; fixes in node icons, figure title &amp; tree refresh; improved error handling; display FindJObj version update description if available</span>
0102 <span class="comment">%    2009-02-24: Fixed update check; added dedicated labels icon</span>
0103 <span class="comment">%    2009-02-18: Fixed compatibility with old Matlab versions</span>
0104 <span class="comment">%    2009-02-08: Callbacks table fixes; use uiinspect if available; fix update check according to new FEX website</span>
0105 <span class="comment">%    2008-12-17: R2008b compatibility</span>
0106 <span class="comment">%    2008-09-10: Fixed minor bug as per Johnny Smith</span>
0107 <span class="comment">%    2007-11-14: Fixed edge case problem with class properties tooltip; used existing object icon if available; added checkbox option to hide standard callbacks</span>
0108 <span class="comment">%    2007-08-15: Fixed object naming relative property priorities; added sanity check for illegal container arg; enabled desktop (0) container; cleaned up warnings about special class objects</span>
0109 <span class="comment">%    2007-08-03: Fixed minor tagging problems with a few Java sub-classes; displayed UIClassID if text/name/tag is unavailable</span>
0110 <span class="comment">%    2007-06-15: Fixed problems finding HG components found by J. Wagberg</span>
0111 <span class="comment">%    2007-05-22: Added 'nomenu' option for improved performance; fixed 'export handles' bug; fixed handle-finding/display bugs; &quot;cleaner&quot; error handling</span>
0112 <span class="comment">%    2007-04-23: HTMLized classname tooltip; returned top-level figure Frame handle for figure container; fixed callbacks table; auto-checked newer version; fixed Matlab 7.2 compatibility issue; added HG objects tree</span>
0113 <span class="comment">%    2007-04-19: Fixed edge case of missing figure; displayed tree hierarchy in interactive GUI if no output args; workaround for figure sub-menus invisible unless clicked</span>
0114 <span class="comment">%    2007-04-04: Improved performance; returned full listing results in 4th output arg; enabled partial property names &amp; property values; automatically filtered out container panels if children also returned; fixed finding sub-menu items</span>
0115 <span class="comment">%    2007-03-20: First version posted on the MathWorks file exchange: &lt;a href=&quot;http://www.mathworks.com/matlabcentral/fileexchange/loadFile.do?objectId=14317&quot;&gt;http://www.mathworks.com/matlabcentral/fileexchange/loadFile.do?objectId=14317&lt;/a&gt;</span>
0116 <span class="comment">%</span>
0117 <span class="comment">% See also:</span>
0118 <span class="comment">%    java, handle, findobj, findall, javaGetHandles, uiinspect (on the File Exchange)</span>
0119 
0120 <span class="comment">% License to use and modify this code is granted freely to all interested, as long as the original author is</span>
0121 <span class="comment">% referenced and attributed as such. The original author maintains the right to be solely associated with this work.</span>
0122 
0123 <span class="comment">% Programmed and Copyright by Yair M. Altman: altmany(at)gmail.com</span>
0124 <span class="comment">% $Revision: 1.28 $  $Date: 2010/04/21 01:40:03 $</span>
0125 
0126     <span class="comment">% Ensure Java AWT is enabled</span>
0127     error(javachk(<span class="string">'awt'</span>));
0128 
0129     <span class="keyword">persistent</span> pContainer pHandles pLevels pParentIdx pPositions
0130 
0131     <span class="keyword">try</span>
0132         <span class="comment">% Initialize</span>
0133         handles = handle([]);
0134         levels = [];
0135         parentIdx = [];
0136         positions = [];   <span class="comment">% Java positions start at the top-left corner</span>
0137         <span class="comment">%sizes = [];</span>
0138         listing = <span class="string">''</span>;
0139         hg_levels = [];
0140         hg_handles = handle([]);  <span class="comment">% HG handles are double</span>
0141         hg_parentIdx = [];
0142         nomenu = false;
0143         menuBarFoundFlag = false;
0144 
0145         <span class="comment">% Force an EDT redraw before processing, to ensure all uicontrols etc. are rendered</span>
0146         drawnow;  pause(0.02);
0147 
0148         <span class="comment">% Default container is the current figure's root panel</span>
0149         <span class="keyword">if</span> nargin
0150             <span class="keyword">if</span> isempty(container)  <span class="comment">% empty container - bail out</span>
0151                 <span class="keyword">return</span>;
0152             <span class="keyword">elseif</span> <a href="#_sub50" class="code" title="subfunction flag = ischar(data)">ischar</a>(container)  <span class="comment">% container skipped - this is part of the args list...</span>
0153                 varargin = {container, varargin{:}};
0154                 origContainer = <a href="#_sub3" class="code" title="subfunction curFig = getCurrentFigure">getCurrentFigure</a>;
0155                 [container,contentSize] = <a href="#_sub4" class="code" title="subfunction [jRootPane,contentSize] = getRootPanel(hFig)">getRootPanel</a>(origContainer);
0156             <span class="keyword">elseif</span> isequal(container,0)  <span class="comment">% root</span>
0157                 origContainer = handle(container);
0158                 container = com.mathworks.mde.desk.MLDesktop.getInstance.getMainFrame;
0159                 contentSize = [container.getWidth, container.getHeight];
0160             <span class="keyword">elseif</span> ishghandle(container) <span class="comment">% &amp;&amp; ~isa(container,'java.awt.Container')</span>
0161                 container = container(1);  <span class="comment">% another current limitation...</span>
0162                 hFig = ancestor(container,<span class="string">'figure'</span>);
0163                 origContainer = handle(container);
0164                 <span class="keyword">if</span> isa(origContainer,<span class="string">'uimenu'</span>)
0165                     <span class="comment">% getpixelposition doesn't work for menus... - damn!</span>
0166                     varargin = {<span class="string">'class'</span>,<span class="string">'MenuPeer'</span>, <span class="string">'property'</span>,{<span class="string">'Label'</span>,strrep(get(container,<span class="string">'Label'</span>),<span class="string">'&amp;'</span>,<span class="string">''</span>)}, varargin{:}};
0167                 <span class="keyword">elseif</span> ~isa(origContainer, <span class="string">'figure'</span>) &amp;&amp; ~isempty(hFig)
0168                     <span class="comment">% See limitations section above: should find a better way to directly refer to the element's java container</span>
0169                     <span class="keyword">try</span>
0170                         <span class="comment">% Note: 'PixelBounds' is undocumented and unsupported, but much faster than getpixelposition!</span>
0171                         <span class="comment">% ^^^^  unfortunately, its Y position is inaccurate in some cases - damn!</span>
0172                         <span class="comment">%size = get(container,'PixelBounds');</span>
0173                         pos = fix(getpixelposition(container,1));
0174                         <span class="comment">%varargin = {'position',pos(1:2), 'size',pos(3:4), 'not','class','java.awt.Panel', varargin{:}};</span>
0175                     <span class="keyword">catch</span>
0176                         <span class="keyword">try</span>
0177                             figName = get(hFig,<span class="string">'name'</span>);
0178                             <span class="keyword">if</span> strcmpi(get(hFig,<span class="string">'number'</span>),<span class="string">'on'</span>)
0179                                 figName = regexprep([<span class="string">'Figure '</span> num2str(hFig) <span class="string">': '</span> figName],<span class="string">': $'</span>,<span class="string">''</span>);
0180                             <span class="keyword">end</span>
0181                             mde = com.mathworks.mde.desk.MLDesktop.getInstance;
0182                             jFig = mde.getClient(figName);
0183                             <span class="keyword">if</span> isempty(jFig), error(<span class="string">'dummy'</span>);  <span class="keyword">end</span>
0184                         <span class="keyword">catch</span>
0185                             warning(<span class="string">'off'</span>,<span class="string">'MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame'</span>);  <span class="comment">% R2008b compatibility</span>
0186                             jFig = get(get(hFig,<span class="string">'JavaFrame'</span>),<span class="string">'FigurePanelContainer'</span>);
0187                         <span class="keyword">end</span>
0188                         pos = [];
0189                         <span class="keyword">try</span>
0190                             pxsize = get(container,<span class="string">'PixelBounds'</span>);
0191                             pos = [pxsize(1)+5, jFig.getHeight - (pxsize(4)-5)];
0192                         <span class="keyword">catch</span>
0193                             <span class="comment">% never mind...</span>
0194                         <span class="keyword">end</span>
0195                     <span class="keyword">end</span>
0196                     <span class="keyword">if</span> size(pos,2) == 2
0197                         pos(:,3:4) = 0;
0198                     <span class="keyword">end</span>
0199                     <span class="keyword">if</span> ~isempty(pos)
0200                         <span class="keyword">if</span> isa(handle(container),<span class="string">'uicontrol'</span>) &amp;&amp; strcmp(get(container,<span class="string">'style'</span>),<span class="string">'popupmenu'</span>)
0201                             <span class="comment">% popupmenus (combo-box dropdowns) are always 20px high</span>
0202                             pos(2) = pos(2) + pos(4) - 20;
0203                             pos(4) = 20;
0204                         <span class="keyword">end</span>
0205                         <span class="comment">%varargin = {'position',pos(1:2), 'size',size(3:4)-size(1:2)-10, 'not','class','java.awt.Panel', varargin{:}};</span>
0206                         varargin = {<span class="string">'position'</span>,pos(1:2)+[0,pos(4)], <span class="string">'size'</span>,pos(3:4), <span class="string">'not'</span>,<span class="string">'class'</span>,<span class="string">'java.awt.Panel'</span>, <span class="string">'nomenu'</span>, varargin{:}};
0207                     <span class="keyword">end</span>
0208                 <span class="keyword">elseif</span> isempty(hFig)
0209                     hFig = handle(container);
0210                 <span class="keyword">end</span>
0211                 [container,contentSize] = <a href="#_sub4" class="code" title="subfunction [jRootPane,contentSize] = getRootPanel(hFig)">getRootPanel</a>(hFig);
0212             <span class="keyword">elseif</span> isjava(container)
0213                 <span class="comment">% Maybe a java container obj (will crash otherwise)</span>
0214                 origContainer = container;
0215                 contentSize = [container.getWidth, container.getHeight];
0216             <span class="keyword">else</span>
0217                 error(<span class="string">'YMA:findjobj:IllegalContainer'</span>,<span class="string">'Input arg does not appear to be a valid GUI object'</span>);
0218             <span class="keyword">end</span>
0219         <span class="keyword">else</span>
0220             <span class="comment">% Default container = current figure</span>
0221             origContainer = <a href="#_sub3" class="code" title="subfunction curFig = getCurrentFigure">getCurrentFigure</a>;
0222             [container,contentSize] = <a href="#_sub4" class="code" title="subfunction [jRootPane,contentSize] = getRootPanel(hFig)">getRootPanel</a>(origContainer);
0223         <span class="keyword">end</span>
0224 
0225         <span class="comment">% Check persistency</span>
0226         <span class="keyword">if</span> isequal(pContainer,container)
0227             <span class="comment">% persistency requested and the same container is reused, so reuse the hierarchy information</span>
0228             [handles,levels,parentIdx,positions] = deal(pHandles, pLevels, pParentIdx, pPositions);
0229         <span class="keyword">else</span>
0230             <span class="comment">% Pre-allocate space of complex data containers for improved performance</span>
0231             handles = repmat(handles,1,1000);
0232             positions = zeros(1000,2);
0233 
0234             <span class="comment">% Check whether to skip menu processing</span>
0235             nomenu = <a href="#_sub2" class="code" title="subfunction [flag,idx] = paramSupplied(paramsList,paramName)">paramSupplied</a>(varargin,<span class="string">'nomenu'</span>);
0236 
0237             <span class="comment">% Traverse the container hierarchy and extract the elements within</span>
0238             <a href="#_sub5" class="code" title="subfunction traverseContainer(jcontainer,level,parent)">traverseContainer</a>(container,0,1);
0239 
0240             <span class="comment">% Remove unnecessary pre-allocated elements</span>
0241             dataLen = length(levels);
0242             handles  (dataLen+1:end) = [];
0243             positions(dataLen+1:<span class="keyword">end</span>,:) = [];
0244         <span class="keyword">end</span>
0245 
0246         <span class="comment">% Process persistency check before any filtering is done</span>
0247         <span class="keyword">if</span> <a href="#_sub2" class="code" title="subfunction [flag,idx] = paramSupplied(paramsList,paramName)">paramSupplied</a>(varargin,<span class="string">'persist'</span>)
0248             [pContainer, pHandles, pLevels, pParentIdx, pPositions] = deal(container,handles,levels,parentIdx,positions);
0249         <span class="keyword">end</span>
0250 
0251         <span class="comment">% Save data for possible future use in presentObjectTree() below</span>
0252         allHandles = handles;
0253         allLevels  = levels;
0254         allParents = parentIdx;
0255         selectedIdx = 1:length(handles);
0256         <span class="comment">%[positions(:,1)-container.getX, container.getHeight - positions(:,2)]</span>
0257 
0258         <span class="comment">% Debug-list all found compponents and their positions</span>
0259         <span class="keyword">if</span> <a href="#_sub2" class="code" title="subfunction [flag,idx] = paramSupplied(paramsList,paramName)">paramSupplied</a>(varargin,<span class="string">'debug'</span>)
0260             <span class="keyword">for</span> handleIdx = 1 : length(allHandles)
0261                 thisObj = handles(handleIdx);
0262                 pos = sprintf(<span class="string">'%d,%d %dx%d'</span>,[positions(handleIdx,:) getWidth(thisObj) getHeight(thisObj)]);
0263                 disp([repmat(<span class="string">' '</span>,1,levels(handleIdx)) <span class="string">'['</span> pos <span class="string">'] '</span> char(toString(thisObj))]);
0264             <span class="keyword">end</span>
0265         <span class="keyword">end</span>
0266 
0267         <span class="comment">% Process optional args</span>
0268         <span class="comment">% Note: positions is NOT returned since it's based on java coord system (origin = top-left): will confuse Matlab users</span>
0269         <a href="#_sub9" class="code" title="subfunction processArgs(varargin)">processArgs</a>(varargin{:});  <span class="comment">%#ok</span>
0270 
0271         <span class="comment">% De-cell and trim listing, if only one element was found (no use for indented listing in this case)</span>
0272         <span class="keyword">if</span> iscell(listing) &amp;&amp; length(listing)==1
0273             listing = strtrim(listing{1});
0274         <span class="keyword">end</span>
0275 
0276         <span class="comment">% If no output args and no listing requested, present the FINDJOBJ interactive GUI</span>
0277         <span class="keyword">if</span> nargout == 0 &amp;&amp; isempty(listing)
0278 
0279             <span class="comment">% Get all label positions</span>
0280             hg_labels = [];
0281             labelPositions = <a href="#_sub47" class="code" title="subfunction labelPositions = getLabelsJavaPos(container)">getLabelsJavaPos</a>(container);
0282 
0283             <span class="comment">% Present the GUI (object tree)</span>
0284             <span class="keyword">if</span> ~isempty(container)
0285                 <a href="#_sub20" class="code" title="subfunction presentObjectTree()">presentObjectTree</a>();
0286             <span class="keyword">else</span>
0287                 <a href="#_sub1" class="code" title="subfunction warnInvisible">warnInvisible</a>;
0288             <span class="keyword">end</span>
0289 
0290         <span class="comment">% Display the listing, if this was specifically requested yet no relevant output arg was specified</span>
0291         <span class="keyword">elseif</span> nargout &lt; 4 &amp;&amp; ~isempty(listing)
0292             <span class="keyword">if</span> ~iscell(listing)
0293                 disp(listing);
0294             <span class="keyword">else</span>
0295                 <span class="keyword">for</span> listingIdx = 1 : length(listing)
0296                     disp(listing{listingIdx});
0297                 <span class="keyword">end</span>
0298             <span class="keyword">end</span>
0299         <span class="keyword">end</span>
0300 
0301         <span class="comment">% Display a warning if the requested handle was not found because it's invisible</span>
0302         <span class="keyword">if</span> nargout &amp;&amp; isempty(handles)
0303             <a href="#_sub1" class="code" title="subfunction warnInvisible">warnInvisible</a>;
0304         <span class="keyword">end</span>
0305 
0306         <span class="keyword">return</span>;  <span class="comment">%debug point</span>
0307 
0308     <span class="keyword">catch</span>
0309         <span class="comment">% 'Cleaner' error handling - strip the stack info etc.</span>
0310         err = lasterror;  <span class="comment">%#ok</span>
0311         err.message = regexprep(err.message,<span class="string">'Error using ==&gt; [^\n]+\n'</span>,<span class="string">''</span>);
0312         <span class="keyword">if</span> isempty(findstr(mfilename,err.message))
0313             <span class="comment">% Indicate error origin, if not already stated within the error message</span>
0314             err.message = [mfilename <span class="string">': '</span> err.message];
0315         <span class="keyword">end</span>
0316         rethrow(err);
0317     <span class="keyword">end</span>
0318 
0319     <span class="comment">%% Display a warning if the requested handle was not found because it's invisible</span>
0320     <a name="_sub1" href="#_subfunctions" class="code">function warnInvisible</a>
0321         <span class="keyword">try</span>
0322             stk = dbstack;
0323             stkNames = {stk.name};
0324             OutputFcnIdx = find(~cellfun(@isempty,regexp(stkNames,<span class="string">'_OutputFcn'</span>)));
0325             <span class="keyword">if</span> ~isempty(OutputFcnIdx)
0326                 OutputFcnName = stkNames{OutputFcnIdx};
0327                 warning(<span class="string">'YMA:FindJObj:OutputFcn'</span>,[<span class="string">'No Java reference was found for the requested handle, because the figure is still invisible in '</span> OutputFcnName <span class="string">'()'</span>]);
0328             <span class="keyword">elseif</span> ishandle(origContainer) &amp;&amp; isprop(origContainer,<span class="string">'Visible'</span>) &amp;&amp; strcmpi(get(origContainer,<span class="string">'Visible'</span>),<span class="string">'off'</span>)
0329                 warning(<span class="string">'YMA:FindJObj:invisibleHandle'</span>,<span class="string">'No Java reference was found for the requested handle, probably because it is still invisible'</span>);
0330             <span class="keyword">end</span>
0331         <span class="keyword">catch</span>
0332             <span class="comment">% Never mind...</span>
0333         <span class="keyword">end</span>
0334     <span class="keyword">end</span>
0335 
0336     <span class="comment">%% Check existence of a (case-insensitive) optional parameter in the params list</span>
0337     <a name="_sub2" href="#_subfunctions" class="code">function [flag,idx] = paramSupplied(paramsList,paramName)</a>
0338         <span class="comment">%idx = find(~cellfun('isempty',regexpi(paramsList(cellfun(@ischar,paramsList)),['^-?' paramName])));</span>
0339         idx = find(~cellfun(<span class="string">'isempty'</span>,regexpi(paramsList(cellfun(<span class="string">'isclass'</span>,paramsList,<span class="string">'char'</span>)),[<span class="string">'^-?'</span> paramName])));  <span class="comment">% 30/9/2009 fix for ML 7.0 suggested by Oliver W</span>
0340         flag = any(idx);
0341     <span class="keyword">end</span>
0342 
0343     <span class="comment">%% Get current figure (even if its 'HandleVisibility' property is 'off')</span>
0344     <a name="_sub3" href="#_subfunctions" class="code">function curFig = getCurrentFigure</a>
0345         oldShowHidden = get(0,<span class="string">'ShowHiddenHandles'</span>);
0346         set(0,<span class="string">'ShowHiddenHandles'</span>,<span class="string">'on'</span>);  <span class="comment">% minor fix per Johnny Smith</span>
0347         curFig = gcf;
0348         set(0,<span class="string">'ShowHiddenHandles'</span>,oldShowHidden);
0349     <span class="keyword">end</span>
0350 
0351     <span class="comment">%% Get Java reference to top-level (root) panel - actually, a reference to the java figure</span>
0352     <a name="_sub4" href="#_subfunctions" class="code">function [jRootPane,contentSize] = getRootPanel(hFig)</a>
0353         <span class="keyword">try</span>
0354             contentSize = [0,0];  <span class="comment">% initialize</span>
0355             jRootPane = hFig;
0356             figName = get(hFig,<span class="string">'name'</span>);
0357             <span class="keyword">if</span> strcmpi(get(hFig,<span class="string">'number'</span>),<span class="string">'on'</span>)
0358                 figName = regexprep([<span class="string">'Figure '</span> num2str(hFig) <span class="string">': '</span> figName],<span class="string">': $'</span>,<span class="string">''</span>);
0359             <span class="keyword">end</span>
0360             mde = com.mathworks.mde.desk.MLDesktop.getInstance;
0361             jFigPanel = mde.getClient(figName);
0362             jRootPane = jFigPanel;
0363             jRootPane = jFigPanel.getRootPane;
0364         <span class="keyword">catch</span>
0365             <span class="keyword">try</span>
0366                 warning(<span class="string">'off'</span>,<span class="string">'MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame'</span>);  <span class="comment">% R2008b compatibility</span>
0367                 jFrame = get(hFig,<span class="string">'JavaFrame'</span>);
0368                 jFigPanel = get(jFrame,<span class="string">'FigurePanelContainer'</span>);
0369                 jRootPane = jFigPanel;
0370                 jRootPane = jFigPanel.getComponent(0).getRootPane;
0371             <span class="keyword">catch</span>
0372                 <span class="comment">% Never mind</span>
0373             <span class="keyword">end</span>
0374         <span class="keyword">end</span>
0375         <span class="keyword">try</span>
0376             <span class="comment">% If invalid RootPane - try another method...</span>
0377             warning(<span class="string">'off'</span>,<span class="string">'MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame'</span>);  <span class="comment">% R2008b compatibility</span>
0378             jFrame = get(hFig,<span class="string">'JavaFrame'</span>);
0379             jAxisComponent = get(jFrame,<span class="string">'AxisComponent'</span>);
0380             jRootPane = jAxisComponent.getParent.getParent.getRootPane;
0381         <span class="keyword">catch</span>
0382             <span class="comment">% Never mind</span>
0383         <span class="keyword">end</span>
0384         <span class="keyword">try</span>
0385             <span class="comment">% If invalid RootPane, retry up to N times</span>
0386             tries = 10;
0387             <span class="keyword">while</span> isempty(jRootPane) &amp;&amp; tries&gt;0  <span class="comment">% might happen if figure is still undergoing rendering...</span>
0388                 drawnow; pause(0.001);
0389                 tries = tries - 1;
0390                 jRootPane = jFigPanel.getComponent(0).getRootPane;
0391             <span class="keyword">end</span>
0392 
0393             <span class="comment">% If still invalid, use FigurePanelContainer which is good enough in 99% of cases... (menu/tool bars won't be accessible, though)</span>
0394             <span class="keyword">if</span> isempty(jRootPane)
0395                 jRootPane = jFigPanel;
0396             <span class="keyword">end</span>
0397             contentSize = [jRootPane.getWidth, jRootPane.getHeight];
0398 
0399             <span class="comment">% Try to get the ancestor FigureFrame</span>
0400             jRootPane = jRootPane.getTopLevelAncestor;
0401         <span class="keyword">catch</span>
0402             <span class="comment">% Never mind - FigurePanelContainer is good enough in 99% of cases... (menu/tool bars won't be accessible, though)</span>
0403         <span class="keyword">end</span>
0404     <span class="keyword">end</span>
0405 
0406     <span class="comment">%% Traverse the container hierarchy and extract the elements within</span>
0407     <a name="_sub5" href="#_subfunctions" class="code">function traverseContainer(jcontainer,level,parent)</a>
0408         <span class="keyword">persistent</span> figureComponentFound menuRootFound
0409 
0410         <span class="comment">% Record the data for this node</span>
0411         <span class="comment">%disp([repmat(' ',1,level) '&lt;= ' char(jcontainer.toString)])</span>
0412         thisIdx = length(levels) + 1;
0413         levels(thisIdx) = level;
0414         parentIdx(thisIdx) = parent;
0415         handles(thisIdx) = handle(jcontainer,<span class="string">'callbackproperties'</span>);
0416         <span class="keyword">try</span>
0417             positions(thisIdx,:) = <a href="#_sub6" class="code" title="subfunction xy = getXY(jcontainer)">getXY</a>(jcontainer);
0418             <span class="comment">%sizes(thisIdx,:) = [jcontainer.getWidth, jcontainer.getHeight];</span>
0419         <span class="keyword">catch</span>
0420             positions(thisIdx,:) = [0,0];
0421             <span class="comment">%sizes(thisIdx,:) = [0,0];</span>
0422         <span class="keyword">end</span>
0423         <span class="keyword">if</span> level&gt;0
0424             positions(thisIdx,:) = positions(thisIdx,:) + positions(parent,:);
0425             <span class="keyword">if</span> ~figureComponentFound &amp;&amp; <span class="keyword">...</span>
0426                strcmp(jcontainer.getName,<span class="string">'fComponentContainer'</span>) &amp;&amp; <span class="keyword">...</span>
0427                isa(jcontainer,<span class="string">'com.mathworks.hg.peer.FigureComponentContainer'</span>)   <span class="comment">% there are 2 FigureComponentContainers - only process one...</span>
0428 
0429                 <span class="comment">% restart coordinate system, to exclude menu &amp; toolbar areas</span>
0430                 positions(thisIdx,:) = positions(thisIdx,:) - [jcontainer.getRootPane.getX, jcontainer.getRootPane.getY];
0431                 figureComponentFound = true;
0432             <span class="keyword">end</span>
0433         <span class="keyword">elseif</span> level==1
0434             positions(thisIdx,:) = positions(thisIdx,:) + positions(parent,:);
0435         <span class="keyword">else</span>
0436             <span class="comment">% level 0 - initialize flags used later</span>
0437             figureComponentFound = false;
0438             menuRootFound = false;
0439         <span class="keyword">end</span>
0440         parentId = length(parentIdx);
0441 
0442         <span class="comment">% Traverse Menu items, unless the 'nomenu' option was requested</span>
0443         <span class="keyword">if</span> ~nomenu
0444             <span class="keyword">try</span>
0445                 <span class="keyword">for</span> child = 1 : <a href="#_sub7" class="code" title="subfunction numMenuComponents  = getNumMenuComponents(jcontainer)">getNumMenuComponents</a>(jcontainer)
0446                     <a href="#_sub5" class="code" title="subfunction traverseContainer(jcontainer,level,parent)">traverseContainer</a>(jcontainer.getMenuComponent(child-1),level+1,parentId);
0447                 <span class="keyword">end</span>
0448             <span class="keyword">catch</span>
0449                 <span class="comment">% Probably not a Menu container, but maybe a top-level JMenu, so discard duplicates</span>
0450                 <span class="comment">%if isa(handles(end).java,'javax.swing.JMenuBar')</span>
0451                 <span class="keyword">if</span> ~menuRootFound &amp;&amp; strcmp(handles(end).java.class,<span class="string">'javax.swing.JMenuBar'</span>)  <span class="comment">%faster...</span>
0452                     <span class="keyword">if</span> <a href="#_sub8" class="code" title="subfunction nodeRemovedFlag = removeDuplicateNode(thisIdx)">removeDuplicateNode</a>(thisIdx)
0453                         menuRootFound = true;
0454                         <span class="keyword">return</span>;
0455                     <span class="keyword">end</span>
0456                 <span class="keyword">end</span>
0457             <span class="keyword">end</span>
0458         <span class="keyword">end</span>
0459 
0460         <span class="comment">% Now recursively process all this node's children (if any), except menu items if so requested</span>
0461         <span class="comment">%if isa(jcontainer,'java.awt.Container')</span>
0462         <span class="keyword">try</span>  <span class="comment">% try-catch is faster than checking isa(jcontainer,'java.awt.Container')...</span>
0463             <span class="comment">%if jcontainer.getComponentCount,  jcontainer.getComponents,  end</span>
0464             <span class="keyword">if</span> ~nomenu || menuBarFoundFlag || isempty(strfind(jcontainer.class,<span class="string">'FigureMenuBar'</span>))
0465                 lastChildComponent = java.lang.Object;
0466                 child = 0;
0467                 <span class="keyword">while</span> (child &lt; jcontainer.getComponentCount)
0468                     childComponent = jcontainer.getComponent(child);
0469                     <span class="comment">% Looping over menus sometimes causes jcontainer to get mixed up (probably a JITC bug), so identify &amp; fix</span>
0470                     <span class="keyword">if</span> isequal(childComponent,lastChildComponent)
0471                         child = child + 1;
0472                         childComponent = jcontainer.getComponent(child);
0473                     <span class="keyword">end</span>
0474                     lastChildComponent = childComponent;
0475                     <span class="comment">%disp([repmat(' ',1,level) '=&gt; ' num2str(child) ': ' char(childComponent.class)])</span>
0476                     <a href="#_sub5" class="code" title="subfunction traverseContainer(jcontainer,level,parent)">traverseContainer</a>(childComponent,level+1,parentId);
0477                     child = child + 1;
0478                 <span class="keyword">end</span>
0479             <span class="keyword">else</span>
0480                 menuBarFoundFlag = true;  <span class="comment">% use this flag to skip further testing for FigureMenuBar</span>
0481             <span class="keyword">end</span>
0482         <span class="keyword">catch</span>
0483             <span class="comment">% do nothing - probably not a container</span>
0484             <span class="comment">%dispError</span>
0485         <span class="keyword">end</span>
0486 
0487         <span class="comment">% ...and yet another type of child traversal...</span>
0488         <span class="keyword">try</span>
0489             <span class="keyword">for</span> child = 1 : jcontainer.java.getChildCount
0490                 <a href="#_sub5" class="code" title="subfunction traverseContainer(jcontainer,level,parent)">traverseContainer</a>(jcontainer.java.getChildAt(child-1),level+1,parentId);
0491             <span class="keyword">end</span>
0492         <span class="keyword">catch</span>
0493             <span class="comment">% do nothing - probably not a container</span>
0494             <span class="comment">%dispError</span>
0495         <span class="keyword">end</span>
0496 
0497         <span class="comment">% TODO: Add axis (plot) component handles</span>
0498     <span class="keyword">end</span>
0499 
0500     <span class="comment">%% Get the XY location of a Java component</span>
0501     <a name="_sub6" href="#_subfunctions" class="code">function xy = getXY(jcontainer)</a>
0502             <span class="comment">% Note: getX/getY are better than get(..,'X') (mem leaks),</span>
0503             <span class="comment">% ^^^^  but sometimes they fail and revert to getx.m ...</span>
0504             <span class="comment">% Note2: try awtinvoke() catch is faster than checking ismethod()...</span>
0505             <span class="comment">% Note3: using AWTUtilities.invokeAndWait() directly is even faster than awtinvoke()...</span>
0506             <span class="keyword">try</span> <span class="comment">%if ismethod(jcontainer,'getX')</span>
0507                 <span class="comment">%positions(thisIdx,:) = [jcontainer.getX, jcontainer.getY];</span>
0508                 cls = getClass(jcontainer);
0509                 location = com.mathworks.jmi.AWTUtilities.invokeAndWait(jcontainer,getMethod(cls,<span class="string">'getLocation'</span>,[]),[]);
0510                 x = location.getX;
0511                 y = location.getY;
0512             <span class="keyword">catch</span> <span class="comment">%else</span>
0513                 <span class="keyword">try</span>
0514                     x = com.mathworks.jmi.AWTUtilities.invokeAndWait(jcontainer,getMethod(cls,<span class="string">'getX'</span>,[]),[]);
0515                     y = com.mathworks.jmi.AWTUtilities.invokeAndWait(jcontainer,getMethod(cls,<span class="string">'getY'</span>,[]),[]);
0516                 <span class="keyword">catch</span>
0517                     <span class="keyword">try</span>
0518                         x = awtinvoke(jcontainer,<span class="string">'getX()'</span>);
0519                         y = awtinvoke(jcontainer,<span class="string">'getY()'</span>);
0520                     <span class="keyword">catch</span>
0521                         x = get(jcontainer,<span class="string">'X'</span>);
0522                         y = get(jcontainer,<span class="string">'Y'</span>);
0523                     <span class="keyword">end</span>
0524                 <span class="keyword">end</span>
0525             <span class="keyword">end</span>
0526             <span class="comment">%positions(thisIdx,:) = [x, y];</span>
0527             xy = [x,y];
0528     <span class="keyword">end</span>
0529 
0530     <span class="comment">%% Get the number of menu sub-elements</span>
0531     <a name="_sub7" href="#_subfunctions" class="code">function numMenuComponents  = getNumMenuComponents(jcontainer)</a>
0532 
0533         <span class="comment">% The following line will raise an Exception for anything except menus</span>
0534         numMenuComponents = jcontainer.getMenuComponentCount;
0535 
0536         <span class="comment">% No error so far, so this must be a menu container...</span>
0537         <span class="comment">% Note: Menu subitems are not visible until the top-level (root) menu gets initial focus...</span>
0538         <span class="comment">% Try several alternatives, until we get a non-empty menu (or not...)</span>
0539         <span class="comment">% TODO: Improve performance - this takes WAY too long...</span>
0540         <span class="keyword">if</span> jcontainer.isTopLevelMenu &amp;&amp; (numMenuComponents==0)
0541             jcontainer.requestFocus;
0542             numMenuComponents = jcontainer.getMenuComponentCount;
0543             <span class="keyword">if</span> (numMenuComponents == 0)
0544                 drawnow; pause(0.001);
0545                 numMenuComponents = jcontainer.getMenuComponentCount;
0546                 <span class="keyword">if</span> (numMenuComponents == 0)
0547                     jcontainer.setSelected(true);
0548                     numMenuComponents = jcontainer.getMenuComponentCount;
0549                     <span class="keyword">if</span> (numMenuComponents == 0)
0550                         drawnow; pause(0.001);
0551                         numMenuComponents = jcontainer.getMenuComponentCount;
0552                         <span class="keyword">if</span> (numMenuComponents == 0)
0553                             jcontainer.doClick;  <span class="comment">% needed in order to populate the sub-menu components</span>
0554                             numMenuComponents = jcontainer.getMenuComponentCount;
0555                             <span class="keyword">if</span> (numMenuComponents == 0)
0556                                 drawnow; <span class="comment">%pause(0.001);</span>
0557                                 numMenuComponents = jcontainer.getMenuComponentCount;
0558                                 jcontainer.doClick;  <span class="comment">% close menu by re-clicking...</span>
0559                                 <span class="keyword">if</span> (numMenuComponents == 0)
0560                                     drawnow; <span class="comment">%pause(0.001);</span>
0561                                     numMenuComponents = jcontainer.getMenuComponentCount;
0562                                 <span class="keyword">end</span>
0563                             <span class="keyword">else</span>
0564                                 <span class="comment">% ok - found sub-items</span>
0565                                 <span class="comment">% Note: no need to close menu since this will be done when focus moves to the FindJObj window</span>
0566                                 <span class="comment">%jcontainer.doClick;  % close menu by re-clicking...</span>
0567                             <span class="keyword">end</span>
0568                         <span class="keyword">end</span>
0569                     <span class="keyword">end</span>
0570                     jcontainer.setSelected(false);  <span class="comment">% de-select the menu</span>
0571                 <span class="keyword">end</span>
0572             <span class="keyword">end</span>
0573         <span class="keyword">end</span>
0574     <span class="keyword">end</span>
0575 
0576     <span class="comment">%% Remove a specific tree node's data</span>
0577     <a name="_sub8" href="#_subfunctions" class="code">function nodeRemovedFlag = removeDuplicateNode(thisIdx)</a>
0578         nodeRemovedFlag = false;
0579         <span class="keyword">for</span> idx = 1 : thisIdx-1
0580             <span class="keyword">if</span> isequal(handles(idx),handles(thisIdx))
0581                 levels(thisIdx) = [];
0582                 parentIdx(thisIdx) = [];
0583                 handles(thisIdx) = [];
0584                 positions(thisIdx,:) = [];
0585                 <span class="comment">%sizes(thisIdx,:) = [];</span>
0586                 nodeRemovedFlag = true;
0587                 <span class="keyword">return</span>;
0588             <span class="keyword">end</span>
0589         <span class="keyword">end</span>
0590     <span class="keyword">end</span>
0591 
0592     <span class="comment">%% Process optional args</span>
0593     <a name="_sub9" href="#_subfunctions" class="code">function processArgs(varargin)</a>
0594 
0595         <span class="comment">% Initialize</span>
0596         invertFlag = false;
0597         listing = <span class="string">''</span>;
0598 
0599         <span class="comment">% Loop over all optional args</span>
0600         <span class="keyword">while</span> ~isempty(varargin) &amp;&amp; ~isempty(handles)
0601 
0602             <span class="comment">% Process the arg (and all its params)</span>
0603             foundIdx = 1 : length(handles);
0604             <span class="keyword">if</span> iscell(varargin{1}),  varargin{1} = varargin{1}{1};  <span class="keyword">end</span>
0605             <span class="keyword">if</span> ~isempty(varargin{1}) &amp;&amp; varargin{1}(1)==<span class="string">'-'</span>
0606                 varargin{1}(1) = [];
0607             <span class="keyword">end</span>
0608             <span class="keyword">switch</span> lower(varargin{1})
0609                 <span class="keyword">case</span> <span class="string">'not'</span>
0610                     invertFlag = true;
0611                 <span class="keyword">case</span> <span class="string">'position'</span>
0612                     [varargin,foundIdx] = <a href="#_sub11" class="code" title="subfunction [varargin,foundIdx] = processPositionArgs(varargin)">processPositionArgs</a>(varargin{:});
0613                     <span class="keyword">if</span> invertFlag,  foundIdx = ~foundIdx;  invertFlag = false;  <span class="keyword">end</span>
0614                 <span class="keyword">case</span> <span class="string">'size'</span>
0615                     [varargin,foundIdx] = <a href="#_sub12" class="code" title="subfunction [varargin,foundIdx] = processSizeArgs(varargin)">processSizeArgs</a>(varargin{:});
0616                     <span class="keyword">if</span> invertFlag,  foundIdx = ~foundIdx;  invertFlag = false;  <span class="keyword">end</span>
0617                 <span class="keyword">case</span> <span class="string">'class'</span>
0618                     [varargin,foundIdx] = <a href="#_sub13" class="code" title="subfunction [varargin,foundIdx] = processClassArgs(varargin)">processClassArgs</a>(varargin{:});
0619                     <span class="keyword">if</span> invertFlag,  foundIdx = ~foundIdx;  invertFlag = false;  <span class="keyword">end</span>
0620                 <span class="keyword">case</span> <span class="string">'property'</span>
0621                     [varargin,foundIdx] = <a href="#_sub14" class="code" title="subfunction [varargin,foundIdx] = processPropertyArgs(varargin)">processPropertyArgs</a>(varargin{:});
0622                     <span class="keyword">if</span> invertFlag,  foundIdx = ~foundIdx;  invertFlag = false;  <span class="keyword">end</span>
0623                 <span class="keyword">case</span> <span class="string">'depth'</span>
0624                     [varargin,foundIdx] = <a href="#_sub15" class="code" title="subfunction [varargin,foundIdx] = processDepthArgs(varargin)">processDepthArgs</a>(varargin{:});
0625                     <span class="keyword">if</span> invertFlag,  foundIdx = ~foundIdx;  invertFlag = false;  <span class="keyword">end</span>
0626                 <span class="keyword">case</span> <span class="string">'flat'</span>
0627                     varargin = {<span class="string">'depth'</span>,0, varargin{min(2:end):end}};
0628                     [varargin,foundIdx] = <a href="#_sub15" class="code" title="subfunction [varargin,foundIdx] = processDepthArgs(varargin)">processDepthArgs</a>(varargin{:});
0629                     <span class="keyword">if</span> invertFlag,  foundIdx = ~foundIdx;  invertFlag = false;  <span class="keyword">end</span>
0630                 <span class="keyword">case</span> {<span class="string">'print'</span>,<span class="string">'list'</span>}
0631                     [varargin,listing] = <a href="#_sub10" class="code" title="subfunction [varargin,listing] = processPrintArgs(varargin)">processPrintArgs</a>(varargin{:});
0632                 <span class="keyword">case</span> {<span class="string">'persist'</span>,<span class="string">'nomenu'</span>,<span class="string">'debug'</span>}
0633                     <span class="comment">% ignore - already handled in main function above</span>
0634                 <span class="keyword">otherwise</span>
0635                     error(<span class="string">'YMA:findjobj:IllegalOption'</span>,[<span class="string">'Option '</span> num2str(varargin{1}) <span class="string">' is not a valid option. Type ''help '</span> mfilename <span class="string">''' for the full options list.'</span>]);
0636             <span class="keyword">end</span>
0637 
0638             <span class="comment">% If only parent-child pairs found</span>
0639             foundIdx = find(foundIdx);
0640             <span class="keyword">if</span> ~isempty(foundIdx) &amp;&amp; isequal(parentIdx(foundIdx(2:2:end)),foundIdx(1:2:end))
0641                 <span class="comment">% Return just the children (the parent panels are uninteresting)</span>
0642                 foundIdx(1:2:end) = [];
0643             <span class="keyword">end</span>
0644             
0645             <span class="comment">% If several possible handles were found and the first is the container of the second</span>
0646             <span class="keyword">if</span> length(foundIdx) &gt; 1 &amp;&amp; isequal(handles(1).java, handles(2).getParent)
0647                 <span class="comment">% Discard the uninteresting component container</span>
0648                 foundIdx(1) = [];
0649             <span class="keyword">end</span>
0650 
0651             <span class="comment">% Filter the results</span>
0652             selectedIdx = selectedIdx(foundIdx);
0653             handles   = handles(foundIdx);
0654             levels    = levels(foundIdx);
0655             parentIdx = parentIdx(foundIdx);
0656             positions = positions(foundIdx,:);
0657 
0658             <span class="comment">% Remove this arg and proceed to the next one</span>
0659             varargin(1) = [];
0660 
0661         <span class="keyword">end</span>  <span class="comment">% Loop over all args</span>
0662     <span class="keyword">end</span>
0663 
0664     <span class="comment">%% Process 'print' option</span>
0665     <a name="_sub10" href="#_subfunctions" class="code">function [varargin,listing] = processPrintArgs(varargin)</a>
0666         <span class="keyword">if</span> length(varargin)&lt;2 || <a href="#_sub50" class="code" title="subfunction flag = ischar(data)">ischar</a>(varargin{2})
0667             <span class="comment">% No second arg given, so use the first available element</span>
0668             listingContainer = handles(1);  <span class="comment">%#ok - used in evalc below</span>
0669         <span class="keyword">else</span>
0670             <span class="comment">% Get the element to print from the specified second arg</span>
0671             <span class="keyword">if</span> isnumeric(varargin{2}) &amp;&amp; (varargin{2} == fix(varargin{2}))  <span class="comment">% isinteger doesn't work on doubles...</span>
0672                 <span class="keyword">if</span> (varargin{2} &gt; 0) &amp;&amp; (varargin{2} &lt;= length(handles))
0673                     listingContainer = handles(varargin{2});  <span class="comment">%#ok - used in evalc below</span>
0674                 <span class="keyword">elseif</span> varargin{2} &gt; 0
0675                     error(<span class="string">'YMA:findjobj:IllegalPrintFilter'</span>,<span class="string">'Print filter index %g &gt; number of available elements (%d)'</span>,varargin{2},length(handles));
0676                 <span class="keyword">else</span>
0677                     error(<span class="string">'YMA:findjobj:IllegalPrintFilter'</span>,<span class="string">'Print filter must be a java handle or positive numeric index into handles'</span>);
0678                 <span class="keyword">end</span>
0679             <span class="keyword">elseif</span> ismethod(varargin{2},<span class="string">'list'</span>)
0680                 listingContainer = varargin{2};  <span class="comment">%#ok - used in evalc below</span>
0681             <span class="keyword">else</span>
0682                 error(<span class="string">'YMA:findjobj:IllegalPrintFilter'</span>,<span class="string">'Print filter must be a java handle or numeric index into handles'</span>);
0683             <span class="keyword">end</span>
0684             varargin(2) = [];
0685         <span class="keyword">end</span>
0686 
0687         <span class="comment">% use evalc() to capture output into a Matlab variable</span>
0688         <span class="comment">%listing = evalc('listingContainer.list');</span>
0689 
0690         <span class="comment">% Better solution: loop over all handles and process them one by one</span>
0691         listing = cell(length(handles),1);
0692         <span class="keyword">for</span> componentIdx = 1 : length(handles)
0693             listing{componentIdx} = [repmat(<span class="string">' '</span>,1,levels(componentIdx)) char(handles(componentIdx).toString)];
0694         <span class="keyword">end</span>
0695     <span class="keyword">end</span>
0696 
0697     <span class="comment">%% Process 'position' option</span>
0698     <a name="_sub11" href="#_subfunctions" class="code">function [varargin,foundIdx] = processPositionArgs(varargin)</a>
0699         <span class="keyword">if</span> length(varargin)&gt;1
0700             positionFilter = varargin{2};
0701             <span class="comment">%if (isjava(positionFilter) || iscom(positionFilter)) &amp;&amp; ismethod(positionFilter,'getLocation')</span>
0702             <span class="keyword">try</span>  <span class="comment">% try-catch is faster...</span>
0703                 <span class="comment">% Java/COM object passed - get its position</span>
0704                 positionFilter = positionFilter.getLocation;
0705                 filterXY = [positionFilter.getX, positionFilter.getY];
0706             <span class="keyword">catch</span>
0707                 <span class="keyword">if</span> ~isscalar(positionFilter)
0708                     <span class="comment">% position vector passed</span>
0709                     <span class="keyword">if</span> (length(positionFilter)&gt;=2) &amp;&amp; isnumeric(positionFilter)
0710                         <span class="comment">% Remember that java coordinates start at top-left corner, Matlab coords start at bottom left...</span>
0711                         <span class="comment">%positionFilter = java.awt.Point(positionFilter(1), container.getHeight - positionFilter(2));</span>
0712                         filterXY = [container.getX + positionFilter(1), container.getY + contentSize(2) - positionFilter(2)];
0713 
0714                         <span class="comment">% Check for full Matlab position vector (x,y,w,h)</span>
0715                         <span class="comment">%if (length(positionFilter)==4)</span>
0716                         <span class="comment">%    varargin{end+1} = 'size';</span>
0717                         <span class="comment">%    varargin{end+1} = fix(positionFilter(3:4));</span>
0718                         <span class="comment">%end</span>
0719                     <span class="keyword">else</span>
0720                         error(<span class="string">'YMA:findjobj:IllegalPositionFilter'</span>,<span class="string">'Position filter must be a java UI component, or X,Y pair'</span>);
0721                     <span class="keyword">end</span>
0722                 <span class="keyword">elseif</span> length(varargin)&gt;2
0723                     <span class="comment">% x,y passed as separate arg values</span>
0724                     <span class="keyword">if</span> isnumeric(positionFilter) &amp;&amp; isnumeric(varargin{3})
0725                         <span class="comment">% Remember that java coordinates start at top-left corner, Matlab coords start at bottom left...</span>
0726                         <span class="comment">%positionFilter = java.awt.Point(positionFilter, container.getHeight - varargin{3});</span>
0727                         filterXY = [container.getX + positionFilter, container.getY + contentSize(2) - varargin{3}];
0728                         varargin(3) = [];
0729                     <span class="keyword">else</span>
0730                         error(<span class="string">'YMA:findjobj:IllegalPositionFilter'</span>,<span class="string">'Position filter must be a java UI component, or X,Y pair'</span>);
0731                     <span class="keyword">end</span>
0732                 <span class="keyword">else</span>
0733                     error(<span class="string">'YMA:findjobj:IllegalPositionFilter'</span>,<span class="string">'Position filter must be a java UI component, or X,Y pair'</span>);
0734                 <span class="keyword">end</span>
0735             <span class="keyword">end</span>
0736 
0737             <span class="comment">% Compute the required element positions in order to be eligible for a more detailed examination</span>
0738             <span class="comment">% Note: based on the following constraints: 0 &lt;= abs(elementX-filterX) + abs(elementY+elementH-filterY) &lt; 7</span>
0739             baseDeltas = [positions(:,1)-filterXY(1), positions(:,2)-filterXY(2)];  <span class="comment">% faster than repmat()...</span>
0740             <span class="comment">%baseHeight = - baseDeltas(:,2);% -abs(baseDeltas(:,1));</span>
0741             <span class="comment">%minHeight = baseHeight - 7;</span>
0742             <span class="comment">%maxHeight = baseHeight + 7;</span>
0743             <span class="comment">%foundIdx = ~arrayfun(@(b)(invoke(b,'contains',positionFilter)),handles);  % ARGH! - disallowed by Matlab!</span>
0744             <span class="comment">%foundIdx = repmat(false,1,length(handles));</span>
0745             <span class="comment">%foundIdx(length(handles)) = false;  % faster than repmat()...</span>
0746             foundIdx = (abs(baseDeltas(:,1)) &lt; 7) &amp; (abs(baseDeltas(:,2)) &lt; 7); <span class="comment">% &amp; (minHeight &gt;= 0);</span>
0747             <span class="comment">%fi = find(foundIdx);</span>
0748             <span class="comment">%for componentIdx = 1 : length(fi)</span>
0749                 <span class="comment">%foundIdx(componentIdx) = handles(componentIdx).getBounds.contains(positionFilter);</span>
0750 
0751                 <span class="comment">% Search for a point no farther than 7 pixels away (prevents rounding errors)</span>
0752                 <span class="comment">%foundIdx(componentIdx) = handles(componentIdx).getLocationOnScreen.distanceSq(positionFilter) &lt; 50;  % fails for invisible components...</span>
0753 
0754                 <span class="comment">%p = java.awt.Point(positions(componentIdx,1), positions(componentIdx,2) + handles(componentIdx).getHeight);</span>
0755                 <span class="comment">%foundIdx(componentIdx) = p.distanceSq(positionFilter) &lt; 50;</span>
0756 
0757                 <span class="comment">%foundIdx(componentIdx) = sum(([baseDeltas(componentIdx,1),baseDeltas(componentIdx,2)+handles(componentIdx).getHeight]).^2) &lt; 50;</span>
0758 
0759                 <span class="comment">% Following is the fastest method found to date: only eligible elements are checked in detailed</span>
0760             <span class="comment">%    elementHeight = handles(fi(componentIdx)).getHeight;</span>
0761             <span class="comment">%    foundIdx(fi(componentIdx)) = elementHeight &gt; minHeight(fi(componentIdx)) &amp;&amp; ...</span>
0762             <span class="comment">%                                 elementHeight &lt; maxHeight(fi(componentIdx));</span>
0763                 <span class="comment">%disp([componentIdx,elementHeight,minHeight(fi(componentIdx)),maxHeight(fi(componentIdx)),foundIdx(fi(componentIdx))])</span>
0764             <span class="comment">%end</span>
0765 
0766             varargin(2) = [];
0767         <span class="keyword">else</span>
0768             foundIdx = [];
0769         <span class="keyword">end</span>
0770     <span class="keyword">end</span>
0771 
0772     <span class="comment">%% Process 'size' option</span>
0773     <a name="_sub12" href="#_subfunctions" class="code">function [varargin,foundIdx] = processSizeArgs(varargin)</a>
0774         <span class="keyword">if</span> length(varargin)&gt;1
0775             sizeFilter = lower(varargin{2});
0776             <span class="comment">%if (isjava(sizeFilter) || iscom(sizeFilter)) &amp;&amp; ismethod(sizeFilter,'getSize')</span>
0777             <span class="keyword">try</span>  <span class="comment">% try-catch is faster...</span>
0778                 <span class="comment">% Java/COM object passed - get its size</span>
0779                 sizeFilter = sizeFilter.getSize;
0780                 filterWidth  = sizeFilter.getWidth;
0781                 filterHeight = sizeFilter.getHeight;
0782             <span class="keyword">catch</span>
0783                 <span class="keyword">if</span> ~isscalar(sizeFilter)
0784                     <span class="comment">% size vector passed</span>
0785                     <span class="keyword">if</span> (length(sizeFilter)&gt;=2) &amp;&amp; isnumeric(sizeFilter)
0786                         <span class="comment">%sizeFilter = java.awt.Dimension(sizeFilter(1),sizeFilter(2));</span>
0787                         filterWidth  = sizeFilter(1);
0788                         filterHeight = sizeFilter(2);
0789                     <span class="keyword">else</span>
0790                         error(<span class="string">'YMA:findjobj:IllegalSizeFilter'</span>,<span class="string">'Size filter must be a java UI component, or W,H pair'</span>);
0791                     <span class="keyword">end</span>
0792                 <span class="keyword">elseif</span> length(varargin)&gt;2
0793                     <span class="comment">% w,h passed as separate arg values</span>
0794                     <span class="keyword">if</span> isnumeric(sizeFilter) &amp;&amp; isnumeric(varargin{3})
0795                         <span class="comment">%sizeFilter = java.awt.Dimension(sizeFilter,varargin{3});</span>
0796                         filterWidth  = sizeFilter;
0797                         filterHeight = varargin{3};
0798                         varargin(3) = [];
0799                     <span class="keyword">else</span>
0800                         error(<span class="string">'YMA:findjobj:IllegalSizeFilter'</span>,<span class="string">'Size filter must be a java UI component, or W,H pair'</span>);
0801                     <span class="keyword">end</span>
0802                 <span class="keyword">else</span>
0803                     error(<span class="string">'YMA:findjobj:IllegalSizeFilter'</span>,<span class="string">'Size filter must be a java UI component, or W,H pair'</span>);
0804                 <span class="keyword">end</span>
0805             <span class="keyword">end</span>
0806             <span class="comment">%foundIdx = ~arrayfun(@(b)(invoke(b,'contains',sizeFilter)),handles);  % ARGH! - disallowed by Matlab!</span>
0807             foundIdx(length(handles)) = false;  <span class="comment">% faster than repmat()...</span>
0808             <span class="keyword">for</span> componentIdx = 1 : length(handles)
0809                 <span class="comment">%foundIdx(componentIdx) = handles(componentIdx).getSize.equals(sizeFilter);</span>
0810                 <span class="comment">% Allow a 2-pixel tollerance to account for non-integer pixel sizes</span>
0811                 foundIdx(componentIdx) = abs(handles(componentIdx).getWidth  - filterWidth)  &lt;= 3 &amp;&amp; <span class="keyword">...</span><span class="comment">  % faster than getSize.equals()</span>
0812                                          abs(handles(componentIdx).getHeight - filterHeight) &lt;= 3;
0813             <span class="keyword">end</span>
0814             varargin(2) = [];
0815         <span class="keyword">else</span>
0816             foundIdx = [];
0817         <span class="keyword">end</span>
0818     <span class="keyword">end</span>
0819 
0820     <span class="comment">%% Process 'class' option</span>
0821     <a name="_sub13" href="#_subfunctions" class="code">function [varargin,foundIdx] = processClassArgs(varargin)</a>
0822         <span class="keyword">if</span> length(varargin)&gt;1
0823             classFilter = varargin{2};
0824             <span class="comment">%if ismethod(classFilter,'getClass')</span>
0825             <span class="keyword">try</span>  <span class="comment">% try-catch is faster...</span>
0826                 classFilter = char(classFilter.getClass);
0827             <span class="keyword">catch</span>
0828                 <span class="keyword">if</span> ~<a href="#_sub50" class="code" title="subfunction flag = ischar(data)">ischar</a>(classFilter)
0829                     error(<span class="string">'YMA:findjobj:IllegalClassFilter'</span>,<span class="string">'Class filter must be a java object, class or string'</span>);
0830                 <span class="keyword">end</span>
0831             <span class="keyword">end</span>
0832 
0833             <span class="comment">% Now convert all java classes to java.lang.Strings and compare to the requested filter string</span>
0834             <span class="keyword">try</span>
0835                 foundIdx(length(handles)) = false;  <span class="comment">% faster than repmat()...</span>
0836                 jClassFilter = java.lang.String(classFilter).toLowerCase;
0837                 <span class="keyword">for</span> componentIdx = 1 : length(handles)
0838                     <span class="comment">% Note: JVM 1.5's String.contains() appears slightly slower and is available only since Matlab 7.2</span>
0839                     foundIdx(componentIdx) = handles(componentIdx).getClass.toString.toLowerCase.indexOf(jClassFilter) &gt;= 0;
0840                 <span class="keyword">end</span>
0841             <span class="keyword">catch</span>
0842                 <span class="comment">% Simple processing: slower since it does extra processing within opaque.char()</span>
0843                 <span class="keyword">for</span> componentIdx = 1 : length(handles)
0844                     <span class="comment">% Note: using @toChar is faster but returns java String, not a Matlab char</span>
0845                     foundIdx(componentIdx) = ~isempty(regexpi(char(handles(componentIdx).getClass),classFilter));
0846                 <span class="keyword">end</span>
0847             <span class="keyword">end</span>
0848 
0849             varargin(2) = [];
0850         <span class="keyword">else</span>
0851             foundIdx = [];
0852         <span class="keyword">end</span>
0853     <span class="keyword">end</span>
0854 
0855     <span class="comment">%% Process 'property' option</span>
0856     <a name="_sub14" href="#_subfunctions" class="code">function [varargin,foundIdx] = processPropertyArgs(varargin)</a>
0857         <span class="keyword">if</span> length(varargin)&gt;1
0858             propertyName = varargin{2};
0859             <span class="keyword">if</span> iscell(propertyName)
0860                 <span class="keyword">if</span> length(propertyName) == 2
0861                     propertyVal  = propertyName{2};
0862                     propertyName = propertyName{1};
0863                 <span class="keyword">elseif</span> length(propertyName) == 1
0864                     propertyName = propertyName{1};
0865                 <span class="keyword">else</span>
0866                     error(<span class="string">'YMA:findjobj:IllegalPropertyFilter'</span>,<span class="string">'Property filter must be a string (case insensitive name of property) or cell array {propName,propValue}'</span>);
0867                 <span class="keyword">end</span>
0868             <span class="keyword">end</span>
0869             <span class="keyword">if</span> ~<a href="#_sub50" class="code" title="subfunction flag = ischar(data)">ischar</a>(propertyName)
0870                 error(<span class="string">'YMA:findjobj:IllegalPropertyFilter'</span>,<span class="string">'Property filter must be a string (case insensitive name of property) or cell array {propName,propValue}'</span>);
0871             <span class="keyword">end</span>
0872             propertyName = lower(propertyName);
0873             <span class="comment">%foundIdx = arrayfun(@(h)isprop(h,propertyName),handles);  % ARGH! - disallowed by Matlab!</span>
0874             foundIdx(length(handles)) = false;  <span class="comment">% faster than repmat()...</span>
0875 
0876             <span class="comment">% Split processing depending on whether a specific property value was requested (ugly but faster...)</span>
0877             <span class="keyword">if</span> exist(<span class="string">'propertyVal'</span>,<span class="string">'var'</span>)
0878                 <span class="keyword">for</span> componentIdx = 1 : length(handles)
0879                     <span class="keyword">try</span>
0880                         <span class="comment">% Find out whether this element has the specified property</span>
0881                         <span class="comment">% Note: findprop() and its return value schema.prop are undocumented and unsupported!</span>
0882                         prop = findprop(handles(componentIdx),propertyName);  <span class="comment">% faster than isprop() &amp; enables partial property names</span>
0883 
0884                         <span class="comment">% If found, compare it to the actual element's property value</span>
0885                         foundIdx(componentIdx) = ~isempty(prop) &amp;&amp; isequal(get(handles(componentIdx),prop.Name),propertyVal);
0886                     <span class="keyword">catch</span>
0887                         <span class="comment">% Some Java classes have a write-only property (like LabelPeer with 'Text'), so we end up here</span>
0888                         <span class="comment">% In these cases, simply assume that the property value doesn't match and continue</span>
0889                         foundIdx(componentIdx) = false;
0890                     <span class="keyword">end</span>
0891                 <span class="keyword">end</span>
0892             <span class="keyword">else</span>
0893                 <span class="keyword">for</span> componentIdx = 1 : length(handles)
0894                     <span class="keyword">try</span>
0895                         <span class="comment">% Find out whether this element has the specified property</span>
0896                         <span class="comment">% Note: findprop() and its return value schema.prop are undocumented and unsupported!</span>
0897                         foundIdx(componentIdx) = ~isempty(findprop(handles(componentIdx),propertyName));
0898                     <span class="keyword">catch</span>
0899                         foundIdx(componentIdx) = false;
0900                     <span class="keyword">end</span>
0901                 <span class="keyword">end</span>
0902             <span class="keyword">end</span>
0903             varargin(2) = [];
0904         <span class="keyword">else</span>
0905             foundIdx = [];
0906         <span class="keyword">end</span>
0907     <span class="keyword">end</span>
0908 
0909     <span class="comment">%% Process 'depth' option</span>
0910     <a name="_sub15" href="#_subfunctions" class="code">function [varargin,foundIdx] = processDepthArgs(varargin)</a>
0911         <span class="keyword">if</span> length(varargin)&gt;1
0912             level = varargin{2};
0913             <span class="keyword">if</span> ~isnumeric(level)
0914                 error(<span class="string">'YMA:findjobj:IllegalDepthFilter'</span>,<span class="string">'Depth filter must be a number (=maximal element depth)'</span>);
0915             <span class="keyword">end</span>
0916             foundIdx = (levels &lt;= level);
0917             varargin(2) = [];
0918         <span class="keyword">else</span>
0919             foundIdx = [];
0920         <span class="keyword">end</span>
0921     <span class="keyword">end</span>
0922 
0923     <span class="comment">%% Convert property data into a string</span>
0924     <a name="_sub16" href="#_subfunctions" class="code">function data = charizeData(data)</a>
0925         <span class="keyword">if</span> isa(data,<span class="string">'com.mathworks.hg.types.HGCallback'</span>)
0926             data = get(data,<span class="string">'Callback'</span>);
0927         <span class="keyword">end</span>
0928         <span class="keyword">if</span> ~<a href="#_sub50" class="code" title="subfunction flag = ischar(data)">ischar</a>(data)
0929             newData = strtrim(evalc(<span class="string">'disp(data)'</span>));
0930             <span class="keyword">try</span>
0931                 newData = regexprep(newData,<span class="string">'  +'</span>,<span class="string">' '</span>);
0932                 newData = regexprep(newData,<span class="string">'Columns \d+ through \d+\s'</span>,<span class="string">''</span>);
0933                 newData = regexprep(newData,<span class="string">'Column \d+\s'</span>,<span class="string">''</span>);
0934             <span class="keyword">catch</span>
0935                 <span class="comment">%never mind...</span>
0936             <span class="keyword">end</span>
0937             <span class="keyword">if</span> iscell(data)
0938                 newData = [<span class="string">'{ '</span> newData <span class="string">' }'</span>];
0939             <span class="keyword">elseif</span> isempty(data)
0940                 newData = <span class="string">''</span>;
0941             <span class="keyword">elseif</span> isnumeric(data) || islogical(data) || any(ishandle(data)) || numel(data) &gt; 1 <span class="comment">%&amp;&amp; ~isscalar(data)</span>
0942                 newData = [<span class="string">'['</span> newData <span class="string">']'</span>];
0943             <span class="keyword">end</span>
0944             data = newData;
0945         <span class="keyword">elseif</span> ~isempty(data)
0946             data = [<span class="string">''''</span> data <span class="string">''''</span>];
0947         <span class="keyword">end</span>
0948     <span class="keyword">end</span>  <span class="comment">% charizeData</span>
0949 
0950     <span class="comment">%% Get callbacks table data</span>
0951     <a name="_sub17" href="#_subfunctions" class="code">function [cbData, cbHeaders, cbTableEnabled] = getCbsData(obj, stripStdCbsFlag)</a>
0952         classHdl = classhandle(handle(obj));
0953         cbNames = get(classHdl.Events,<span class="string">'Name'</span>);
0954         <span class="keyword">if</span> ~isempty(cbNames) &amp;&amp; ~iscom(obj)  <span class="comment">%only java-based please...</span>
0955             cbNames = strcat(cbNames,<span class="string">'Callback'</span>);
0956         <span class="keyword">end</span>
0957         propNames = get(classHdl.Properties,<span class="string">'Name'</span>);
0958         propCbIdx = [];
0959         <span class="keyword">if</span> ~isempty(propNames)
0960             propCbIdx = find(~cellfun(@isempty,regexp(propNames,<span class="string">'(Fcn|Callback)$'</span>)));
0961             cbNames = unique([cbNames; propNames(propCbIdx)]);  <span class="comment">%#ok logical is faster but less debuggable...</span>
0962         <span class="keyword">end</span>
0963         <span class="keyword">if</span> ~isempty(cbNames)
0964             <span class="keyword">if</span> stripStdCbsFlag
0965                 cbNames = <a href="#_sub35" class="code" title="subfunction evNames = stripStdCbs(evNames)">stripStdCbs</a>(cbNames);
0966             <span class="keyword">end</span>
0967             <span class="keyword">if</span> iscell(cbNames)
0968                 cbNames = sort(cbNames);
0969             <span class="keyword">end</span>
0970             hgHandleFlag = 0;  <span class="keyword">try</span> hgHandleFlag = ishghandle(obj); <span class="keyword">catch</span>, <span class="keyword">end</span>  <span class="comment">%#ok</span>
0971             <span class="keyword">try</span>
0972                 obj = handle(obj,<span class="string">'CallbackProperties'</span>);
0973             <span class="keyword">catch</span>
0974                 hgHandleFlag = 1;
0975             <span class="keyword">end</span>
0976             <span class="keyword">if</span> hgHandleFlag
0977                 <span class="comment">% HG handles don't allow CallbackProperties - search only for *Fcn</span>
0978                 cbNames = propNames(propCbIdx);
0979             <span class="keyword">end</span>
0980             <span class="keyword">if</span> iscom(obj)
0981                 cbs = obj.eventlisteners;
0982                 <span class="keyword">if</span> ~isempty(cbs)
0983                     cbNamesRegistered = cbs(:,1);
0984                     cbData = setdiff(cbNames,cbNamesRegistered);
0985                     <span class="comment">%cbData = charizeData(cbData);</span>
0986                     <span class="keyword">if</span> size(cbData,2) &gt; size(cbData(1))
0987                         cbData = cbData';
0988                     <span class="keyword">end</span>
0989                     cbData = [cbData, cellstr(repmat(<span class="string">' '</span>,length(cbData),1))];
0990                     cbData = [cbData; cbs];
0991                     [sortedNames, sortedIdx] = sort(cbData(:,1));
0992                     sortedCbs = cellfun(@<a href="#_sub16" class="code" title="subfunction data = charizeData(data)">charizeData</a>,cbData(sortedIdx,2),<span class="string">'un'</span>,0);
0993                     cbData = [sortedNames, sortedCbs];
0994                 <span class="keyword">else</span>
0995                     cbData = [cbNames, cellstr(repmat(<span class="string">' '</span>,length(cbNames),1))];
0996                 <span class="keyword">end</span>
0997             <span class="keyword">elseif</span> iscell(cbNames)
0998                 cbNames = sort(cbNames);
0999                 <span class="comment">%cbData = [cbNames, get(obj,cbNames)'];</span>
1000                 cbData = cbNames;
1001                 <span class="keyword">for</span> idx = 1 : length(cbNames)
1002                     <span class="keyword">try</span>
1003                         cbData{idx,2} = <a href="#_sub16" class="code" title="subfunction data = charizeData(data)">charizeData</a>(get(obj,cbNames{idx}));
1004                     <span class="keyword">catch</span>
1005                         cbData{idx,2} = <span class="string">'(callback value inaccessible)'</span>;
1006                     <span class="keyword">end</span>
1007                 <span class="keyword">end</span>
1008             <span class="keyword">else</span>  <span class="comment">% only one event callback</span>
1009                 <span class="comment">%cbData = {cbNames, get(obj,cbNames)'};</span>
1010                 <span class="comment">%cbData{1,2} = charizeData(cbData{1,2});</span>
1011                 <span class="keyword">try</span>
1012                     cbData = {cbNames, <a href="#_sub16" class="code" title="subfunction data = charizeData(data)">charizeData</a>(get(obj,cbNames))};
1013                 <span class="keyword">catch</span>
1014                     cbData = {cbNames, <span class="string">'(callback value inaccessible)'</span>};
1015                 <span class="keyword">end</span>
1016             <span class="keyword">end</span>
1017             cbHeaders = {<span class="string">'Callback name'</span>,<span class="string">'Callback value'</span>};
1018             cbTableEnabled = true;
1019         <span class="keyword">else</span>
1020             cbData = {<span class="string">'(no callbacks)'</span>};
1021             cbHeaders = {<span class="string">'Callback name'</span>};
1022             cbTableEnabled = false;
1023         <span class="keyword">end</span>
1024     <span class="keyword">end</span>  <span class="comment">% getCbsData</span>
1025 
1026     <span class="comment">%% Get relative (0.0-1.0) divider location</span>
1027     <a name="_sub18" href="#_subfunctions" class="code">function divLocation = getRalativeDivlocation(jDiv)</a>
1028         divLocation = jDiv.getDividerLocation;
1029         <span class="keyword">if</span> divLocation &gt; 1  <span class="comment">% i.e. [pixels]</span>
1030             visibleRect = jDiv.getVisibleRect;
1031             <span class="keyword">if</span> jDiv.getOrientation == 0  <span class="comment">% vertical</span>
1032                 start = visibleRect.getY;
1033                 extent = visibleRect.getHeight - start;
1034             <span class="keyword">else</span>
1035                 start = visibleRect.getX;
1036                 extent = visibleRect.getWidth - start;
1037             <span class="keyword">end</span>
1038             divLocation = (divLocation - start) / extent;
1039         <span class="keyword">end</span>
1040     <span class="keyword">end</span>  <span class="comment">% getRalativeDivlocation</span>
1041 
1042     <span class="comment">%% Try to set a treenode icon based on a container's icon</span>
1043     <a name="_sub19" href="#_subfunctions" class="code">function setTreeNodeIcon(treenode,container)</a>
1044         <span class="keyword">try</span>
1045             iconImage = [];
1046             iconImage = container.getIcon;
1047             <span class="keyword">if</span> ~isempty(findprop(handle(iconImage),<span class="string">'Image'</span>))  <span class="comment">% get(iconImage,'Image') is easier but leaks memory...</span>
1048                 iconImage = iconImage.getImage;
1049             <span class="keyword">else</span>
1050                 a=b; <span class="comment">%#ok cause an error</span>
1051             <span class="keyword">end</span>
1052         <span class="keyword">catch</span>
1053             <span class="keyword">try</span>
1054                 iconImage = container.getIconImage;
1055             <span class="keyword">catch</span>
1056                 <span class="keyword">try</span>
1057                     <span class="keyword">if</span> ~isempty(iconImage)
1058                         ge = java.awt.GraphicsEnvironment.getLocalGraphicsEnvironment;
1059                         gd = ge.getDefaultScreenDevice;
1060                         gc = gd.getDefaultConfiguration;
1061                         image = gc.createCompatibleImage(iconImage.getIconWidth, iconImage.getIconHeight);  <span class="comment">% a BufferedImage object</span>
1062                         g = image.createGraphics;
1063                         iconImage.paintIcon([], g, 0, 0);
1064                         g.dispose;
1065                         iconImage = image;
1066                     <span class="keyword">end</span>
1067                 <span class="keyword">catch</span>
1068                     <span class="comment">% never mind...</span>
1069                 <span class="keyword">end</span>
1070             <span class="keyword">end</span>
1071         <span class="keyword">end</span>
1072         <span class="keyword">if</span> ~isempty(iconImage)
1073             iconImage = <a href="#_sub32" class="code" title="subfunction iconImage = setIconSize(iconImage)">setIconSize</a>(iconImage);
1074             treenode.setIcon(iconImage);
1075         <span class="keyword">end</span>
1076     <span class="keyword">end</span>  <span class="comment">% setTreeNodeIcon</span>
1077 
1078     <span class="comment">%% Present the object hierarchy tree</span>
1079     <a name="_sub20" href="#_subfunctions" class="code">function presentObjectTree()</a>
1080         import java.awt.*
1081         import javax.swing.*
1082         hTreeFig = findall(0,<span class="string">'tag'</span>,<span class="string">'findjobjFig'</span>);
1083         iconpath = [matlabroot, <span class="string">'/toolbox/matlab/icons/'</span>];
1084         cbHideStd = 0;  <span class="comment">% Initial state of the cbHideStdCbs checkbox</span>
1085         <span class="keyword">if</span> isempty(hTreeFig)
1086             <span class="comment">% Prepare the figure</span>
1087             hTreeFig = figure(<span class="string">'tag'</span>,<span class="string">'findjobjFig'</span>,<span class="string">'menuBar'</span>,<span class="string">'none'</span>,<span class="string">'toolBar'</span>,<span class="string">'none'</span>,<span class="string">'Name'</span>,<span class="string">'FindJObj'</span>,<span class="string">'NumberTitle'</span>,<span class="string">'off'</span>,<span class="string">'handleVisibility'</span>,<span class="string">'off'</span>,<span class="string">'IntegerHandle'</span>,<span class="string">'off'</span>);
1088             figIcon = ImageIcon([iconpath <span class="string">'tool_legend.gif'</span>]);
1089             drawnow;
1090             <span class="keyword">try</span>
1091                 mde = com.mathworks.mde.desk.MLDesktop.getInstance;
1092                 jTreeFig = mde.getClient(<span class="string">'FindJObj'</span>).getTopLevelAncestor;
1093                 jTreeFig.setIcon(figIcon);
1094             <span class="keyword">catch</span>
1095                 warning(<span class="string">'off'</span>,<span class="string">'MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame'</span>);  <span class="comment">% R2008b compatibility</span>
1096                 jTreeFig = get(hTreeFig,<span class="string">'JavaFrame'</span>);
1097                 jTreeFig.setFigureIcon(figIcon);
1098             <span class="keyword">end</span>
1099             vsplitPaneLocation = 0.8;
1100             hsplitPaneLocation = 0.5;
1101         <span class="keyword">else</span>
1102             <span class="comment">% Remember cbHideStdCbs checkbox &amp; dividers state for later</span>
1103             userdata = get(hTreeFig, <span class="string">'userdata'</span>);
1104             <span class="keyword">try</span> cbHideStd = userdata.cbHideStdCbs.isSelected; <span class="keyword">catch</span>, <span class="keyword">end</span>  <span class="comment">%#ok</span>
1105             vsplitPaneLocation = <a href="#_sub18" class="code" title="subfunction divLocation = getRalativeDivlocation(jDiv)">getRalativeDivlocation</a>(userdata.vsplitPane);
1106             hsplitPaneLocation = <a href="#_sub18" class="code" title="subfunction divLocation = getRalativeDivlocation(jDiv)">getRalativeDivlocation</a>(userdata.hsplitPane);
1107 
1108             <span class="comment">% Clear the figure and redraw</span>
1109             clf(hTreeFig);
1110             figure(hTreeFig);   <span class="comment">% bring to front</span>
1111         <span class="keyword">end</span>
1112 
1113         <span class="comment">% Traverse all HG children, if root container was a HG handle</span>
1114         <span class="keyword">if</span> ishghandle(origContainer) <span class="comment">%&amp;&amp; ~isequal(origContainer,container)</span>
1115             <a href="#_sub48" class="code" title="subfunction traverseHGContainer(hcontainer,level,parent)">traverseHGContainer</a>(origContainer,0,0);
1116         <span class="keyword">end</span>
1117 
1118         <span class="comment">% Prepare the tree pane</span>
1119         warning(<span class="string">'off'</span>,<span class="string">'MATLAB:uitreenode:MigratingFunction'</span>);  <span class="comment">% R2008b compatibility</span>
1120         warning(<span class="string">'off'</span>,<span class="string">'MATLAB:uitreenode:DeprecatedFunction'</span>); <span class="comment">% R2008a compatibility</span>
1121         tree_h = com.mathworks.hg.peer.UITreePeer;
1122         hasChildren = sum(allParents==1) &gt; 1;
1123         icon = [iconpath <span class="string">'upfolder.gif'</span>];
1124         [rootName, rootTitle] = <a href="#_sub34" class="code" title="subfunction [nodeName, nodeTitle] = getNodeName(hndl,charsLimit)">getNodeName</a>(container);
1125         <span class="keyword">try</span>
1126             root = uitreenode(<span class="string">'v0'</span>, handle(container), rootName, icon, ~hasChildren);
1127         <span class="keyword">catch</span>  <span class="comment">% old matlab version don't have the 'v0' option</span>
1128             root = uitreenode(handle(container), rootName, icon, ~hasChildren);
1129         <span class="keyword">end</span>
1130         <a href="#_sub19" class="code" title="subfunction setTreeNodeIcon(treenode,container)">setTreeNodeIcon</a>(root,container);  <span class="comment">% constructor must accept a char icon unfortunately, so need to do this afterwards...</span>
1131         <span class="keyword">if</span> ~isempty(rootTitle)
1132             set(hTreeFig, <span class="string">'Name'</span>,[<span class="string">'FindJObj - '</span> char(rootTitle)]);
1133         <span class="keyword">end</span>
1134         nodedata.idx = 1;
1135         nodedata.obj = container;
1136         set(root,<span class="string">'userdata'</span>,nodedata);
1137         root.setUserObject(container);
1138         setappdata(root,<span class="string">'childHandle'</span>,container);
1139         tree_h.setRoot(root);
1140         treePane = tree_h.getScrollPane;
1141         treePane.setMinimumSize(Dimension(50,50));
1142         jTreeObj = treePane.getViewport.getComponent(0);
1143         jTreeObj.setShowsRootHandles(true)
1144         jTreeObj.getSelectionModel.setSelectionMode(javax.swing.tree.TreeSelectionModel.DISCONTIGUOUS_TREE_SELECTION);
1145         <span class="comment">%jTreeObj.setVisible(0);</span>
1146         <span class="comment">%jTreeObj.getCellRenderer.setLeafIcon([]);</span>
1147         <span class="comment">%jTreeObj.getCellRenderer.setOpenIcon(figIcon);</span>
1148         <span class="comment">%jTreeObj.getCellRenderer.setClosedIcon([]);</span>
1149         treePanel = JPanel(BorderLayout);
1150         treePanel.add(treePane, BorderLayout.CENTER);
1151         progressBar = JProgressBar(0);
1152         progressBar.setMaximum(length(allHandles) + length(hg_handles));  <span class="comment">% = # of all nodes</span>
1153         treePanel.add(progressBar, BorderLayout.SOUTH);
1154 
1155         <span class="comment">% Prepare the image pane</span>
1156 <span class="comment">%disable for now, until we get it working...</span>
1157 <span class="comment">%{</span>
1158         <span class="keyword">try</span>
1159             hFig = ancestor(origContainer,<span class="string">'figure'</span>);
1160             [cdata, cm] = getframe(hFig);  <span class="comment">%#ok cm unused</span>
1161             tempfname = [tempname <span class="string">'.png'</span>];
1162             imwrite(cdata,tempfname);  <span class="comment">% don't know how to pass directly to BufferedImage, so use disk...</span>
1163             jImg = javax.imageio.ImageIO.read(java.io.File(tempfname));
1164             <span class="keyword">try</span> delete(tempfname);  <span class="keyword">catch</span>  <span class="keyword">end</span>
1165             imgPanel = JPanel();
1166             leftPanel = JSplitPane(JSplitPane.VERTICAL_SPLIT, treePanel, imgPanel);
1167             leftPanel.setOneTouchExpandable(true);
1168             leftPanel.setContinuousLayout(true);
1169             leftPanel.setResizeWeight(0.8);
1170         <span class="keyword">catch</span>
1171             leftPanel = treePanel;
1172         <span class="keyword">end</span>
1173 <span class="comment">%}</span>
1174         leftPanel = treePanel;
1175 
1176         <span class="comment">% Prepare the inspector pane</span>
1177         classNameLabel = JLabel([<span class="string">'      '</span> char(container.class)]);
1178         classNameLabel.setForeground(Color.blue);
1179         <a href="#_sub30" class="code" title="subfunction updateNodeTooltip(nodeHandle, uiObject)">updateNodeTooltip</a>(container, classNameLabel);
1180         inspectorPanel = JPanel(BorderLayout);
1181         inspectorPanel.add(classNameLabel, BorderLayout.NORTH);
1182         <span class="comment">% TODO: Maybe uncomment the following when we add the HG tree - in the meantime it's unused (java properties are un-groupable)</span>
1183         <span class="comment">%objReg = com.mathworks.services.ObjectRegistry.getLayoutRegistry;</span>
1184         <span class="comment">%toolBar = awtinvoke('com.mathworks.mlwidgets.inspector.PropertyView$ToolBarStyle','valueOf(Ljava.lang.String;)','GROUPTOOLBAR');</span>
1185         <span class="comment">%inspectorPane = com.mathworks.mlwidgets.inspector.PropertyView(objReg, toolBar);</span>
1186         inspectorPane = com.mathworks.mlwidgets.inspector.PropertyView;
1187         identifiers = <a href="#_sub22" class="code" title="subfunction identifiers = disableDbstopError">disableDbstopError</a>;  <span class="comment">%#ok &quot;dbstop if error&quot; causes inspect.m to croak due to a bug - so workaround</span>
1188         inspectorPane.setObject(container);
1189         inspectorPane.setAutoUpdate(true);
1190         <span class="comment">% TODO: Add property listeners</span>
1191         <span class="comment">% TODO: Display additional props</span>
1192         inspectorTable = inspectorPane;
1193         <span class="keyword">try</span>
1194             <span class="keyword">while</span> ~isa(inspectorTable,<span class="string">'javax.swing.JTable'</span>)
1195                 inspectorTable = inspectorTable.getComponent(0);
1196             <span class="keyword">end</span>
1197         <span class="keyword">catch</span>
1198             <span class="comment">% R2010a</span>
1199             inspectorTable = inspectorPane.getComponent(0).getScrollPane.getViewport.getComponent(0);
1200         <span class="keyword">end</span>
1201         toolTipText = <span class="string">'hover mouse over the red classname above to see the full list of properties'</span>;
1202         inspectorTable.setToolTipText(toolTipText);
1203         jideTableUtils = [];
1204         <span class="keyword">try</span>
1205             <span class="comment">% Try JIDE features - see http://www.jidesoft.com/products/JIDE_Grids_Developer_Guide.pdf</span>
1206             com.mathworks.mwswing.MJUtilities.initJIDE;
1207             jideTableUtils = eval(<span class="string">'com.jidesoft.grid.TableUtils;'</span>);  <span class="comment">% prevent JIDE alert by run-time (not load-time) evaluation</span>
1208             jideTableUtils.autoResizeAllColumns(inspectorTable);
1209             inspectorTable.setRowAutoResizes(true);
1210             inspectorTable.getModel.setShowExpert(1);
1211         <span class="keyword">catch</span>
1212             <span class="comment">% JIDE is probably unavailable - never mind...</span>
1213         <span class="keyword">end</span>
1214         inspectorPanel.add(inspectorPane, BorderLayout.CENTER);
1215         <span class="comment">% TODO: Add data update listeners</span>
1216 
1217         <span class="comment">% Prepare the callbacks pane</span>
1218         callbacksPanel = JPanel(BorderLayout);
1219         classHdl = classhandle(handle(container));
1220         eventNames = get(classHdl.Events,<span class="string">'Name'</span>);
1221         <span class="keyword">if</span> ~isempty(eventNames)
1222             cbNames = sort(strcat(eventNames,<span class="string">'Callback'</span>));
1223             <span class="keyword">try</span>
1224                 cbData = [cbNames, get(container,cbNames)'];
1225             <span class="keyword">catch</span>
1226                 <span class="comment">% R2010a</span>
1227                 cbData = cbNames;
1228                 <span class="keyword">if</span> isempty(cbData)
1229                     cbData = {};
1230                 <span class="keyword">elseif</span> ~iscell(cbData)
1231                     cbData = {cbData};
1232                 <span class="keyword">end</span>
1233                 <span class="keyword">for</span> idx = 1 : length(cbNames)
1234                     cbData{idx,2} = get(container,cbNames{idx});
1235                 <span class="keyword">end</span>
1236             <span class="keyword">end</span>
1237             cbTableEnabled = true;
1238         <span class="keyword">else</span>
1239             cbData = {<span class="string">'(no callbacks)'</span>,<span class="string">''</span>};
1240             cbTableEnabled = false;
1241         <span class="keyword">end</span>
1242         cbHeaders = {<span class="string">'Callback name'</span>,<span class="string">'Callback value'</span>};
1243         <span class="keyword">try</span>
1244             <span class="comment">% Use JideTable if available on this system</span>
1245             <span class="comment">%callbacksTableModel = javax.swing.table.DefaultTableModel(cbData,cbHeaders);  %#ok</span>
1246             <span class="comment">%callbacksTable = eval('com.jidesoft.grid.PropertyTable(callbacksTableModel);');  % prevent JIDE alert by run-time (not load-time) evaluation</span>
1247             callbacksTable = eval(<span class="string">'com.jidesoft.grid.TreeTable(cbData,cbHeaders);'</span>);  <span class="comment">% prevent JIDE alert by run-time (not load-time) evaluation</span>
1248             callbacksTable.setRowAutoResizes(true);
1249             callbacksTable.setColumnAutoResizable(true);
1250             callbacksTable.setColumnResizable(true);
1251             jideTableUtils.autoResizeAllColumns(callbacksTable);
1252             callbacksTable.setTableHeader([]);  <span class="comment">% hide the column headers since now we can resize columns with the gridline</span>
1253             callbacksLabel = JLabel(<span class="string">' Callbacks:'</span>);  <span class="comment">% The column headers are replaced with a header label</span>
1254             <span class="comment">%callbacksPanel.add(callbacksLabel, BorderLayout.NORTH);</span>
1255 
1256             <span class="comment">% Add checkbox to show/hide standard callbacks</span>
1257             callbacksTopPanel = JPanel;
1258             callbacksTopPanel.setLayout(BoxLayout(callbacksTopPanel, BoxLayout.LINE_AXIS));
1259             callbacksTopPanel.add(callbacksLabel);
1260             callbacksTopPanel.add(Box.createHorizontalGlue);
1261             jcb = JCheckBox(<span class="string">'Hide standard callbacks'</span>, cbHideStd);
1262             set(jcb, <span class="string">'ActionPerformedCallback'</span>,@<a href="#_sub36" class="code" title="subfunction cbHideStdCbs_Callback(src, evd, varargin)  ">cbHideStdCbs_Callback</a>, <span class="string">'userdata'</span>,callbacksTable, <span class="string">'tooltip'</span>,<span class="string">'Hide standard Swing callbacks - only component-specific callbacks will be displayed'</span>);
1263             callbacksTopPanel.add(jcb);
1264             callbacksPanel.add(callbacksTopPanel, BorderLayout.NORTH);
1265         <span class="keyword">catch</span>
1266             <span class="comment">% Otherwise, use a standard Swing JTable (keep the headers to enable resizing)</span>
1267             callbacksTable = JTable(cbData,cbHeaders);
1268         <span class="keyword">end</span>
1269         cbToolTipText = <span class="string">'Callbacks may be ''strings'', @funcHandle or {@funcHandle,arg1,...}'</span>;
1270         callbacksTable.setToolTipText(cbToolTipText);
1271         callbacksTable.setGridColor(inspectorTable.getGridColor);
1272         cbNameTextField = JTextField;
1273         cbNameTextField.setEditable(false);  <span class="comment">% ensure that the callback names are not modified...</span>
1274         cbNameCellEditor = DefaultCellEditor(cbNameTextField);
1275         cbNameCellEditor.setClickCountToStart(intmax);  <span class="comment">% i.e, never enter edit mode...</span>
1276         callbacksTable.getColumnModel.getColumn(0).setCellEditor(cbNameCellEditor);
1277         <span class="keyword">if</span> ~cbTableEnabled
1278             callbacksTable.getColumnModel.getColumn(1).setCellEditor(cbNameCellEditor);
1279         <span class="keyword">end</span>
1280         set(callbacksTable.getModel, <span class="string">'TableChangedCallback'</span>,@<a href="#_sub45" class="code" title="subfunction tbCallbacksChanged(src, evd)">tbCallbacksChanged</a>, <span class="string">'UserData'</span>,container);
1281         cbScrollPane = JScrollPane(callbacksTable);
1282         cbScrollPane.setVerticalScrollBarPolicy(cbScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED);
1283         callbacksPanel.add(cbScrollPane, BorderLayout.CENTER);
1284         callbacksPanel.setToolTipText(cbToolTipText);
1285 
1286         <span class="comment">% Prepare the top-bottom JSplitPanes</span>
1287         vsplitPane = JSplitPane(JSplitPane.VERTICAL_SPLIT, inspectorPanel, callbacksPanel);
1288         vsplitPane.setOneTouchExpandable(true);
1289         vsplitPane.setContinuousLayout(true);
1290         vsplitPane.setResizeWeight(0.8);
1291 
1292         <span class="comment">% Prepare the left-right JSplitPane</span>
1293         hsplitPane = JSplitPane(JSplitPane.HORIZONTAL_SPLIT, leftPanel, vsplitPane);
1294         hsplitPane.setOneTouchExpandable(true);
1295         hsplitPane.setContinuousLayout(true);
1296         hsplitPane.setResizeWeight(0.6);
1297         pos = getpixelposition(hTreeFig);
1298 
1299         <span class="comment">% Prepare the bottom pane with all buttons</span>
1300         lowerPanel = JPanel(FlowLayout);
1301         blogUrlLabel = <span class="string">'&lt;a href=&quot;http://UndocumentedMatlab.com&quot;&gt;Undocumented&lt;br&gt;Matlab.com&lt;/a&gt;'</span>;
1302         jWebsite = <a href="#_sub25" class="code" title="subfunction hButton = createJButton(nameStr, handler, toolTipText)">createJButton</a>(blogUrlLabel, @<a href="#_sub37" class="code" title="subfunction btWebsite_Callback(src, evd, varargin)  ">btWebsite_Callback</a>, <span class="string">'Visit the UndocumentedMatlab.com blog'</span>);
1303         jWebsite.setContentAreaFilled(0);
1304         lowerPanel.add(jWebsite);
1305         lowerPanel.add(<a href="#_sub25" class="code" title="subfunction hButton = createJButton(nameStr, handler, toolTipText)">createJButton</a>(<span class="string">'Refresh&lt;br&gt;tree'</span>,        {@<a href="#_sub38" class="code" title="subfunction btRefresh_Callback(src, evd, varargin)  ">btRefresh_Callback</a>, origContainer, hTreeFig}, <span class="string">'Rescan the component tree, from the root down'</span>));
1306         lowerPanel.add(<a href="#_sub25" class="code" title="subfunction hButton = createJButton(nameStr, handler, toolTipText)">createJButton</a>(<span class="string">'Export to&lt;br&gt;workspace'</span>, {@<a href="#_sub39" class="code" title="subfunction btExport_Callback(src, evd, varargin)  ">btExport_Callback</a>,  jTreeObj, classNameLabel}, <span class="string">'Export the selected component handles to workspace variable findjobj_hdls'</span>));
1307         lowerPanel.add(<a href="#_sub25" class="code" title="subfunction hButton = createJButton(nameStr, handler, toolTipText)">createJButton</a>(<span class="string">'Request&lt;br&gt;focus'</span>,       {@<a href="#_sub40" class="code" title="subfunction btFocus_Callback(src, evd, varargin)  ">btFocus_Callback</a>,   jTreeObj, root}, <span class="string">'Set the focus on the first selected component'</span>));
1308         lowerPanel.add(<a href="#_sub25" class="code" title="subfunction hButton = createJButton(nameStr, handler, toolTipText)">createJButton</a>(<span class="string">'Inspect&lt;br&gt;object'</span>,      {@<a href="#_sub41" class="code" title="subfunction btInspect_Callback(src, evd, varargin)  ">btInspect_Callback</a>, jTreeObj, root}, <span class="string">'View the signature of all methods supported by the first selected component'</span>));
1309         lowerPanel.add(<a href="#_sub25" class="code" title="subfunction hButton = createJButton(nameStr, handler, toolTipText)">createJButton</a>(<span class="string">'Check for&lt;br&gt;updates'</span>,   {@<a href="#_sub42" class="code" title="subfunction btCheckFex_Callback(src, evd, varargin)  ">btCheckFex_Callback</a>}, <span class="string">'Check the MathWorks FileExchange for the latest version of FindJObj'</span>));
1310 
1311         <span class="comment">% Display everything on-screen</span>
1312         globalPanel = JPanel(BorderLayout);
1313         globalPanel.add(hsplitPane, BorderLayout.CENTER);
1314         globalPanel.add(lowerPanel, BorderLayout.SOUTH);
1315         [obj, hcontainer] = javacomponent(globalPanel, [0,0,pos(3:4)], hTreeFig);
1316         set(hcontainer,<span class="string">'units'</span>,<span class="string">'normalized'</span>);
1317         drawnow;
1318         hsplitPane.setDividerLocation(hsplitPaneLocation);  <span class="comment">% this only works after the JSplitPane is displayed...</span>
1319         vsplitPane.setDividerLocation(vsplitPaneLocation);  <span class="comment">% this only works after the JSplitPane is displayed...</span>
1320         <span class="comment">%restoreDbstopError(identifiers);</span>
1321 
1322         <span class="comment">% Refresh &amp; resize the screenshot thumbnail</span>
1323 <span class="comment">%disable for now, until we get it working...</span>
1324 <span class="comment">%{</span>
1325         <span class="keyword">try</span>
1326             hAx = axes(<span class="string">'Parent'</span>,hTreeFig, <span class="string">'units'</span>,<span class="string">'pixels'</span>, <span class="string">'position'</span>,[10,10,250,150], <span class="string">'visible'</span>,<span class="string">'off'</span>);
1327             axis(hAx,<span class="string">'image'</span>);
1328             image(cdata,<span class="string">'Parent'</span>,hAx);
1329             axis(hAx,<span class="string">'off'</span>);
1330             set(hAx,<span class="string">'UserData'</span>,cdata);
1331             set(imgPanel, <span class="string">'ComponentResizedCallback'</span>,{@<a href="#_sub21" class="code" title="subfunction resizeImg(varargin)  ">resizeImg</a>, hAx}, <span class="string">'UserData'</span>,lowerPanel);
1332             imgPanel.getGraphics.drawImage(jImg, 0, 0, []);
1333         <span class="keyword">catch</span>
1334             <span class="comment">% Never mind...</span>
1335         <span class="keyword">end</span>
1336 <span class="comment">%}</span>
1337         <span class="comment">% If all handles were selected (i.e., none were filtered) then only select the first</span>
1338         <span class="keyword">if</span> (length(selectedIdx) == length(allHandles)) &amp;&amp; ~isempty(selectedIdx)
1339             selectedIdx = 1;
1340         <span class="keyword">end</span>
1341 
1342         <span class="comment">% Store handles for callback use</span>
1343         userdata.handles = allHandles;
1344         userdata.levels  = allLevels;
1345         userdata.parents = allParents;
1346         userdata.hg_handles = hg_handles;
1347         userdata.hg_levels  = hg_levels;
1348         userdata.hg_parents = hg_parentIdx;
1349         userdata.initialIdx = selectedIdx;
1350         userdata.userSelected = false;  <span class="comment">% Indicates the user has modified the initial selections</span>
1351         userdata.inInit = true;
1352         userdata.jTree = jTreeObj;
1353         userdata.jTreePeer = tree_h;
1354         userdata.vsplitPane = vsplitPane;
1355         userdata.hsplitPane = hsplitPane;
1356         userdata.classNameLabel = classNameLabel;
1357         userdata.inspectorPane = inspectorPane;
1358         userdata.callbacksTable = callbacksTable;
1359         userdata.jideTableUtils = jideTableUtils;
1360         <span class="keyword">try</span>
1361             userdata.cbHideStdCbs = jcb;
1362         <span class="keyword">catch</span>
1363             userdata.cbHideStdCbs = [];
1364         <span class="keyword">end</span>
1365 
1366         set(tree_h,        <span class="string">'userdata'</span>,userdata);
1367         set(hTreeFig,      <span class="string">'userdata'</span>,userdata);
1368         set(callbacksTable,<span class="string">'userdata'</span>,userdata);
1369 
1370         <span class="comment">% Select the root node if requested</span>
1371         <span class="comment">% Note: we must do so here since all other nodes except the root are processed by expandNode</span>
1372         <span class="keyword">if</span> any(selectedIdx==1)
1373             tree_h.setSelectedNode(root);
1374         <span class="keyword">end</span>
1375 
1376         <span class="comment">% Set the initial cbHideStdCbs state</span>
1377         <span class="keyword">try</span>
1378             <span class="keyword">if</span> jcb.isSelected
1379                 drawnow;
1380                 evd.getSource.isSelected = jcb.isSelected;
1381                 <a href="#_sub36" class="code" title="subfunction cbHideStdCbs_Callback(src, evd, varargin)  ">cbHideStdCbs_Callback</a>(jcb,evd);
1382             <span class="keyword">end</span>
1383         <span class="keyword">catch</span>
1384             <span class="comment">% never mind...</span>
1385         <span class="keyword">end</span>
1386 
1387         <span class="comment">% Set the callback functions</span>
1388         set(tree_h, <span class="string">'NodeExpandedCallback'</span>, {@<a href="#_sub31" class="code" title="subfunction nodeExpanded(src, evd, tree)  ">nodeExpanded</a>, tree_h});
1389         set(tree_h, <span class="string">'NodeSelectedCallback'</span>, {@<a href="#_sub27" class="code" title="subfunction nodeSelected(src, evd, tree)  ">nodeSelected</a>, tree_h});
1390 
1391         <span class="comment">% Set the tree mouse-click callback</span>
1392         <span class="comment">% Note: default actions (expand/collapse) will still be performed?</span>
1393         <span class="comment">% Note: MousePressedCallback is better than MouseClickedCallback</span>
1394         <span class="comment">%       since it fires immediately when mouse button is pressed,</span>
1395         <span class="comment">%       without waiting for its release, as MouseClickedCallback does</span>
1396         handleTree = tree_h.getScrollPane;
1397         jTreeObj = handleTree.getViewport.getComponent(0);
1398         set(jTreeObj, <span class="string">'MousePressedCallback'</span>, {@<a href="#_sub52" class="code" title="subfunction treeMousePressedCallback(hTree, eventData, tree_h)  ">treeMousePressedCallback</a>,tree_h});  <span class="comment">% context (right-click) menu</span>
1399         set(jTreeObj, <span class="string">'MouseMovedCallback'</span>,   @<a href="#_sub55" class="code" title="subfunction treeMouseMovedCallback(hTree, eventData)">treeMouseMovedCallback</a>);    <span class="comment">% mouse hover tooltips</span>
1400 
1401         <span class="comment">% Pre-expand all rows</span>
1402         <a href="#_sub24" class="code" title="subfunction expandNode(progressBar, tree, tree_h, parentNode, parentRow)">expandNode</a>(progressBar, jTreeObj, tree_h, root, 0);
1403         <span class="comment">%jTreeObj.setVisible(1);</span>
1404 
1405         <span class="comment">% Hide the progressbar now that we've finished expanding all rows</span>
1406         <span class="keyword">try</span>
1407             hsplitPane.getLeftComponent.setTopComponent(treePane);
1408         <span class="keyword">catch</span>
1409             <span class="comment">% Probably not a vSplitPane on the left...</span>
1410             hsplitPane.setLeftComponent(treePane);
1411         <span class="keyword">end</span>
1412         hsplitPane.setDividerLocation(hsplitPaneLocation);  <span class="comment">% need to do it again...</span>
1413 
1414         <span class="comment">% Update userdata</span>
1415         userdata.inInit = false;
1416         set(tree_h,  <span class="string">'userdata'</span>,userdata);
1417         set(hTreeFig,<span class="string">'userdata'</span>,userdata);
1418 
1419         <span class="comment">% Set keyboard focus on the tree</span>
1420         jTreeObj.requestFocus;
1421         drawnow;
1422 
1423         <span class="comment">% Check for a newer version</span>
1424         <a href="#_sub43" class="code" title="subfunction checkVersion()">checkVersion</a>();
1425 
1426         <span class="comment">% Reset the last error</span>
1427         lasterr(<span class="string">''</span>);  <span class="comment">%#ok</span>
1428     <span class="keyword">end</span>
1429 
1430     <span class="comment">%% Rresize image pane</span>
1431     <a name="_sub21" href="#_subfunctions" class="code">function resizeImg(varargin)  </a><span class="comment">%#ok - unused (TODO: waiting for img placement fix...)</span>
1432         <span class="keyword">try</span>
1433             hPanel = varargin{1};
1434             hAx    = varargin{3};
1435             lowerPanel = get(hPanel,<span class="string">'UserData'</span>);
1436             newJPos = cell2mat(get(hPanel,{<span class="string">'X'</span>,<span class="string">'Y'</span>,<span class="string">'Width'</span>,<span class="string">'Height'</span>}));
1437             newMPos = [1,get(lowerPanel,<span class="string">'Height'</span>),newJPos(3:4)];
1438             set(hAx, <span class="string">'units'</span>,<span class="string">'pixels'</span>, <span class="string">'position'</span>,newMPos, <span class="string">'Visible'</span>,<span class="string">'on'</span>);
1439             uistack(hAx,<span class="string">'top'</span>);  <span class="comment">% no good...</span>
1440             set(hPanel,<span class="string">'Opaque'</span>,<span class="string">'off'</span>);  <span class="comment">% also no good...</span>
1441         <span class="keyword">catch</span>
1442             <span class="comment">% Never mind...</span>
1443             <a href="#_sub49" class="code" title="subfunction dispError">dispError</a>
1444         <span class="keyword">end</span>
1445         <span class="keyword">return</span>;
1446     <span class="keyword">end</span>
1447 
1448     <span class="comment">%% &quot;dbstop if error&quot; causes inspect.m to croak due to a bug - so workaround by temporarily disabling this dbstop</span>
1449     <a name="_sub22" href="#_subfunctions" class="code">function identifiers = disableDbstopError</a>
1450         dbStat = dbstatus;
1451         idx = find(strcmp({dbStat.cond},<span class="string">'error'</span>));
1452         identifiers = [dbStat(idx).identifier];
1453         <span class="keyword">if</span> ~isempty(idx)
1454             dbclear <span class="keyword">if</span> error;
1455             msgbox(<span class="string">'''dbstop if error'' had to be disabled due to a Matlab bug that would have caused Matlab to crash.'</span>, <span class="string">'FindJObj'</span>, <span class="string">'warn'</span>);
1456         <span class="keyword">end</span>
1457     <span class="keyword">end</span>
1458 
1459     <span class="comment">%% Restore any previous &quot;dbstop if error&quot;</span>
1460     <a name="_sub23" href="#_subfunctions" class="code">function restoreDbstopError(identifiers)  </a><span class="comment">%#ok</span>
1461         <span class="keyword">for</span> itemIdx = 1 : length(identifiers)
1462             eval([<span class="string">'dbstop if error '</span> identifiers{itemIdx}]);
1463         <span class="keyword">end</span>
1464     <span class="keyword">end</span>
1465 
1466     <span class="comment">%% Recursively expand all nodes (except toolbar/menubar) in startup</span>
1467     <a name="_sub24" href="#_subfunctions" class="code">function expandNode(progressBar, tree, tree_h, parentNode, parentRow)</a>
1468         <span class="keyword">try</span>
1469             <span class="keyword">if</span> nargin &lt; 5
1470                 parentPath = javax.swing.tree.TreePath(parentNode.getPath);
1471                 parentRow = tree.getRowForPath(parentPath);
1472             <span class="keyword">end</span>
1473             tree.expandRow(parentRow);
1474             progressBar.setValue(progressBar.getValue+1);
1475             numChildren = parentNode.getChildCount;
1476             <span class="keyword">if</span> (numChildren == 0)
1477                 pause(0.0002);  <span class="comment">% as short as possible...</span>
1478                 drawnow;
1479             <span class="keyword">end</span>
1480             nodesToUnExpand = {<span class="string">'FigureMenuBar'</span>,<span class="string">'MLMenuBar'</span>,<span class="string">'MJToolBar'</span>,<span class="string">'Box'</span>,<span class="string">'uimenu'</span>,<span class="string">'uitoolbar'</span>,<span class="string">'ScrollBar'</span>};
1481             numChildren = parentNode.getChildCount;
1482             <span class="keyword">for</span> childIdx = 0 : numChildren-1
1483                 childNode = parentNode.getChildAt(childIdx);
1484 
1485                 <span class="comment">% Pre-select the node based upon the user's FINDJOBJ filters</span>
1486                 <span class="keyword">try</span>
1487                     nodedata = get(childNode, <span class="string">'userdata'</span>);
1488                     userdata = get(tree_h, <span class="string">'userdata'</span>);
1489                     <span class="comment">%fprintf('%d - %s\n',nodedata.idx,char(nodedata.obj))</span>
1490                     <span class="keyword">if</span> ~ishghandle(nodedata.obj) &amp;&amp; ~userdata.userSelected &amp;&amp; any(userdata.initialIdx == nodedata.idx)
1491                         pause(0.0002);  <span class="comment">% as short as possible...</span>
1492                         drawnow;
1493                         <span class="keyword">if</span> isempty(tree_h.getSelectedNodes)
1494                             tree_h.setSelectedNode(childNode);
1495                         <span class="keyword">else</span>
1496                             newSelectedNodes = [tree_h.getSelectedNodes, childNode];
1497                             tree_h.setSelectedNodes(newSelectedNodes);
1498                         <span class="keyword">end</span>
1499                     <span class="keyword">end</span>
1500                 <span class="keyword">catch</span>
1501                     <span class="comment">% never mind...</span>
1502                     <a href="#_sub49" class="code" title="subfunction dispError">dispError</a>
1503                 <span class="keyword">end</span>
1504 
1505                 <span class="comment">% Expand child node if not leaf &amp; not toolbar/menubar</span>
1506                 <span class="keyword">if</span> childNode.isLeafNode
1507 
1508                     <span class="comment">% This is a leaf node, so simply update the progress-bar</span>
1509                     progressBar.setValue(progressBar.getValue+1);
1510 
1511                 <span class="keyword">else</span>
1512                     <span class="comment">% Expand all non-leaves</span>
1513                     <a href="#_sub24" class="code" title="subfunction expandNode(progressBar, tree, tree_h, parentNode, parentRow)">expandNode</a>(progressBar, tree, tree_h, childNode);
1514 
1515                     <span class="comment">% Re-collapse toolbar/menubar etc., and also invisible containers</span>
1516                     <span class="comment">% Note: if we simply did nothing, progressbar would not have been updated...</span>
1517                     <span class="keyword">try</span>
1518                         childHandle = getappdata(childNode,<span class="string">'childHandle'</span>);  <span class="comment">%=childNode.getUserObject</span>
1519                         visible = childHandle.isVisible;
1520                     <span class="keyword">catch</span>
1521                         visible = 1;
1522                     <span class="keyword">end</span>
1523                     visible = visible &amp;&amp; isempty(findstr(get(childNode,<span class="string">'Name'</span>),<span class="string">'color=&quot;gray&quot;'</span>));
1524                     <span class="comment">%if any(strcmp(childNode.getName,nodesToUnExpand))</span>
1525                     <span class="comment">%name = char(childNode.getName);</span>
1526                     <span class="keyword">if</span> any(cellfun(@(s)~isempty(strmatch(s,char(childNode.getName))),nodesToUnExpand)) || ~visible
1527                         childPath = javax.swing.tree.TreePath(childNode.getPath);
1528                         childRow = tree.getRowForPath(childPath);
1529                         tree.collapseRow(childRow);
1530                     <span class="keyword">end</span>
1531                 <span class="keyword">end</span>
1532             <span class="keyword">end</span>
1533         <span class="keyword">catch</span>
1534             <span class="comment">% never mind...</span>
1535             <a href="#_sub49" class="code" title="subfunction dispError">dispError</a>
1536         <span class="keyword">end</span>
1537     <span class="keyword">end</span>
1538 
1539     <span class="comment">%% Create utility buttons</span>
1540     <a name="_sub25" href="#_subfunctions" class="code">function hButton = createJButton(nameStr, handler, toolTipText)</a>
1541         <span class="keyword">try</span>
1542             jButton = javax.swing.JButton([<span class="string">'&lt;html&gt;&lt;body&gt;&lt;center&gt;'</span> nameStr]);
1543             jButton.setCursor(java.awt.Cursor.getPredefinedCursor(java.awt.Cursor.HAND_CURSOR));
1544             jButton.setToolTipText(toolTipText);
1545             minSize = jButton.getMinimumSize;
1546             jButton.setMinimumSize(java.awt.Dimension(minSize.getWidth,35));
1547             hButton = handle(jButton,<span class="string">'CallbackProperties'</span>);
1548             set(hButton,<span class="string">'ActionPerformedCallback'</span>,handler);
1549         <span class="keyword">catch</span>
1550             <span class="comment">% Never mind...</span>
1551         <span class="keyword">end</span>
1552     <span class="keyword">end</span>
1553 
1554     <span class="comment">%% Flash a component off/on for the specified duration</span>
1555     <span class="comment">% note: starts with 'on'; if numTimes is odd then ends with 'on', otherwise with 'off'</span>
1556     <a name="_sub26" href="#_subfunctions" class="code">function flashComponent(jComps,delaySecs,numTimes)</a>
1557         <span class="keyword">persistent</span> redBorder redBorderPanels
1558         <span class="keyword">try</span>
1559             <span class="comment">% Handle callback data from right-click (context-menu)</span>
1560             <span class="keyword">if</span> iscell(numTimes)
1561                 [jComps,delaySecs,numTimes] = deal(numTimes{:});
1562             <span class="keyword">end</span>
1563 
1564             <span class="keyword">if</span> isempty(redBorder)  <span class="comment">% reuse if possible</span>
1565                 redBorder = javax.swing.border.LineBorder(java.awt.Color.red,2,0);
1566             <span class="keyword">end</span>
1567             <span class="keyword">for</span> compIdx = 1 : length(jComps)
1568                 <span class="keyword">try</span>
1569                     oldBorder{compIdx} = jComps(compIdx).getBorder;  <span class="comment">%#ok grow</span>
1570                 <span class="keyword">catch</span>
1571                     oldBorder{compIdx} = [];  <span class="comment">%#ok grow</span>
1572                 <span class="keyword">end</span>
1573                 isSettable(compIdx) = ismethod(jComps(compIdx),<span class="string">'setBorder'</span>);  <span class="comment">%#ok grow</span>
1574                 <span class="keyword">if</span> isSettable(compIdx)
1575                     <span class="keyword">try</span>
1576                         <span class="comment">% some components prevent border modification:</span>
1577                         oldBorderFlag = jComps(compIdx).isBorderPainted;
1578                         <span class="keyword">if</span> ~oldBorderFlag
1579                             jComps(compIdx).setBorderPainted(1);
1580                             isSettable(compIdx) = jComps(compIdx).isBorderPainted;  <span class="comment">%#ok grow</span>
1581                             jComps(compIdx).setBorderPainted(oldBorderFlag);
1582                         <span class="keyword">end</span>
1583                     <span class="keyword">catch</span>
1584                         <span class="comment">% do nothing...</span>
1585                     <span class="keyword">end</span>
1586                 <span class="keyword">end</span>
1587                 <span class="keyword">if</span> compIdx &gt; length(redBorderPanels)
1588                     redBorderPanels{compIdx} = javax.swing.JPanel;
1589                     redBorderPanels{compIdx}.setBorder(redBorder);
1590                     redBorderPanels{compIdx}.setOpaque(0);  <span class="comment">% transparent interior, red border</span>
1591                 <span class="keyword">end</span>
1592                 <span class="keyword">try</span>
1593                     redBorderPanels{compIdx}.setBounds(jComps(compIdx).getBounds);
1594                 <span class="keyword">catch</span>
1595                     <span class="comment">% never mind - might be an HG handle</span>
1596                 <span class="keyword">end</span>
1597             <span class="keyword">end</span>
1598             <span class="keyword">for</span> idx = 1 : 2*numTimes
1599                 <span class="keyword">if</span> idx&gt;1,  pause(delaySecs);  <span class="keyword">end</span>  <span class="comment">% don't pause at start</span>
1600                 visible = mod(idx,2);
1601                 <span class="keyword">for</span> compIdx = 1 : length(jComps)
1602                     <span class="keyword">try</span>
1603                         jComp = jComps(compIdx);
1604 
1605                         <span class="comment">% Prevent Matlab crash (java buffer overflow...)</span>
1606                         <span class="keyword">if</span> jComp.isa(<span class="string">'com.mathworks.mwswing.desk.DTSplitPane'</span>) || <span class="keyword">...</span>
1607                            jComp.isa(<span class="string">'com.mathworks.mwswing.MJSplitPane'</span>)
1608                             <span class="keyword">continue</span>;
1609                         <span class="keyword">end</span>
1610 
1611                         <span class="comment">% HG handles are highlighted by setting their 'Selected' property</span>
1612                         <span class="keyword">if</span> isa(jComp,<span class="string">'uimenu'</span>)
1613                             <span class="keyword">if</span> visible
1614                                 oldColor = get(jComp,<span class="string">'ForegroundColor'</span>);
1615                                 setappdata(jComp,<span class="string">'findjobj_oldColor'</span>,oldColor);
1616                                 set(jComp,<span class="string">'ForegroundColor'</span>,<span class="string">'red'</span>);
1617                             <span class="keyword">else</span>
1618                                 oldColor = getappdata(jComp,<span class="string">'findjobj_oldColor'</span>);
1619                                 set(jComp,<span class="string">'ForegroundColor'</span>,oldColor);
1620                                 rmappdata(jComp,<span class="string">'ForegroundColor'</span>);
1621                             <span class="keyword">end</span>
1622                             
1623                         <span class="keyword">elseif</span> ishghandle(jComp)
1624                             <span class="keyword">if</span> visible
1625                                 set(jComp,<span class="string">'Selected'</span>,<span class="string">'on'</span>);
1626                             <span class="keyword">else</span>
1627                                 set(jComp,<span class="string">'Selected'</span>,<span class="string">'off'</span>);
1628                             <span class="keyword">end</span>
1629 
1630                         <span class="keyword">else</span> <span class="comment">%if isjava(jComp)</span>
1631 
1632                             jParent = jComps(compIdx).getParent;
1633 
1634                             <span class="comment">% Most Java components allow modifying their borders</span>
1635                             <span class="keyword">if</span> isSettable(compIdx)
1636                                 <span class="keyword">if</span> visible
1637                                     jComp.setBorder(redBorder);
1638                                     <span class="keyword">try</span> jComp.setBorderPainted(1); <span class="keyword">catch</span>, <span class="keyword">end</span>  <span class="comment">%#ok</span>
1639                                 <span class="keyword">else</span> <span class="comment">%if ~isempty(oldBorder{compIdx})</span>
1640                                     jComp.setBorder(oldBorder{compIdx});
1641                                 <span class="keyword">end</span>
1642                                 jComp.repaint;
1643 
1644                             <span class="comment">% The other Java components are highlighted by a transparent red-border</span>
1645                             <span class="comment">% panel that is placed on top of them in their parent's space</span>
1646                             <span class="keyword">elseif</span> ~isempty(jParent)
1647                                 <span class="keyword">if</span> visible
1648                                     jParent.add(redBorderPanels{compIdx});
1649                                     jParent.setComponentZOrder(redBorderPanels{compIdx},0);
1650                                 <span class="keyword">else</span>
1651                                     jParent.remove(redBorderPanels{compIdx});
1652                                 <span class="keyword">end</span>
1653                                 jParent.repaint
1654                             <span class="keyword">end</span>
1655                         <span class="keyword">end</span>
1656                     <span class="keyword">catch</span>
1657                         <span class="comment">% never mind - try the next component (if any)</span>
1658                     <span class="keyword">end</span>
1659                 <span class="keyword">end</span>
1660                 drawnow;
1661             <span class="keyword">end</span>
1662         <span class="keyword">catch</span>
1663             <span class="comment">% never mind...</span>
1664             <a href="#_sub49" class="code" title="subfunction dispError">dispError</a>;
1665         <span class="keyword">end</span>
1666         <span class="keyword">return</span>;  <span class="comment">% debug point</span>
1667     <span class="keyword">end</span>  <span class="comment">% flashComponent</span>
1668 
1669     <span class="comment">%% Select tree node</span>
1670     <a name="_sub27" href="#_subfunctions" class="code">function nodeSelected(src, evd, tree)  </a><span class="comment">%#ok</span>
1671         <span class="keyword">try</span>
1672             <span class="keyword">if</span> iscell(tree)
1673                 [src,node] = deal(tree{:});
1674             <span class="keyword">else</span>
1675                 node = evd.getCurrentNode;
1676             <span class="keyword">end</span>
1677             <span class="comment">%nodeHandle = node.getUserObject;</span>
1678             nodedata = get(node,<span class="string">'userdata'</span>);
1679             nodeHandle = nodedata.obj;
1680             userdata = get(src,<span class="string">'userdata'</span>);
1681             <span class="keyword">if</span> ~isempty(nodeHandle) &amp;&amp; ~isempty(userdata)
1682                 numSelections  = userdata.jTree.getSelectionCount;
1683                 selectionPaths = userdata.jTree.getSelectionPaths;
1684                 <span class="keyword">if</span> (numSelections == 1)
1685                     <span class="comment">% Indicate that the user has modified the initial selection (except if this was an initial auto-selected node)</span>
1686                     <span class="keyword">if</span> ~userdata.inInit
1687                         userdata.userSelected = true;
1688                         set(src,<span class="string">'userdata'</span>,userdata);
1689                     <span class="keyword">end</span>
1690 
1691                     <span class="comment">% Update the fully-qualified class name label</span>
1692                     numInitialIdx = length(userdata.initialIdx);
1693                     thisHandle = nodeHandle;
1694                     <span class="keyword">try</span>
1695                         <span class="keyword">if</span> ~ishghandle(thisHandle)
1696                             thisHandle = java(nodeHandle);
1697                         <span class="keyword">end</span>
1698                     <span class="keyword">catch</span>
1699                         <span class="comment">% never mind...</span>
1700                     <span class="keyword">end</span>
1701                     <span class="keyword">if</span> ~userdata.inInit || (numInitialIdx == 1)
1702                         userdata.classNameLabel.setText([<span class="string">'      '</span> char(thisHandle.class)]);
1703                     <span class="keyword">else</span>
1704                         userdata.classNameLabel.setText([<span class="string">' '</span> num2str(numInitialIdx) <span class="string">'x handles (some handles hidden by unexpanded tree nodes)'</span>]);
1705                     <span class="keyword">end</span>
1706                     <span class="keyword">if</span> ishghandle(thisHandle)
1707                         userdata.classNameLabel.setText(userdata.classNameLabel.getText.concat(<span class="string">' (HG handle)'</span>));
1708                     <span class="keyword">end</span>
1709                     userdata.inspectorPane.dispose;  <span class="comment">% remove props listeners - doesn't work...</span>
1710                     <a href="#_sub30" class="code" title="subfunction updateNodeTooltip(nodeHandle, uiObject)">updateNodeTooltip</a>(nodeHandle, userdata.classNameLabel);
1711 
1712                     <span class="comment">% Update the data properties inspector pane</span>
1713                     <span class="comment">% Note: we can't simply use the evd nodeHandle, because this node might have been DE-selected with only one other node left selected...</span>
1714                     <span class="comment">%nodeHandle = selectionPaths(1).getLastPathComponent.getUserObject;</span>
1715                     nodedata = get(selectionPaths(1).getLastPathComponent,<span class="string">'userdata'</span>);
1716                     nodeHandle = nodedata.obj;
1717                     <span class="comment">%identifiers = disableDbstopError;  % &quot;dbstop if error&quot; causes inspect.m to croak due to a bug - so workaround</span>
1718                     userdata.inspectorPane.setObject(thisHandle);
1719 
1720                     <span class="comment">% Update the callbacks table</span>
1721                     <span class="keyword">try</span>
1722                         stripStdCbsFlag = getappdata(userdata.callbacksTable,<span class="string">'hideStdCbs'</span>);
1723                         [cbData, cbHeaders, cbTableEnabled] = <a href="#_sub17" class="code" title="subfunction [cbData, cbHeaders, cbTableEnabled] = getCbsData(obj, stripStdCbsFlag)">getCbsData</a>(nodeHandle, stripStdCbsFlag);  <span class="comment">%#ok cbTableEnabled unused</span>
1724                         callbacksTableModel = javax.swing.table.DefaultTableModel(cbData,cbHeaders);
1725                         set(callbacksTableModel, <span class="string">'TableChangedCallback'</span>,@<a href="#_sub45" class="code" title="subfunction tbCallbacksChanged(src, evd)">tbCallbacksChanged</a>, <span class="string">'UserData'</span>,nodeHandle);
1726                         userdata.callbacksTable.setModel(callbacksTableModel)
1727                         userdata.callbacksTable.setRowAutoResizes(true);
1728                         userdata.jideTableUtils.autoResizeAllColumns(userdata.callbacksTable);
1729                     <span class="keyword">catch</span>
1730                         <span class="comment">% never mind...</span>
1731                         <a href="#_sub49" class="code" title="subfunction dispError">dispError</a>
1732                     <span class="keyword">end</span>
1733                     pause(0.005);
1734                     drawnow;
1735                     <span class="comment">%restoreDbstopError(identifiers);</span>
1736 
1737                     <span class="comment">% Highlight the selected object (if visible)</span>
1738                     <a href="#_sub26" class="code" title="subfunction flashComponent(jComps,delaySecs,numTimes)">flashComponent</a>(nodeHandle,0.2,3);
1739 
1740                 <span class="keyword">elseif</span> (numSelections &gt; 1)  <span class="comment">% Multiple selections</span>
1741 
1742                     <span class="comment">% Get the list of all selected nodes</span>
1743                     jArray = javaArray(<span class="string">'java.lang.Object'</span>, numSelections);
1744                     toolTipStr = <span class="string">'&lt;html&gt;'</span>;
1745                     sameClassFlag = true;
1746                     <span class="keyword">for</span> idx = 1 : numSelections
1747                         <span class="comment">%jArray(idx) = selectionPaths(idx).getLastPathComponent.getUserObject;</span>
1748                         nodedata = get(selectionPaths(idx).getLastPathComponent,<span class="string">'userdata'</span>);
1749                         <span class="keyword">try</span>
1750                             jArray(idx) = java(nodedata.obj);
1751                         <span class="keyword">catch</span>
1752                             jArray(idx) = nodedata.obj;
1753                         <span class="keyword">end</span>
1754                         toolTipStr = [toolTipStr <span class="string">'&amp;nbsp;'</span> jArray(idx).class <span class="string">'&amp;nbsp;'</span>];  <span class="comment">%#ok grow</span>
1755                         <span class="keyword">if</span> (idx &lt; numSelections),  toolTipStr = [toolTipStr <span class="string">'&lt;br&gt;'</span>];  <span class="keyword">end</span>  <span class="comment">%#ok grow</span>
1756                         <span class="keyword">if</span> (idx &gt; 1) &amp;&amp; sameClassFlag &amp;&amp; ~isequal(jArray(idx).getClass,jArray(1).getClass)
1757                             sameClassFlag = false;
1758                         <span class="keyword">end</span>
1759                     <span class="keyword">end</span>
1760                     toolTipStr = [toolTipStr <span class="string">'&lt;/html&gt;'</span>];
1761 
1762                     <span class="comment">% Update the fully-qualified class name label</span>
1763                     <span class="keyword">if</span> sameClassFlag
1764                         classNameStr = jArray(1).class;
1765                     <span class="keyword">else</span>
1766                         classNameStr = <span class="string">'handle'</span>;
1767                     <span class="keyword">end</span>
1768                     <span class="keyword">if</span> all(ishghandle(jArray))
1769                         <span class="keyword">if</span> strcmp(classNameStr,<span class="string">'handle'</span>)
1770                             classNameStr = <span class="string">'HG handles'</span>;
1771                         <span class="keyword">else</span>
1772                             classNameStr = [classNameStr <span class="string">' (HG handles)'</span>];
1773                         <span class="keyword">end</span>
1774                     <span class="keyword">end</span>
1775                     classNameStr = [<span class="string">' '</span> num2str(numSelections) <span class="string">'x '</span> classNameStr];
1776                     userdata.classNameLabel.setText(classNameStr);
1777                     userdata.classNameLabel.setToolTipText(toolTipStr);
1778 
1779                     <span class="comment">% Update the data properties inspector pane</span>
1780                     <span class="comment">%identifiers = disableDbstopError;  % &quot;dbstop if error&quot; causes inspect.m to croak due to a bug - so workaround</span>
1781                     userdata.inspectorPane.getRegistry.setSelected(jArray, true);
1782 
1783                     <span class="comment">% Update the callbacks table</span>
1784                     <span class="keyword">try</span>
1785                         <span class="comment">% Get intersecting callback names &amp; values</span>
1786                         stripStdCbsFlag = getappdata(userdata.callbacksTable,<span class="string">'hideStdCbs'</span>);
1787                         [cbData, cbHeaders, cbTableEnabled] = <a href="#_sub17" class="code" title="subfunction [cbData, cbHeaders, cbTableEnabled] = getCbsData(obj, stripStdCbsFlag)">getCbsData</a>(jArray(1), stripStdCbsFlag);  <span class="comment">%#ok cbHeaders &amp; cbTableEnabled unused</span>
1788                         <span class="keyword">if</span> ~isempty(cbData)
1789                             cbNames = cbData(:,1);
1790                             <span class="keyword">for</span> idx = 2 : length(jArray)
1791                                 [cbData2, cbHeaders2] = <a href="#_sub17" class="code" title="subfunction [cbData, cbHeaders, cbTableEnabled] = getCbsData(obj, stripStdCbsFlag)">getCbsData</a>(jArray(idx), stripStdCbsFlag);  <span class="comment">%#ok cbHeaders2 unused</span>
1792                                 <span class="keyword">if</span> ~isempty(cbData2)
1793                                     newCbNames = cbData2(:,1);
1794                                     [cbNames, cbIdx, cb2Idx] = intersect(cbNames,newCbNames);  <span class="comment">%#ok cb2Idx unused</span>
1795                                     cbData = cbData(cbIdx,:);
1796                                     <span class="keyword">for</span> cbIdx = 1 : length(cbNames)
1797                                         newIdx = find(strcmp(cbNames{cbIdx},newCbNames));
1798                                         <span class="keyword">if</span> ~isequal(cbData2{newIdx,2}, cbData{cbIdx,2})
1799                                             cbData{cbIdx,2} = <span class="string">'&lt;different values&gt;'</span>;
1800                                         <span class="keyword">end</span>
1801                                     <span class="keyword">end</span>
1802                                 <span class="keyword">else</span>
1803                                     cbData = cbData([],:);  <span class="comment">%=empty cell array</span>
1804                                 <span class="keyword">end</span>
1805                                 <span class="keyword">if</span> isempty(cbData)
1806                                     <span class="keyword">break</span>;
1807                                 <span class="keyword">end</span>
1808                             <span class="keyword">end</span>
1809                         <span class="keyword">end</span>
1810                         cbHeaders = {<span class="string">'Callback name'</span>,<span class="string">'Callback value'</span>};
1811                         callbacksTableModel = javax.swing.table.DefaultTableModel(cbData,cbHeaders);
1812                         set(callbacksTableModel, <span class="string">'TableChangedCallback'</span>,@<a href="#_sub45" class="code" title="subfunction tbCallbacksChanged(src, evd)">tbCallbacksChanged</a>, <span class="string">'UserData'</span>,jArray);
1813                         userdata.callbacksTable.setModel(callbacksTableModel)
1814                         userdata.callbacksTable.setRowAutoResizes(true);
1815                         userdata.jideTableUtils.autoResizeAllColumns(userdata.callbacksTable);
1816                     <span class="keyword">catch</span>
1817                         <span class="comment">% never mind...</span>
1818                         <a href="#_sub49" class="code" title="subfunction dispError">dispError</a>
1819                     <span class="keyword">end</span>
1820 
1821                     pause(0.005);
1822                     drawnow;
1823                     <span class="comment">%restoreDbstopError(identifiers);</span>
1824 
1825                     <span class="comment">% Highlight the selected objects (if visible)</span>
1826                     <a href="#_sub26" class="code" title="subfunction flashComponent(jComps,delaySecs,numTimes)">flashComponent</a>(jArray,0.2,3);
1827                 <span class="keyword">end</span>
1828 
1829                 <span class="comment">% TODO: Auto-highlight selected object (?)</span>
1830                 <span class="comment">%nodeHandle.requestFocus;</span>
1831             <span class="keyword">end</span>
1832         <span class="keyword">catch</span>
1833             <a href="#_sub49" class="code" title="subfunction dispError">dispError</a>
1834         <span class="keyword">end</span>
1835     <span class="keyword">end</span>
1836 
1837     <span class="comment">%% IFF utility function for annonymous cellfun funcs</span>
1838     <a name="_sub28" href="#_subfunctions" class="code">function result = iff(test,trueVal,falseVal)  </a><span class="comment">%#ok</span>
1839         <span class="keyword">try</span>
1840             <span class="keyword">if</span> test
1841                 result = trueVal;
1842             <span class="keyword">else</span>
1843                 result = falseVal;
1844             <span class="keyword">end</span>
1845         <span class="keyword">catch</span>
1846             result = false;
1847         <span class="keyword">end</span>
1848     <span class="keyword">end</span>
1849 
1850     <span class="comment">%% Get an HTML representation of the object's properties</span>
1851     <a name="_sub29" href="#_subfunctions" class="code">function dataFieldsStr = getPropsHtml(nodeHandle, dataFields)</a>
1852         <span class="keyword">try</span>
1853             <span class="comment">% Get a text representation of the fieldnames &amp; values</span>
1854             dataFieldsStr = <span class="string">''</span>;  <span class="comment">% just in case the following croaks...</span>
1855             <span class="keyword">if</span> isempty(dataFields)
1856                 <span class="keyword">return</span>;
1857             <span class="keyword">end</span>
1858             dataFieldsStr = evalc(<span class="string">'disp(dataFields)'</span>);
1859             <span class="keyword">if</span> dataFieldsStr(end)==char(10),  dataFieldsStr=dataFieldsStr(1:end-1);  <span class="keyword">end</span>
1860 
1861             <span class="comment">% Strip out callbacks</span>
1862             dataFieldsStr = regexprep(dataFieldsStr,<span class="string">'^\s*\w*Callback(Data)?:[^\n]*$'</span>,<span class="string">''</span>,<span class="string">'lineanchors'</span>);
1863             dataFieldsStr = regexprep(dataFieldsStr,<span class="string">'\n\n'</span>,<span class="string">'\n'</span>);
1864 
1865             <span class="comment">% HTMLize tooltip data</span>
1866             <span class="comment">% First, set the fields' font based on its read-write status</span>
1867             nodeHandle = handle(nodeHandle);  <span class="comment">% ensure this is a Matlab handle, not a java object</span>
1868             fieldNames = fieldnames(dataFields);
1869             undefinedStr = <span class="string">''</span>;
1870             <span class="keyword">for</span> fieldIdx = 1 : length(fieldNames)
1871                 thisFieldName = fieldNames{fieldIdx};
1872                 accessFlags = get(findprop(nodeHandle,thisFieldName),<span class="string">'AccessFlags'</span>);
1873                 <span class="keyword">if</span> isfield(accessFlags,<span class="string">'PublicSet'</span>) &amp;&amp; strcmp(accessFlags.PublicSet,<span class="string">'on'</span>)
1874                     <span class="comment">% Bolden read/write fields</span>
1875                     thisFieldFormat = [<span class="string">'&lt;b&gt;'</span> thisFieldName <span class="string">'&lt;b&gt;:$2'</span>];
1876                 <span class="keyword">elseif</span> ~isfield(accessFlags,<span class="string">'PublicSet'</span>)
1877                     <span class="comment">% Undefined - probably a Matlab-defined field of com.mathworks.hg.peer.FigureFrameProxy...</span>
1878                     thisFieldFormat = [<span class="string">'&lt;font color=&quot;blue&quot;&gt;'</span> thisFieldName <span class="string">'&lt;/font&gt;:$2'</span>];
1879                     undefinedStr = <span class="string">', &lt;font color=&quot;blue&quot;&gt;undefined&lt;/font&gt;'</span>;
1880                 <span class="keyword">else</span> <span class="comment">% PublicSet=='off'</span>
1881                     <span class="comment">% Gray-out &amp; italicize any read-only fields</span>
1882                     thisFieldFormat = [<span class="string">'&lt;font color=&quot;#C0C0C0&quot;&gt;&lt;i&gt;'</span> thisFieldName <span class="string">'&lt;/i&gt;&lt;/font&gt;:&lt;font color=&quot;#C0C0C0&quot;&gt;&lt;i&gt;$2&lt;i&gt;&lt;/font&gt;'</span>];
1883                 <span class="keyword">end</span>
1884                 dataFieldsStr = regexprep(dataFieldsStr, [<span class="string">'([\s\n])'</span> thisFieldName <span class="string">':([^\n]*)'</span>], [<span class="string">'$1'</span> thisFieldFormat]);
1885             <span class="keyword">end</span>
1886         <span class="keyword">catch</span>
1887             <span class="comment">% never mind... - probably an ambiguous property name</span>
1888             <span class="comment">%dispError</span>
1889         <span class="keyword">end</span>
1890 
1891         <span class="comment">% Method 1: simple &lt;br&gt; list</span>
1892         <span class="comment">%dataFieldsStr = strrep(dataFieldsStr,char(10),'&amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;');</span>
1893 
1894         <span class="comment">% Method 2: 2x2-column &lt;table&gt;</span>
1895         dataFieldsStr = regexprep(dataFieldsStr, <span class="string">'^\s*([^:]+:)([^\n]*)\n^\s*([^:]+:)([^\n]*)$'</span>, <span class="string">'&lt;tr&gt;&lt;td&gt;&amp;nbsp;$1&lt;/td&gt;&lt;td&gt;&amp;nbsp;$2&lt;/td&gt;&lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$3&lt;/td&gt;&lt;td&gt;&amp;nbsp;$4&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;'</span>, <span class="string">'lineanchors'</span>);
1896         dataFieldsStr = regexprep(dataFieldsStr, <span class="string">'^[^&lt;]\s*([^:]+:)([^\n]*)$'</span>, <span class="string">'&lt;tr&gt;&lt;td&gt;&amp;nbsp;$1&lt;/td&gt;&lt;td&gt;&amp;nbsp;$2&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;'</span>, <span class="string">'lineanchors'</span>);
1897         dataFieldsStr = [<span class="string">'(&lt;b&gt;modifiable&lt;/b&gt;'</span> undefinedStr <span class="string">' &amp;amp; &lt;font color=&quot;#C0C0C0&quot;&gt;&lt;i&gt;read-only&lt;/i&gt;&lt;/font&gt; fields)&lt;p&gt;&amp;nbsp;&amp;nbsp;&lt;table cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;'</span> dataFieldsStr <span class="string">'&lt;/table&gt;'</span>];
1898     <span class="keyword">end</span>
1899 
1900     <span class="comment">%% Update tooltip string with a node's data</span>
1901     <a name="_sub30" href="#_subfunctions" class="code">function updateNodeTooltip(nodeHandle, uiObject)</a>
1902         <span class="keyword">try</span>
1903             toolTipStr = nodeHandle.class;
1904             dataFieldsStr = <span class="string">''</span>;
1905 
1906             <span class="comment">% Add HG annotation if relevant</span>
1907             <span class="keyword">if</span> ishghandle(nodeHandle)
1908                 hgStr = <span class="string">' HG Handle'</span>;
1909             <span class="keyword">else</span>
1910                 hgStr = <span class="string">''</span>;
1911             <span class="keyword">end</span>
1912 
1913             <span class="comment">% Note: don't bulk-get because (1) not all properties are returned &amp; (2) some properties cause a Java exception</span>
1914             <span class="comment">% Note2: the classhandle approach does not enable access to user-defined schema.props</span>
1915             ch = classhandle(handle(nodeHandle));
1916             dataFields = [];
1917             [sortedNames, sortedIdx] = sort(get(ch.Properties,<span class="string">'Name'</span>));
1918             <span class="keyword">for</span> idx = 1 : length(sortedIdx)
1919                 sp = ch.Properties(sortedIdx(idx));
1920                 <span class="comment">% TODO: some fields (see EOL comment below) generate a Java Exception from: com.mathworks.mlwidgets.inspector.PropertyRootNode$PropertyListener$1$1.run</span>
1921                 <span class="keyword">if</span> strcmp(sp.AccessFlags.PublicGet,<span class="string">'on'</span>) <span class="comment">% &amp;&amp; ~any(strcmp(sp.Name,{'FixedColors','ListboxTop','Extent'}))</span>
1922                     <span class="keyword">try</span>
1923                         dataFields.(sp.Name) = get(nodeHandle, sp.Name);
1924                     <span class="keyword">catch</span>
1925                         dataFields.(sp.Name) = <span class="string">'&lt;font color=&quot;red&quot;&gt;Error!&lt;/font&gt;'</span>;
1926                     <span class="keyword">end</span>
1927                 <span class="keyword">else</span>
1928                     dataFields.(sp.Name) = <span class="string">'(no public getter method)'</span>;
1929                 <span class="keyword">end</span>
1930             <span class="keyword">end</span>
1931             dataFieldsStr = <a href="#_sub29" class="code" title="subfunction dataFieldsStr = getPropsHtml(nodeHandle, dataFields)">getPropsHtml</a>(nodeHandle, dataFields);
1932         <span class="keyword">catch</span>
1933             <span class="comment">% Probably a non-HG java object</span>
1934             <span class="keyword">try</span>
1935                 <span class="comment">% Note: the bulk-get approach enables access to user-defined schema-props, but not to some original classhandle Properties...</span>
1936                 dataFields = get(nodeHandle);
1937                 dataFieldsStr = <a href="#_sub29" class="code" title="subfunction dataFieldsStr = getPropsHtml(nodeHandle, dataFields)">getPropsHtml</a>(nodeHandle, dataFields);
1938             <span class="keyword">catch</span>
1939                 <span class="comment">% Probably a missing property getter implementation</span>
1940                 <span class="keyword">try</span>
1941                     <span class="comment">% Inform the user - bail out on error</span>
1942                     err = lasterror;  <span class="comment">%#ok</span>
1943                     dataFieldsStr = [<span class="string">'&lt;p&gt;'</span> strrep(err.message, char(10), <span class="string">'&lt;br&gt;'</span>)];
1944                 <span class="keyword">catch</span>
1945                     <span class="comment">% forget it...</span>
1946                 <span class="keyword">end</span>
1947             <span class="keyword">end</span>
1948         <span class="keyword">end</span>
1949 
1950         <span class="comment">% Set the object tooltip</span>
1951         <span class="keyword">if</span> ~isempty(dataFieldsStr)
1952             toolTipStr = [<span class="string">'&lt;html&gt;&amp;nbsp;&lt;b&gt;&lt;font color=&quot;blue&quot;&gt;'</span> char(toolTipStr) <span class="string">'&lt;/font&gt;&lt;/b&gt;'</span> hgStr <span class="string">':&amp;nbsp;'</span> dataFieldsStr <span class="string">'&lt;/html&gt;'</span>];
1953         <span class="keyword">end</span>
1954         uiObject.setToolTipText(toolTipStr);
1955     <span class="keyword">end</span>
1956 
1957     <span class="comment">%% Expand tree node</span>
1958     <a name="_sub31" href="#_subfunctions" class="code">function nodeExpanded(src, evd, tree)  </a><span class="comment">%#ok</span>
1959         <span class="comment">% tree = handle(src);</span>
1960         <span class="comment">% evdsrc = evd.getSource;</span>
1961         evdnode = evd.getCurrentNode;
1962 
1963         <span class="keyword">if</span> ~tree.isLoaded(evdnode)
1964 
1965             <span class="comment">% Get the list of children TreeNodes</span>
1966             childnodes = <a href="#_sub33" class="code" title="subfunction nodes = getChildrenNodes(tree, parentNode, isRootHGNode)">getChildrenNodes</a>(tree, evdnode);
1967 
1968             <span class="comment">% Add the HG sub-tree (unless already included in the first tree)</span>
1969             childHandle = getappdata(evdnode.handle,<span class="string">'childHandle'</span>);  <span class="comment">%=evdnode.getUserObject</span>
1970             <span class="keyword">if</span> evdnode.isRoot &amp;&amp; ~isempty(hg_handles) &amp;&amp; ~isequal(hg_handles(1).java, childHandle)
1971                 childnodes = [childnodes, <a href="#_sub33" class="code" title="subfunction nodes = getChildrenNodes(tree, parentNode, isRootHGNode)">getChildrenNodes</a>(tree, evdnode, true)];
1972             <span class="keyword">end</span>
1973 
1974             <span class="comment">% If we have a single child handle, wrap it within a javaArray for tree.add() to &quot;swallow&quot;</span>
1975             <span class="keyword">if</span> (length(childnodes) == 1)
1976                 chnodes = childnodes;
1977                 childnodes = javaArray(<span class="string">'com.mathworks.hg.peer.UITreeNode'</span>, 1);
1978                 childnodes(1) = java(chnodes);
1979             <span class="keyword">end</span>
1980 
1981             <span class="comment">% Add child nodes to the current node</span>
1982             tree.add(evdnode, childnodes);
1983             tree.setLoaded(evdnode, true);
1984         <span class="keyword">end</span>
1985     <span class="keyword">end</span>
1986 
1987     <span class="comment">%% Get an icon image no larger than 16x16 pixels</span>
1988     <a name="_sub32" href="#_subfunctions" class="code">function iconImage = setIconSize(iconImage)</a>
1989         <span class="keyword">try</span>
1990             iconWidth  = iconImage.getWidth;
1991             iconHeight = iconImage.getHeight;
1992             <span class="keyword">if</span> iconWidth &gt; 16
1993                 newHeight = fix(iconHeight * 16 / iconWidth);
1994                 iconImage = iconImage.getScaledInstance(16,newHeight,iconImage.SCALE_SMOOTH);
1995             <span class="keyword">elseif</span> iconHeight &gt; 16
1996                 newWidth = fix(iconWidth * 16 / iconHeight);
1997                 iconImage = iconImage.getScaledInstance(newWidth,16,iconImage.SCALE_SMOOTH);
1998             <span class="keyword">end</span>
1999         <span class="keyword">catch</span>
2000             <span class="comment">% never mind... - return original icon</span>
2001         <span class="keyword">end</span>
2002     <span class="keyword">end</span>  <span class="comment">% setIconSize</span>
2003 
2004     <span class="comment">%% Get list of children nodes</span>
2005     <a name="_sub33" href="#_subfunctions" class="code">function nodes = getChildrenNodes(tree, parentNode, isRootHGNode)</a>
2006         <span class="keyword">try</span>
2007             iconpath = [matlabroot, <span class="string">'/toolbox/matlab/icons/'</span>];
2008             nodes = handle([]);
2009             userdata = get(tree,<span class="string">'userData'</span>);
2010             hdls = userdata.handles;
2011             nodedata = get(parentNode,<span class="string">'userdata'</span>);
2012             <span class="keyword">if</span> nargin &lt; 3
2013                 <span class="comment">%isJavaNode = ~ishghandle(parentNode.getUserObject);</span>
2014                 isJavaNode = ~ishghandle(nodedata.obj);
2015                 isRootHGNode = false;
2016             <span class="keyword">else</span>
2017                 isJavaNode = ~isRootHGNode;
2018             <span class="keyword">end</span>
2019 
2020             <span class="comment">% Search for this parent node in the list of all nodes</span>
2021             parents = userdata.parents;
2022             nodeIdx = nodedata.idx;
2023 
2024             <span class="keyword">if</span> isJavaNode &amp;&amp; isempty(nodeIdx)  <span class="comment">% Failback, in case userdata doesn't work for some reason...</span>
2025                 <span class="keyword">for</span> hIdx = 1 : length(hdls)
2026                     <span class="comment">%if isequal(handle(parentNode.getUserObject), hdls(hIdx))</span>
2027                     <span class="keyword">if</span> isequal(handle(nodedata.obj), hdls(hIdx))
2028                         nodeIdx = hIdx;
2029                         <span class="keyword">break</span>;
2030                     <span class="keyword">end</span>
2031                 <span class="keyword">end</span>
2032             <span class="keyword">end</span>
2033             <span class="keyword">if</span> ~isJavaNode
2034                 <span class="keyword">if</span> isRootHGNode  <span class="comment">% =root HG node</span>
2035                     thisChildHandle = userdata.hg_handles(1);
2036                     childName = <a href="#_sub34" class="code" title="subfunction [nodeName, nodeTitle] = getNodeName(hndl,charsLimit)">getNodeName</a>(thisChildHandle);
2037                     hasGrandChildren = any(parents==1);
2038                     icon = [];
2039                     <span class="keyword">if</span> hasGrandChildren &amp;&amp; length(hg_handles)&gt;1
2040                         childName = childName.concat(<span class="string">' - HG root container'</span>);
2041                         icon = [iconpath <span class="string">'figureicon.gif'</span>];
2042                     <span class="keyword">end</span>
2043                     <span class="keyword">try</span>
2044                         nodes = uitreenode(<span class="string">'v0'</span>, thisChildHandle, childName, icon, ~hasGrandChildren);
2045                     <span class="keyword">catch</span>  <span class="comment">% old matlab version don't have the 'v0' option</span>
2046                         <span class="keyword">try</span>
2047                             nodes = uitreenode(thisChildHandle, childName, icon, ~hasGrandChildren);
2048                         <span class="keyword">catch</span>
2049                             <span class="comment">% probably an invalid handle - ignore...</span>
2050                         <span class="keyword">end</span>
2051                     <span class="keyword">end</span>
2052 
2053                     <span class="comment">% Add the handler to the node's internal data</span>
2054                     <span class="comment">% Note: could also use 'userdata', but setUserObject() is recommended for TreeNodes</span>
2055                     <span class="comment">% Note2: however, setUserObject() sets a java *BeenAdapter object for HG handles instead of the required original class, so use setappdata</span>
2056                     <span class="comment">%nodes.setUserObject(thisChildHandle);</span>
2057                     setappdata(nodes,<span class="string">'childHandle'</span>,thisChildHandle);
2058                     nodedata.idx = 1;
2059                     nodedata.obj = thisChildHandle;
2060                     set(nodes,<span class="string">'userdata'</span>,nodedata);
2061                     <span class="keyword">return</span>;
2062                 <span class="keyword">else</span>  <span class="comment">% non-root HG node</span>
2063                     parents = userdata.hg_parents;
2064                     hdls    = userdata.hg_handles;
2065                 <span class="keyword">end</span>  <span class="comment">% if isRootHGNode</span>
2066             <span class="keyword">end</span>  <span class="comment">% if ~isJavaNode</span>
2067 
2068             <span class="comment">% If this node was found, get the list of its children</span>
2069             <span class="keyword">if</span> ~isempty(nodeIdx)
2070                 <span class="comment">%childIdx = setdiff(find(parents==nodeIdx),nodeIdx);</span>
2071                 childIdx = find(parents==nodeIdx);
2072                 childIdx(childIdx==nodeIdx) = [];  <span class="comment">% faster...</span>
2073                 numChildren = length(childIdx);
2074                 <span class="keyword">for</span> cIdx = 1 : numChildren
2075                     thisChildIdx = childIdx(cIdx);
2076                     thisChildHandle = hdls(thisChildIdx);
2077                     childName = <a href="#_sub34" class="code" title="subfunction [nodeName, nodeTitle] = getNodeName(hndl,charsLimit)">getNodeName</a>(thisChildHandle);
2078                     <span class="keyword">try</span>
2079                         visible = thisChildHandle.Visible;
2080                         <span class="keyword">if</span> visible
2081                             <span class="keyword">try</span> visible = thisChildHandle.Width &gt; 0; <span class="keyword">catch</span>, <span class="keyword">end</span>  <span class="comment">%#ok</span>
2082                         <span class="keyword">end</span>
2083                         <span class="keyword">if</span> ~visible
2084                             childName = [<span class="string">'&lt;HTML&gt;&lt;i&gt;&lt;font color=&quot;gray&quot;&gt;'</span> char(childName) <span class="string">'&lt;/font&gt;&lt;/i&gt;&lt;/html&gt;'</span>];  <span class="comment">%#ok grow</span>
2085                         <span class="keyword">end</span>
2086                     <span class="keyword">catch</span>
2087                         <span class="comment">% never mind...</span>
2088                     <span class="keyword">end</span>
2089                     hasGrandChildren = any(parents==thisChildIdx);
2090                     <span class="keyword">try</span>
2091                         isaLabel = isa(thisChildHandle.java,<span class="string">'javax.swing.JLabel'</span>);
2092                     <span class="keyword">catch</span>
2093                         isaLabel = 0;
2094                     <span class="keyword">end</span>
2095                     <span class="keyword">if</span> hasGrandChildren &amp;&amp; ~any(strcmp(thisChildHandle.class,{<span class="string">'axes'</span>}))
2096                         icon = [iconpath <span class="string">'foldericon.gif'</span>];
2097                     <span class="keyword">elseif</span> isaLabel
2098                         icon = [iconpath <span class="string">'tool_text.gif'</span>];
2099                     <span class="keyword">else</span>
2100                         icon = [];
2101                     <span class="keyword">end</span>
2102                     <span class="keyword">try</span>
2103                         nodes(cIdx) = uitreenode(<span class="string">'v0'</span>, thisChildHandle, childName, icon, ~hasGrandChildren);
2104                     <span class="keyword">catch</span>  <span class="comment">% old matlab version don't have the 'v0' option</span>
2105                         <span class="keyword">try</span>
2106                             nodes(cIdx) = uitreenode(thisChildHandle, childName, icon, ~hasGrandChildren);
2107                         <span class="keyword">catch</span>
2108                             <span class="comment">% probably an invalid handle - ignore...</span>
2109                         <span class="keyword">end</span>
2110                     <span class="keyword">end</span>
2111 
2112                     <span class="comment">% Use existing object icon, if available</span>
2113                     <span class="keyword">try</span>
2114                         <a href="#_sub19" class="code" title="subfunction setTreeNodeIcon(treenode,container)">setTreeNodeIcon</a>(nodes(cIdx),thisChildHandle);
2115                     <span class="keyword">catch</span>
2116                         <span class="comment">% probably an invalid handle - ignore...</span>
2117                     <span class="keyword">end</span>
2118 
2119                     <span class="comment">% Pre-select the node based upon the user's FINDJOBJ filters</span>
2120                     <span class="keyword">try</span>
2121                         <span class="keyword">if</span> isJavaNode &amp;&amp; ~userdata.userSelected &amp;&amp; any(userdata.initialIdx == thisChildIdx)
2122                             pause(0.0002);  <span class="comment">% as short as possible...</span>
2123                             drawnow;
2124                             <span class="keyword">if</span> isempty(tree.getSelectedNodes)
2125                                 tree.setSelectedNode(nodes(cIdx));
2126                             <span class="keyword">else</span>
2127                                 newSelectedNodes = [tree.getSelectedNodes, nodes(cIdx).java];
2128                                 tree.setSelectedNodes(newSelectedNodes);
2129                             <span class="keyword">end</span>
2130                         <span class="keyword">end</span>
2131                     <span class="keyword">catch</span>
2132                         <span class="comment">% never mind...</span>
2133                     <span class="keyword">end</span>
2134 
2135                     <span class="comment">% Add the handler to the node's internal data</span>
2136                     <span class="comment">% Note: could also use 'userdata', but setUserObject() is recommended for TreeNodes</span>
2137                     <span class="comment">% Note2: however, setUserObject() sets a java *BeenAdapter object for HG handles instead of the required original class, so use setappdata</span>
2138                     <span class="comment">% Note3: the following will error if invalid handle - ignore</span>
2139                     <span class="keyword">try</span>
2140                         <span class="keyword">if</span> isJavaNode
2141                             thisChildHandle = thisChildHandle.java;
2142                         <span class="keyword">end</span>
2143                         <span class="comment">%nodes(cIdx).setUserObject(thisChildHandle);</span>
2144                         setappdata(nodes(cIdx),<span class="string">'childHandle'</span>,thisChildHandle);
2145                         nodedata.idx = thisChildIdx;
2146                         nodedata.obj = thisChildHandle;
2147                         set(nodes(cIdx),<span class="string">'userdata'</span>,nodedata);
2148                     <span class="keyword">catch</span>
2149                         <span class="comment">% never mind (probably an invalid handle) - leave unchanged (like a leaf)</span>
2150                     <span class="keyword">end</span>
2151                 <span class="keyword">end</span>
2152             <span class="keyword">end</span>
2153         <span class="keyword">catch</span>
2154             <span class="comment">% Never mind - leave unchanged (like a leaf)</span>
2155             <span class="comment">%error('YMA:findjobj:UnknownNodeType', 'Error expanding component tree node');</span>
2156             <a href="#_sub49" class="code" title="subfunction dispError">dispError</a>
2157         <span class="keyword">end</span>
2158     <span class="keyword">end</span>
2159 
2160     <span class="comment">%% Get a node's name</span>
2161     <a name="_sub34" href="#_subfunctions" class="code">function [nodeName, nodeTitle] = getNodeName(hndl,charsLimit)</a>
2162         <span class="keyword">try</span>
2163             <span class="comment">% Initialize (just in case one of the succeding lines croaks)</span>
2164             nodeName = <span class="string">''</span>;
2165             nodeTitle = <span class="string">''</span>;
2166             <span class="keyword">if</span> ~ismethod(hndl,<span class="string">'getClass'</span>)
2167                 <span class="keyword">try</span>
2168                     nodeName = hndl.class;
2169                 <span class="keyword">catch</span>
2170                     nodeName = hndl.type;  <span class="comment">% last-ditch try...</span>
2171                 <span class="keyword">end</span>
2172             <span class="keyword">else</span>
2173                 nodeName = hndl.getClass.getSimpleName;
2174             <span class="keyword">end</span>
2175 
2176             <span class="comment">% Strip away the package name, leaving only the regular classname</span>
2177             <span class="keyword">if</span> ~isempty(nodeName) &amp;&amp; <a href="#_sub50" class="code" title="subfunction flag = ischar(data)">ischar</a>(nodeName)
2178                 nodeName = java.lang.String(nodeName);
2179                 nodeName = nodeName.substring(nodeName.lastIndexOf(<span class="string">'.'</span>)+1);
2180             <span class="keyword">end</span>
2181             <span class="keyword">if</span> (nodeName.length == 0)
2182                 <span class="comment">% fix case of anonymous internal classes, that do not have SimpleNames</span>
2183                 <span class="keyword">try</span>
2184                     nodeName = hndl.getClass.getName;
2185                     nodeName = nodeName.substring(nodeName.lastIndexOf(<span class="string">'.'</span>)+1);
2186                 <span class="keyword">catch</span>
2187                     <span class="comment">% never mind - leave unchanged...</span>
2188                 <span class="keyword">end</span>
2189             <span class="keyword">end</span>
2190 
2191             <span class="comment">% Get any unique identifying string (if available in one of several fields)</span>
2192             labelsToCheck = {<span class="string">'label'</span>,<span class="string">'title'</span>,<span class="string">'text'</span>,<span class="string">'string'</span>,<span class="string">'displayname'</span>,<span class="string">'toolTipText'</span>,<span class="string">'TooltipString'</span>,<span class="string">'actionCommand'</span>,<span class="string">'name'</span>,<span class="string">'Tag'</span>,<span class="string">'style'</span>}; <span class="comment">%,'UIClassID'};</span>
2193             nodeTitle = <span class="string">''</span>;
2194             strField = <span class="string">''</span>;  <span class="comment">%#ok - used for debugging</span>
2195             <span class="keyword">while</span> ((~isa(nodeTitle,<span class="string">'java.lang.String'</span>) &amp;&amp; ~<a href="#_sub50" class="code" title="subfunction flag = ischar(data)">ischar</a>(nodeTitle)) || isempty(nodeTitle)) &amp;&amp; ~isempty(labelsToCheck)
2196                 <span class="keyword">try</span>
2197                     nodeTitle = get(hndl,labelsToCheck{1});
2198                     strField = labelsToCheck{1};  <span class="comment">%#ok - used for debugging</span>
2199                 <span class="keyword">catch</span>
2200                     <span class="comment">% never mind - probably missing prop, so skip to next one</span>
2201                 <span class="keyword">end</span>
2202                 labelsToCheck(1) = [];
2203             <span class="keyword">end</span>
2204             <span class="keyword">if</span> length(nodeTitle) ~= numel(nodeTitle)
2205                 <span class="comment">% Multi-line - convert to a long single line</span>
2206                 nodeTitle = nodeTitle';
2207                 nodeTitle = nodeTitle(:)';
2208             <span class="keyword">end</span>
2209             <span class="keyword">if</span> isempty(char(nodeTitle))
2210                 <span class="comment">% No title - check whether this is an HG label whose text is gettable</span>
2211                 <span class="keyword">try</span>
2212                     location = hndl.getLocationOnScreen;
2213                     pos = [location.getX, location.getY, hndl.getWidth, hndl.getHeight];
2214                     dist = sum((labelPositions-repmat(pos,size(labelPositions,1),[1,1,1,1])).^2, 2);
2215                     [minVal,minIdx] = min(dist);
2216                     <span class="comment">% Allow max distance of 8 = 2^2+2^2 (i.e. X&amp;Y off by up to 2 pixels, W&amp;H exact)</span>
2217                     <span class="keyword">if</span> minVal &lt;= 8  <span class="comment">% 8=2^2+2^2</span>
2218                         nodeTitle = get(hg_labels(minIdx),<span class="string">'string'</span>);
2219                         <span class="comment">% Preserve the label handles &amp; position for the tooltip &amp; context-menu</span>
2220                         <span class="comment">%hg_labels(minIdx) = [];</span>
2221                         <span class="comment">%labelPositions(minIdx,:) = [];</span>
2222                     <span class="keyword">end</span>
2223                 <span class="keyword">catch</span>
2224                     <span class="comment">% never mind...</span>
2225                 <span class="keyword">end</span>
2226             <span class="keyword">end</span>
2227             <span class="keyword">if</span> nargin&lt;2,  charsLimit = 25;  <span class="keyword">end</span>
2228             extraStr = regexprep(nodeTitle,{sprintf(<span class="string">'(.{%d,%d}).*'</span>,charsLimit,min(charsLimit,length(nodeTitle)-1)),<span class="string">' +'</span>},{<span class="string">'$1...'</span>,<span class="string">' '</span>},<span class="string">'once'</span>);
2229             <span class="keyword">if</span> ~isempty(extraStr)
2230                 <span class="keyword">if</span> <a href="#_sub50" class="code" title="subfunction flag = ischar(data)">ischar</a>(extraStr)
2231                     nodeName = nodeName.concat(<span class="string">' ('''</span>).concat(extraStr).concat(<span class="string">''')'</span>);
2232                 <span class="keyword">else</span>
2233                     nodeName = nodeName.concat(<span class="string">' ('</span>).concat(num2str(extraStr)).concat(<span class="string">')'</span>);
2234                 <span class="keyword">end</span>
2235                 <span class="comment">%nodeName = nodeName.concat(strField);</span>
2236             <span class="keyword">end</span>
2237         <span class="keyword">catch</span>
2238             <span class="comment">% Never mind - use whatever we have so far</span>
2239             <span class="comment">%dispError</span>
2240         <span class="keyword">end</span>
2241     <span class="keyword">end</span>
2242 
2243     <span class="comment">%% Strip standard Swing callbacks from a list of events</span>
2244     <a name="_sub35" href="#_subfunctions" class="code">function evNames = stripStdCbs(evNames)</a>
2245         <span class="keyword">try</span>
2246             stdEvents = {<span class="string">'AncestorAdded'</span>, <span class="string">'AncestorMoved'</span>, <span class="string">'AncestorRemoved'</span>, <span class="string">'AncestorResized'</span>, <span class="keyword">...</span>
2247                          <span class="string">'CaretPositionChanged'</span>, <span class="string">'ComponentAdded'</span>, <span class="string">'ComponentRemoved'</span>, <span class="keyword">...</span>
2248                          <span class="string">'ComponentHidden'</span>, <span class="string">'ComponentMoved'</span>, <span class="string">'ComponentResized'</span>, <span class="string">'ComponentShown'</span>, <span class="keyword">...</span>
2249                          <span class="string">'PropertyChange'</span>, <span class="string">'FocusGained'</span>, <span class="string">'FocusLost'</span>, <span class="keyword">...</span>
2250                          <span class="string">'HierarchyChanged'</span>, <span class="string">'InputMethodTextChanged'</span>, <span class="keyword">...</span>
2251                          <span class="string">'KeyPressed'</span>, <span class="string">'KeyReleased'</span>, <span class="string">'KeyTyped'</span>, <span class="keyword">...</span>
2252                          <span class="string">'MouseClicked'</span>, <span class="string">'MouseDragged'</span>, <span class="string">'MouseEntered'</span>, <span class="string">'MouseExited'</span>, <span class="keyword">...</span>
2253                          <span class="string">'MouseMoved'</span>, <span class="string">'MousePressed'</span>, <span class="string">'MouseReleased'</span>, <span class="string">'MouseWheelMoved'</span>, <span class="keyword">...</span>
2254                          <span class="string">'VetoableChange'</span>};
2255             stdEvents = [stdEvents, strcat(stdEvents,<span class="string">'Callback'</span>), strcat(stdEvents,<span class="string">'Fcn'</span>)];
2256             evNames = setdiff(evNames,stdEvents)';
2257         <span class="keyword">catch</span>
2258             <span class="comment">% Never mind...</span>
2259             <a href="#_sub49" class="code" title="subfunction dispError">dispError</a>
2260         <span class="keyword">end</span>
2261     <span class="keyword">end</span>
2262 
2263     <span class="comment">%% Callback function for &lt;Hide standard callbacks&gt; checkbox</span>
2264     <a name="_sub36" href="#_subfunctions" class="code">function cbHideStdCbs_Callback(src, evd, varargin)  </a><span class="comment">%#ok</span>
2265         <span class="keyword">try</span>
2266             <span class="comment">% Store the current checkbox value for later use</span>
2267             callbacksTable = get(src,<span class="string">'userdata'</span>);
2268             <span class="keyword">if</span> evd.getSource.isSelected
2269                 setappdata(callbacksTable,<span class="string">'hideStdCbs'</span>,1);
2270             <span class="keyword">else</span>
2271                 setappdata(callbacksTable,<span class="string">'hideStdCbs'</span>,[]);
2272             <span class="keyword">end</span>
2273 
2274             <span class="comment">% Rescan the current node</span>
2275             userdata = get(callbacksTable,<span class="string">'userdata'</span>);
2276             ed.getCurrentNode = userdata.jTree.getSelectionModel.getSelectionPath.getLastPathComponent;
2277             <a href="#_sub27" class="code" title="subfunction nodeSelected(src, evd, tree)  ">nodeSelected</a>(userdata.jTreePeer,ed,[]);
2278         <span class="keyword">catch</span>
2279             <span class="comment">% Never mind...</span>
2280             <a href="#_sub49" class="code" title="subfunction dispError">dispError</a>
2281         <span class="keyword">end</span>
2282     <span class="keyword">end</span>
2283 
2284     <span class="comment">%% Callback function for &lt;UndocumentedMatlab.com&gt; button</span>
2285     <a name="_sub37" href="#_subfunctions" class="code">function btWebsite_Callback(src, evd, varargin)  </a><span class="comment">%#ok</span>
2286         <span class="keyword">try</span>
2287             web(<span class="string">'http://UndocumentedMatlab.com/'</span>);
2288         <span class="keyword">catch</span>
2289             <span class="comment">% Never mind...</span>
2290             <a href="#_sub49" class="code" title="subfunction dispError">dispError</a>
2291         <span class="keyword">end</span>
2292     <span class="keyword">end</span>
2293 
2294     <span class="comment">%% Callback function for &lt;Refresh data&gt; button</span>
2295     <a name="_sub38" href="#_subfunctions" class="code">function btRefresh_Callback(src, evd, varargin)  </a><span class="comment">%#ok</span>
2296         <span class="keyword">try</span>
2297             <span class="comment">% Set cursor shape to hourglass until we're done</span>
2298             hTreeFig = varargin{2};
2299             set(hTreeFig,<span class="string">'Pointer'</span>,<span class="string">'watch'</span>);
2300             drawnow;
2301             object = varargin{1};
2302 
2303             <span class="comment">% Re-invoke this utility to re-scan the container for all children</span>
2304             <a href="findjobj.html" class="code" title="function [handles,levels,parentIdx,listing] = findjobj(container,varargin)">findjobj</a>(object);
2305         <span class="keyword">catch</span>
2306             <span class="comment">% Never mind...</span>
2307         <span class="keyword">end</span>
2308 
2309         <span class="comment">% Restore default cursor shape</span>
2310         set(hTreeFig,<span class="string">'Pointer'</span>,<span class="string">'arrow'</span>);
2311     <span class="keyword">end</span>
2312 
2313     <span class="comment">%% Callback function for &lt;Export&gt; button</span>
2314     <a name="_sub39" href="#_subfunctions" class="code">function btExport_Callback(src, evd, varargin)  </a><span class="comment">%#ok</span>
2315         <span class="keyword">try</span>
2316             <span class="comment">% Get the list of all selected nodes</span>
2317             <span class="keyword">if</span> length(varargin) &gt; 1
2318                 jTree = varargin{1};
2319                 numSelections  = jTree.getSelectionCount;
2320                 selectionPaths = jTree.getSelectionPaths;
2321                 hdls = handle([]);
2322                 <span class="keyword">for</span> idx = 1 : numSelections
2323                     <span class="comment">%hdls(idx) = handle(selectionPaths(idx).getLastPathComponent.getUserObject);</span>
2324                     nodedata = get(selectionPaths(idx).getLastPathComponent,<span class="string">'userdata'</span>);
2325                     hdls(idx) = handle(nodedata.obj,<span class="string">'CallbackProperties'</span>);
2326                 <span class="keyword">end</span>
2327 
2328                 <span class="comment">% Assign the handles in the base workspace &amp; inform user</span>
2329                 assignin(<span class="string">'base'</span>,<span class="string">'findjobj_hdls'</span>,hdls);
2330                 classNameLabel = varargin{2};
2331                 msg = [<span class="string">'Exported '</span> char(classNameLabel.getText.trim) <span class="string">' to base workspace variable findjobj_hdls'</span>];
2332             <span class="keyword">else</span>
2333                 <span class="comment">% Right-click (context-menu) callback</span>
2334                 data = varargin{1};
2335                 obj = data{1};
2336                 varName = data{2};
2337                 <span class="keyword">if</span> isempty(varName)
2338                     varName = inputdlg(<span class="string">'Enter workspace variable name'</span>,<span class="string">'FindJObj'</span>);
2339                     <span class="keyword">if</span> isempty(varName),  <span class="keyword">return</span>;  <span class="keyword">end</span>  <span class="comment">% bail out on &lt;Cancel&gt;</span>
2340                     varName = varName{1};
2341                     <span class="keyword">if</span> isempty(varName) || ~<a href="#_sub50" class="code" title="subfunction flag = ischar(data)">ischar</a>(varName),  <span class="keyword">return</span>;  <span class="keyword">end</span>  <span class="comment">% bail out on empty/null</span>
2342                     varName = genvarname(varName);
2343                 <span class="keyword">end</span>
2344                 assignin(<span class="string">'base'</span>,varName,handle(obj,<span class="string">'CallbackProperties'</span>));
2345                 msg = [<span class="string">'Exported object to base workspace variable '</span> varName];
2346             <span class="keyword">end</span>
2347             msgbox(msg,<span class="string">'FindJObj'</span>,<span class="string">'help'</span>);
2348         <span class="keyword">catch</span>
2349             <span class="comment">% Never mind...</span>
2350             <a href="#_sub49" class="code" title="subfunction dispError">dispError</a>
2351         <span class="keyword">end</span>
2352     <span class="keyword">end</span>
2353 
2354     <span class="comment">%% Callback function for &lt;Request focus&gt; button</span>
2355     <a name="_sub40" href="#_subfunctions" class="code">function btFocus_Callback(src, evd, varargin)  </a><span class="comment">%#ok</span>
2356         <span class="keyword">try</span>
2357             <span class="comment">% Request focus for the specified object</span>
2358             object = <a href="#_sub44" class="code" title="subfunction object = getTopSelectedObject(jTree, root)">getTopSelectedObject</a>(varargin{:});
2359             object.requestFocus;
2360         <span class="keyword">catch</span>
2361             <span class="keyword">try</span>
2362                 object = object.java.getPeer.requestFocus;
2363                 object.requestFocus;
2364             <span class="keyword">catch</span>
2365                 <span class="comment">% Never mind...</span>
2366                 <span class="comment">%dispError</span>
2367             <span class="keyword">end</span>
2368         <span class="keyword">end</span>
2369     <span class="keyword">end</span>
2370 
2371     <span class="comment">%% Callback function for &lt;Inspect&gt; button</span>
2372     <a name="_sub41" href="#_subfunctions" class="code">function btInspect_Callback(src, evd, varargin)  </a><span class="comment">%#ok</span>
2373         <span class="keyword">try</span>
2374             <span class="comment">% Inspect the specified object</span>
2375             <span class="keyword">if</span> length(varargin) == 1
2376                 object = varargin{1};
2377             <span class="keyword">else</span>
2378                 object = <a href="#_sub44" class="code" title="subfunction object = getTopSelectedObject(jTree, root)">getTopSelectedObject</a>(varargin{:});
2379             <span class="keyword">end</span>
2380             <span class="keyword">if</span> isempty(which(<span class="string">'uiinspect'</span>))
2381 
2382                 <span class="comment">% If the user has not indicated NOT to be informed about UIInspect</span>
2383                 <span class="keyword">if</span> ~ispref(<span class="string">'FindJObj'</span>,<span class="string">'dontCheckUIInspect'</span>)
2384 
2385                     <span class="comment">% Ask the user whether to download UIINSPECT (YES, no, no &amp; don't ask again)</span>
2386                     answer = questdlg({<span class="string">'The object inspector requires UIINSPECT from the MathWorks File Exchange. UIINSPECT was created by Yair Altman, like this FindJObj utility.'</span>,<span class="string">''</span>,<span class="string">'Download &amp; install UIINSPECT?'</span>},<span class="string">'UIInspect'</span>,<span class="string">'Yes'</span>,<span class="string">'No'</span>,<span class="string">'No &amp; never ask again'</span>,<span class="string">'Yes'</span>);
2387                     <span class="keyword">switch</span> answer
2388                         <span class="keyword">case</span> <span class="string">'Yes'</span>  <span class="comment">% =&gt; Yes: download &amp; install</span>
2389                             <span class="keyword">try</span>
2390                                 <span class="comment">% Download UIINSPECT</span>
2391                                 baseUrl = <span class="string">'http://www.mathworks.com/matlabcentral/fileexchange/17935'</span>;
2392                                 fileUrl = [baseUrl <span class="string">'?controller=file_infos&amp;download=true'</span>];
2393                                 file = urlread(fileUrl);
2394                                 file = regexprep(file,[char(13),char(10)],<span class="string">'\n'</span>);  <span class="comment">%convert to OS-dependent EOL</span>
2395 
2396                                 <span class="comment">% Install...</span>
2397                                 newPath = fullfile(fileparts(which(mfilename)),<span class="string">'uiinspect.m'</span>);
2398                                 fid = fopen(newPath,<span class="string">'wt'</span>);
2399                                 fprintf(fid,<span class="string">'%s'</span>,file);
2400                                 fclose(fid);
2401                             <span class="keyword">catch</span>
2402                                 <span class="comment">% Error downloading: inform the user</span>
2403                                 msgbox([<span class="string">'Error in downloading: '</span> lasterr], <span class="string">'UIInspect'</span>, <span class="string">'warn'</span>);  <span class="comment">%#ok</span>
2404                                 web(baseUrl);
2405                             <span class="keyword">end</span>
2406 
2407                             <span class="comment">% ...and now run it...</span>
2408                             <span class="comment">%pause(0.1);</span>
2409                             drawnow;
2410                             dummy = which(<span class="string">'uiinspect'</span>);  <span class="comment">%#ok used only to load into memory</span>
2411                             uiinspect(object);
2412                             <span class="keyword">return</span>;
2413 
2414                         <span class="keyword">case</span> <span class="string">'No &amp; never ask again'</span>   <span class="comment">% =&gt; No &amp; don't ask again</span>
2415                             setpref(<span class="string">'FindJObj'</span>,<span class="string">'dontCheckUIInspect'</span>,1);
2416 
2417                         <span class="keyword">otherwise</span>
2418                             <span class="comment">% forget it...</span>
2419                     <span class="keyword">end</span>
2420                 <span class="keyword">end</span>
2421                 drawnow;
2422 
2423                 <span class="comment">% No UIINSPECT available - run the good-ol' METHODSVIEW()...</span>
2424                 methodsview(object);
2425             <span class="keyword">else</span>
2426                 uiinspect(object);
2427             <span class="keyword">end</span>
2428         <span class="keyword">catch</span>
2429             <span class="keyword">try</span>
2430                 <span class="keyword">if</span> isjava(object)
2431                     methodsview(object)
2432                 <span class="keyword">else</span>
2433                     methodsview(object.java);
2434                 <span class="keyword">end</span>
2435             <span class="keyword">catch</span>
2436                 <span class="comment">% Never mind...</span>
2437                 <a href="#_sub49" class="code" title="subfunction dispError">dispError</a>
2438             <span class="keyword">end</span>
2439         <span class="keyword">end</span>
2440     <span class="keyword">end</span>
2441 
2442     <span class="comment">%% Callback function for &lt;Check for updates&gt; button</span>
2443     <a name="_sub42" href="#_subfunctions" class="code">function btCheckFex_Callback(src, evd, varargin)  </a><span class="comment">%#ok</span>
2444         <span class="keyword">try</span>
2445             <span class="comment">% Check the FileExchange for the latest version</span>
2446             web(<span class="string">'http://www.mathworks.com/matlabcentral/fileexchange/loadFile.do?objectId=14317'</span>);
2447         <span class="keyword">catch</span>
2448             <span class="comment">% Never mind...</span>
2449             <a href="#_sub49" class="code" title="subfunction dispError">dispError</a>
2450         <span class="keyword">end</span>
2451     <span class="keyword">end</span>
2452 
2453     <span class="comment">%% Check for existence of a newer version</span>
2454     <a name="_sub43" href="#_subfunctions" class="code">function checkVersion()</a>
2455         <span class="keyword">try</span>
2456             <span class="comment">% If the user has not indicated NOT to be informed</span>
2457             <span class="keyword">if</span> ~ispref(<span class="string">'FindJObj'</span>,<span class="string">'dontCheckNewerVersion'</span>)
2458 
2459                 <span class="comment">% Get the latest version date from the File Exchange webpage</span>
2460                 baseUrl = <span class="string">'http://www.mathworks.com/matlabcentral/fileexchange/'</span>;
2461                 webUrl = [baseUrl <span class="string">'14317'</span>];  <span class="comment">% 'loadFile.do?objectId=14317'];</span>
2462                 webPage = urlread(webUrl);
2463                 modIdx = strfind(webPage,<span class="string">'&gt;Updates&lt;'</span>);
2464                 <span class="keyword">if</span> ~isempty(modIdx)
2465                     webPage = webPage(modIdx:end);
2466                     <span class="comment">% Note: regexp hangs if substr not found, so use strfind instead...</span>
2467                     <span class="comment">%latestWebVersion = regexprep(webPage,'.*?&gt;(20[\d-]+)&lt;/td&gt;.*','$1');</span>
2468                     dateIdx = strfind(webPage,<span class="string">'class=&quot;date&quot;&gt;'</span>);
2469                     <span class="keyword">if</span> ~isempty(dateIdx)
2470                         latestDate = webPage(dateIdx(end)+13 : dateIdx(end)+23);
2471                         <span class="keyword">try</span>
2472                             startIdx = dateIdx(end)+27;
2473                             descStartIdx = startIdx + strfind(webPage(startIdx:startIdx+999),<span class="string">'&lt;td&gt;'</span>);
2474                             descEndIdx   = startIdx + strfind(webPage(startIdx:startIdx+999),<span class="string">'&lt;/td&gt;'</span>);
2475                             descStr = webPage(descStartIdx(1)+3 : descEndIdx(1)-2);
2476                             descStr = regexprep(descStr,<span class="string">'&lt;/?[pP]&gt;'</span>,<span class="string">''</span>);
2477                         <span class="keyword">catch</span>
2478                             descStr = <span class="string">''</span>;
2479                         <span class="keyword">end</span>
2480 
2481                         <span class="comment">% Get this file's latest date</span>
2482                         thisFileName = which(mfilename);  <span class="comment">%#ok</span>
2483                         <span class="keyword">try</span>
2484                             thisFileData = dir(thisFileName);
2485                             <span class="keyword">try</span>
2486                                 thisFileDatenum = thisFileData.datenum;
2487                             <span class="keyword">catch</span>  <span class="comment">% old ML versions...</span>
2488                                 thisFileDatenum = datenum(thisFileData.date);
2489                             <span class="keyword">end</span>
2490                         <span class="keyword">catch</span>
2491                             thisFileText = evalc(<span class="string">'type(thisFileName)'</span>);
2492                             thisFileLatestDate = regexprep(thisFileText,<span class="string">'.*Change log:[\s%]+([\d-]+).*'</span>,<span class="string">'$1'</span>);
2493                             thisFileDatenum = datenum(thisFileLatestDate,<span class="string">'yyyy-mm-dd'</span>);
2494                         <span class="keyword">end</span>
2495 
2496                         <span class="comment">% If there's a newer version on the File Exchange webpage (allow 2 days grace period)</span>
2497                         <span class="keyword">if</span> (thisFileDatenum &lt; datenum(latestDate,<span class="string">'dd mmm yyyy'</span>)-2)
2498 
2499                             <span class="comment">% Ask the user whether to download the newer version (YES, no, no &amp; don't ask again)</span>
2500                             msg = {[<span class="string">'A newer version ('</span> latestDate <span class="string">') of FindJObj is available on the MathWorks File Exchange:'</span>], <span class="string">''</span>, <span class="keyword">...</span>
2501                                    [<span class="string">'\color{blue}'</span> descStr <span class="string">'\color{black}'</span>], <span class="string">''</span>, <span class="keyword">...</span>
2502                                    <span class="string">'Download &amp; install the new version?'</span>};
2503                             createStruct.Interpreter = <span class="string">'tex'</span>;
2504                             createStruct.Default = <span class="string">'Yes'</span>;
2505                             answer = questdlg(msg,<span class="string">'FindJObj'</span>,<span class="string">'Yes'</span>,<span class="string">'No'</span>,<span class="string">'No &amp; never ask again'</span>,createStruct);
2506                             <span class="keyword">switch</span> answer
2507                                 <span class="keyword">case</span> <span class="string">'Yes'</span>  <span class="comment">% =&gt; Yes: download &amp; install newer file</span>
2508                                     <span class="keyword">try</span>
2509                                         <span class="comment">%fileUrl = [baseUrl '/download.do?objectId=14317&amp;fn=findjobj&amp;fe=.m'];</span>
2510                                         fileUrl = [baseUrl <span class="string">'/14317?controller=file_infos&amp;download=true'</span>];
2511                                         file = urlread(fileUrl);
2512                                         file = regexprep(file,[char(13),char(10)],<span class="string">'\n'</span>);  <span class="comment">%convert to OS-dependent EOL</span>
2513                                         fid = fopen(thisFileName,<span class="string">'wt'</span>);
2514                                         fprintf(fid,<span class="string">'%s'</span>,file);
2515                                         fclose(fid);
2516                                     <span class="keyword">catch</span>
2517                                         <span class="comment">% Error downloading: inform the user</span>
2518                                         msgbox([<span class="string">'Error in downloading: '</span> lasterr], <span class="string">'FindJObj'</span>, <span class="string">'warn'</span>);  <span class="comment">%#ok</span>
2519                                         web(webUrl);
2520                                     <span class="keyword">end</span>
2521                                 <span class="keyword">case</span> <span class="string">'No &amp; never ask again'</span>   <span class="comment">% =&gt; No &amp; don't ask again</span>
2522                                     setpref(<span class="string">'FindJObj'</span>,<span class="string">'dontCheckNewerVersion'</span>,1);
2523                                 <span class="keyword">otherwise</span>
2524                                     <span class="comment">% forget it...</span>
2525                             <span class="keyword">end</span>
2526                         <span class="keyword">end</span>
2527                     <span class="keyword">end</span>
2528                 <span class="keyword">else</span>
2529                     <span class="comment">% Maybe webpage not fully loaded or changed format - bail out...</span>
2530                 <span class="keyword">end</span>
2531             <span class="keyword">end</span>
2532         <span class="keyword">catch</span>
2533             <span class="comment">% Never mind...</span>
2534         <span class="keyword">end</span>
2535     <span class="keyword">end</span>
2536 
2537     <span class="comment">%% Get the first selected object (might not be the top one - depends on selection order)</span>
2538     <a name="_sub44" href="#_subfunctions" class="code">function object = getTopSelectedObject(jTree, root)</a>
2539         <span class="keyword">try</span>
2540             object = [];
2541             numSelections  = jTree.getSelectionCount;
2542             <span class="keyword">if</span> numSelections &gt; 0
2543                 <span class="comment">% Get the first object specified</span>
2544                 <span class="comment">%object = jTree.getSelectionPath.getLastPathComponent.getUserObject;</span>
2545                 nodedata = get(jTree.getSelectionPath.getLastPathComponent,<span class="string">'userdata'</span>);
2546             <span class="keyword">else</span>
2547                 <span class="comment">% Get the root object (container)</span>
2548                 <span class="comment">%object = root.getUserObject;</span>
2549                 nodedata = get(root,<span class="string">'userdata'</span>);
2550             <span class="keyword">end</span>
2551             object = nodedata.obj;
2552         <span class="keyword">catch</span>
2553             <span class="comment">% Never mind...</span>
2554             <a href="#_sub49" class="code" title="subfunction dispError">dispError</a>
2555         <span class="keyword">end</span>
2556     <span class="keyword">end</span>
2557 
2558     <span class="comment">%% Update component callback upon callbacksTable data change</span>
2559     <a name="_sub45" href="#_subfunctions" class="code">function tbCallbacksChanged(src, evd)</a>
2560         <span class="keyword">try</span>
2561             <span class="comment">% exit if invalid handle or already in Callback</span>
2562             <span class="keyword">if</span> ~ishandle(src) || ~isempty(getappdata(src,<span class="string">'inCallback'</span>)) <span class="comment">% || length(dbstack)&gt;1  %exit also if not called from user action</span>
2563                 <span class="keyword">return</span>;
2564             <span class="keyword">end</span>
2565             setappdata(src,<span class="string">'inCallback'</span>,1);  <span class="comment">% used to prevent endless recursion</span>
2566 
2567             <span class="comment">% Update the object's callback with the modified value</span>
2568             modifiedColIdx = evd.getColumn;
2569             modifiedRowIdx = evd.getFirstRow;
2570             <span class="keyword">if</span> modifiedColIdx==1 &amp;&amp; modifiedRowIdx&gt;=0  <span class="comment">%sanity check - should always be true</span>
2571                 table = evd.getSource;
2572                 object = get(src,<span class="string">'userdata'</span>);
2573                 cbName = strtrim(table.getValueAt(modifiedRowIdx,0));
2574                 <span class="keyword">try</span>
2575                     cbValue = strtrim(char(table.getValueAt(modifiedRowIdx,1)));
2576                     <span class="keyword">if</span> ~isempty(cbValue) &amp;&amp; ismember(cbValue(1),<span class="string">'{[@'''</span>)
2577                         cbValue = eval(cbValue);
2578                     <span class="keyword">end</span>
2579                     <span class="keyword">if</span> (~<a href="#_sub50" class="code" title="subfunction flag = ischar(data)">ischar</a>(cbValue) &amp;&amp; ~isa(cbValue, <span class="string">'function_handle'</span>) &amp;&amp; (iscom(object(1)) || iscell(cbValue)))
2580                         <a href="#_sub46" class="code" title="subfunction revertCbTableModification(table, modifiedRowIdx, modifiedColIdx, cbName, object, errMsg)  ">revertCbTableModification</a>(table, modifiedRowIdx, modifiedColIdx, cbName, object, <span class="string">''</span>);
2581                     <span class="keyword">else</span>
2582                         <span class="keyword">for</span> objIdx = 1 : length(object)
2583                             <span class="keyword">if</span> ~iscom(object(objIdx))
2584                                 set(object(objIdx), cbName, cbValue);
2585                             <span class="keyword">else</span>
2586                                 cbs = object(objIdx).eventlisteners;
2587                                 <span class="keyword">if</span> ~isempty(cbs)
2588                                     cbs = cbs(strcmpi(cbs(:,1),cbName),:);
2589                                     object(objIdx).unregisterevent(cbs);
2590                                 <span class="keyword">end</span>
2591                                 <span class="keyword">if</span> ~isempty(cbValue)
2592                                     object(objIdx).registerevent({cbName, cbValue});
2593                                 <span class="keyword">end</span>
2594                             <span class="keyword">end</span>
2595                         <span class="keyword">end</span>
2596                     <span class="keyword">end</span>
2597                 <span class="keyword">catch</span>
2598                     <a href="#_sub46" class="code" title="subfunction revertCbTableModification(table, modifiedRowIdx, modifiedColIdx, cbName, object, errMsg)  ">revertCbTableModification</a>(table, modifiedRowIdx, modifiedColIdx, cbName, object, lasterr)  <span class="comment">%#ok</span>
2599                 <span class="keyword">end</span>
2600             <span class="keyword">end</span>
2601         <span class="keyword">catch</span>
2602             <span class="comment">% never mind...</span>
2603         <span class="keyword">end</span>
2604         setappdata(src,<span class="string">'inCallback'</span>,[]);  <span class="comment">% used to prevent endless recursion</span>
2605     <span class="keyword">end</span>
2606 
2607     <span class="comment">%% Revert Callback table modification</span>
2608     <a name="_sub46" href="#_subfunctions" class="code">function revertCbTableModification(table, modifiedRowIdx, modifiedColIdx, cbName, object, errMsg)  </a><span class="comment">%#ok</span>
2609         <span class="keyword">try</span>
2610             <span class="comment">% Display a notification MsgBox</span>
2611             msg = <span class="string">'Callbacks must be a ''string'', or a @function handle'</span>;
2612             <span class="keyword">if</span> ~iscom(object(1)),  msg = [msg <span class="string">' or a {@func,args...} construct'</span>];  <span class="keyword">end</span>
2613             <span class="keyword">if</span> ~isempty(errMsg),  msg = {errMsg, <span class="string">''</span>, msg};  <span class="keyword">end</span>
2614             msgbox(msg, [<span class="string">'Error setting '</span> cbName <span class="string">' callback'</span>], <span class="string">'warn'</span>);
2615 
2616             <span class="comment">% Revert to the current value</span>
2617             curValue = <span class="string">''</span>;
2618             <span class="keyword">try</span>
2619                 <span class="keyword">if</span> ~iscom(object(1))
2620                     curValue = <a href="#_sub16" class="code" title="subfunction data = charizeData(data)">charizeData</a>(get(object(1),cbName));
2621                 <span class="keyword">else</span>
2622                     cbs = object(1).eventlisteners;
2623                     <span class="keyword">if</span> ~isempty(cbs)
2624                         cbs = cbs(strcmpi(cbs(:,1),cbName),:);
2625                         curValue = <a href="#_sub16" class="code" title="subfunction data = charizeData(data)">charizeData</a>(cbs(1,2));
2626                     <span class="keyword">end</span>
2627                 <span class="keyword">end</span>
2628             <span class="keyword">catch</span>
2629                 <span class="comment">% never mind... - clear the current value</span>
2630             <span class="keyword">end</span>
2631             table.setValueAt(curValue, modifiedRowIdx, modifiedColIdx);
2632         <span class="keyword">catch</span>
2633             <span class="comment">% never mind...</span>
2634         <span class="keyword">end</span>
2635     <span class="keyword">end</span>  <span class="comment">% revertCbTableModification</span>
2636 
2637     <span class="comment">%% Get the Java positions of all HG text labels</span>
2638     <a name="_sub47" href="#_subfunctions" class="code">function labelPositions = getLabelsJavaPos(container)</a>
2639         <span class="keyword">try</span>
2640             labelPositions = [];
2641 
2642             <span class="comment">% Ensure we have a figure handle</span>
2643             <span class="keyword">try</span>
2644                 h = hFig;  <span class="comment">%#ok unused</span>
2645             <span class="keyword">catch</span>
2646                 hFig = <a href="#_sub3" class="code" title="subfunction curFig = getCurrentFigure">getCurrentFigure</a>;
2647             <span class="keyword">end</span>
2648 
2649             <span class="comment">% Get the figure's margins from the Matlab properties</span>
2650             hg_labels = findall(hFig, <span class="string">'Style'</span>,<span class="string">'text'</span>);
2651             units = get(hFig,<span class="string">'units'</span>);
2652             set(hFig,<span class="string">'units'</span>,<span class="string">'pixels'</span>);
2653             outerPos = get(hFig,<span class="string">'OuterPosition'</span>);
2654             innerPos = get(hFig,<span class="string">'Position'</span>);
2655             set(hFig,<span class="string">'units'</span>,units);
2656             margins = abs(innerPos-outerPos);
2657 
2658             figX = container.getX;        <span class="comment">% =outerPos(1)</span>
2659             figY = container.getY;        <span class="comment">% =outerPos(2)</span>
2660             <span class="comment">%figW = container.getWidth;   % =outerPos(3)</span>
2661             figH = container.getHeight;   <span class="comment">% =outerPos(4)</span>
2662 
2663             <span class="comment">% Get the relevant screen pixel size</span>
2664             <span class="comment">%monitorPositions = get(0,'MonitorPositions');</span>
2665             <span class="comment">%for monitorIdx = size(monitorPositions,1) : -1 : 1</span>
2666             <span class="comment">%    screenSize = monitorPositions(monitorIdx,:);</span>
2667             <span class="comment">%    if (outerPos(1) &gt;= screenSize(1)) % &amp;&amp; (outerPos(1)+outerPos(3) &lt;= screenSize(3))</span>
2668             <span class="comment">%        break;</span>
2669             <span class="comment">%    end</span>
2670             <span class="comment">%end</span>
2671             <span class="comment">%monitorBaseY = screenSize(4) - monitorPositions(1,4);</span>
2672 
2673             <span class="comment">% Compute the labels' screen pixel position in Java units ([0,0] = top left)</span>
2674             <span class="keyword">for</span> idx = 1 : length(hg_labels)
2675                 matlabPos = getpixelposition(hg_labels(idx),1);
2676                 javaX = figX + matlabPos(1) + margins(1);
2677                 javaY = figY + figH - matlabPos(2) - matlabPos(4) - margins(2);
2678                 labelPositions(idx,:) = [javaX, javaY, matlabPos(3:4)];  <span class="comment">%#ok grow</span>
2679             <span class="keyword">end</span>
2680         <span class="keyword">catch</span>
2681             <span class="comment">% never mind...</span>
2682             err = lasterror;  <span class="comment">%#ok debug point</span>
2683         <span class="keyword">end</span>
2684     <span class="keyword">end</span>
2685 
2686     <span class="comment">%% Traverse an HG container hierarchy and extract the HG elements within</span>
2687     <a name="_sub48" href="#_subfunctions" class="code">function traverseHGContainer(hcontainer,level,parent)</a>
2688         <span class="keyword">try</span>
2689             <span class="comment">% Record the data for this node</span>
2690             thisIdx = length(hg_levels) + 1;
2691             hg_levels(thisIdx) = level;
2692             hg_parentIdx(thisIdx) = parent;
2693             hg_handles(thisIdx) = handle(hcontainer);
2694             parentId = length(hg_parentIdx);
2695 
2696             <span class="comment">% Now recursively process all this node's children (if any)</span>
2697             <span class="comment">%if ishghandle(hcontainer)</span>
2698             <span class="keyword">try</span>  <span class="comment">% try-catch is faster than checking ishghandle(hcontainer)...</span>
2699                 allChildren = allchild(handle(hcontainer));
2700                 <span class="keyword">for</span> childIdx = 1 : length(allChildren)
2701                     <a href="#_sub48" class="code" title="subfunction traverseHGContainer(hcontainer,level,parent)">traverseHGContainer</a>(allChildren(childIdx),level+1,parentId);
2702                 <span class="keyword">end</span>
2703             <span class="keyword">catch</span>
2704                 <span class="comment">% do nothing - probably not a container</span>
2705                 <span class="comment">%dispError</span>
2706             <span class="keyword">end</span>
2707 
2708             <span class="comment">% TODO: Add axis (plot) component handles</span>
2709         <span class="keyword">catch</span>
2710             <span class="comment">% forget it...</span>
2711         <span class="keyword">end</span>
2712     <span class="keyword">end</span>
2713 
2714     <span class="comment">%% Debuggable &quot;quiet&quot; error-handling</span>
2715     <a name="_sub49" href="#_subfunctions" class="code">function dispError</a>
2716         err = lasterror;  <span class="comment">%#ok</span>
2717         msg = err.message;
2718         <span class="keyword">for</span> idx = 1 : length(err.stack)
2719             filename = err.stack(idx).file;
2720             <span class="keyword">if</span> ~isempty(regexpi(filename,mfilename))
2721                 funcname = err.stack(idx).name;
2722                 line = num2str(err.stack(idx).line);
2723                 msg = [msg <span class="string">' at &lt;a href=&quot;matlab:opentoline('''</span> filename <span class="string">''','</span> line <span class="string">');&quot;&gt;'</span> funcname <span class="string">' line #'</span> line <span class="string">'&lt;/a&gt;'</span>]; <span class="comment">%#ok grow</span>
2724                 <span class="keyword">break</span>;
2725             <span class="keyword">end</span>
2726         <span class="keyword">end</span>
2727         disp(msg);
2728         <span class="keyword">return</span>;  <span class="comment">% debug point</span>
2729     <span class="keyword">end</span>
2730 
2731     <span class="comment">%% ML 7.0 - compatible ischar() function</span>
2732     <a name="_sub50" href="#_subfunctions" class="code">function flag = ischar(data)</a>
2733         <span class="keyword">try</span>
2734             flag = builtin(<span class="string">'ischar'</span>,data);
2735         <span class="keyword">catch</span>
2736             flag = isa(data,<span class="string">'char'</span>);
2737         <span class="keyword">end</span>
2738     <span class="keyword">end</span>
2739 
2740     <span class="comment">%% Set up the uitree context (right-click) menu</span>
2741     <a name="_sub51" href="#_subfunctions" class="code">function jmenu = setTreeContextMenu(obj,node,tree_h)</a>
2742           <span class="comment">% Prepare the context menu (note the use of HTML labels)</span>
2743           import javax.swing.*
2744           titleStr = <a href="#_sub54" class="code" title="subfunction nodeTitleStr = getNodeTitleStr(obj,node)">getNodeTitleStr</a>(obj,node);
2745           titleStr = regexprep(titleStr,<span class="string">'&lt;hr&gt;.*'</span>,<span class="string">''</span>);
2746           menuItem0 = JMenuItem(titleStr);
2747           set(menuItem0,<span class="string">'Enabled'</span>,<span class="string">'off'</span>,<span class="string">'Armed'</span>,<span class="string">'off'</span>);
2748           menuItem1 = JMenuItem(<span class="string">'Export handle to findjobj_hdls'</span>);
2749           menuItem2 = JMenuItem(<span class="string">'Export handle to...'</span>);
2750           menuItem3 = JMenuItem(<span class="string">'Request focus (bring to front)'</span>);
2751           menuItem4 = JMenuItem(<span class="string">'Flash component borders'</span>);
2752           menuItem5 = JMenuItem(<span class="string">'Display properties &amp; callbacks'</span>);
2753           menuItem6 = JMenuItem(<span class="string">'Inspect object'</span>);
2754 
2755           <span class="comment">% Set the menu items' callbacks</span>
2756           set(menuItem1,<span class="string">'ActionPerformedCallback'</span>,{@<a href="#_sub39" class="code" title="subfunction btExport_Callback(src, evd, varargin)  ">btExport_Callback</a>,{obj,<span class="string">'findjobj_hdls'</span>}});
2757           set(menuItem2,<span class="string">'ActionPerformedCallback'</span>,{@<a href="#_sub39" class="code" title="subfunction btExport_Callback(src, evd, varargin)  ">btExport_Callback</a>,{obj,[]}});
2758           set(menuItem3,<span class="string">'ActionPerformedCallback'</span>,{@<a href="#_sub56" class="code" title="subfunction requestFocus(hTree, eventData, obj)  ">requestFocus</a>,obj});
2759           set(menuItem4,<span class="string">'ActionPerformedCallback'</span>,{@<a href="#_sub26" class="code" title="subfunction flashComponent(jComps,delaySecs,numTimes)">flashComponent</a>,{obj,0.2,3}});
2760           set(menuItem5,<span class="string">'ActionPerformedCallback'</span>,{@<a href="#_sub27" class="code" title="subfunction nodeSelected(src, evd, tree)  ">nodeSelected</a>,{tree_h,node}});
2761           set(menuItem6,<span class="string">'ActionPerformedCallback'</span>,{@<a href="#_sub41" class="code" title="subfunction btInspect_Callback(src, evd, varargin)  ">btInspect_Callback</a>,obj});
2762 
2763           <span class="comment">% Add all menu items to the context menu (with internal separator)</span>
2764           jmenu = JPopupMenu;
2765           jmenu.add(menuItem0);
2766           jmenu.addSeparator;
2767           handleValue=[];  <span class="keyword">try</span> handleValue = double(obj); <span class="keyword">catch</span>, <span class="keyword">end</span>;  <span class="comment">%#ok</span>
2768           <span class="keyword">if</span> ~isempty(handleValue)
2769               <span class="comment">% For valid HG handles only</span>
2770               menuItem0a = JMenuItem(<span class="string">'Copy handle value to clipboard'</span>);
2771               set(menuItem0a,<span class="string">'ActionPerformedCallback'</span>,sprintf(<span class="string">'clipboard(''copy'',%.99g)'</span>,handleValue));
2772               jmenu.add(menuItem0a);
2773           <span class="keyword">end</span>
2774           jmenu.add(menuItem1);
2775           jmenu.add(menuItem2);
2776           jmenu.addSeparator;
2777           jmenu.add(menuItem3);
2778           jmenu.add(menuItem4);
2779           jmenu.add(menuItem5);
2780           jmenu.add(menuItem6);
2781     <span class="keyword">end</span>  <span class="comment">% setTreeContextMenu</span>
2782 
2783     <span class="comment">%% Set the mouse-press callback</span>
2784     <a name="_sub52" href="#_subfunctions" class="code">function treeMousePressedCallback(hTree, eventData, tree_h)  </a><span class="comment">%#ok hTree is unused</span>
2785         <span class="keyword">if</span> eventData.isMetaDown  <span class="comment">% right-click is like a Meta-button</span>
2786             <span class="comment">% Get the clicked node</span>
2787             clickX = eventData.getX;
2788             clickY = eventData.getY;
2789             jtree = eventData.getSource;
2790             treePath = jtree.getPathForLocation(clickX, clickY);
2791             <span class="keyword">try</span>
2792                 <span class="comment">% Modify the context menu based on the clicked node</span>
2793                 node = treePath.getLastPathComponent;
2794                 userdata = get(node,<span class="string">'userdata'</span>);
2795                 obj = userdata.obj;
2796                 jmenu = <a href="#_sub51" class="code" title="subfunction jmenu = setTreeContextMenu(obj,node,tree_h)">setTreeContextMenu</a>(obj,node,tree_h);
2797 
2798                 <span class="comment">% TODO: remember to call jmenu.remove(item) in item callback</span>
2799                 <span class="comment">% or use the timer hack shown here to remove the item:</span>
2800                 <span class="comment">%    timerFcn = {@menuRemoveItem,jmenu,item};</span>
2801                 <span class="comment">%    start(timer('TimerFcn',timerFcn,'StartDelay',0.2));</span>
2802 
2803                 <span class="comment">% Display the (possibly-modified) context menu</span>
2804                 jmenu.show(jtree, clickX, clickY);
2805                 jmenu.repaint;
2806 
2807                 <span class="comment">% This is for debugging:</span>
2808                 userdata.tree = jtree;
2809                 setappdata(gcf,<span class="string">'findjobj_hgtree'</span>,userdata)
2810             <span class="keyword">catch</span>
2811                 <span class="comment">% clicked location is NOT on top of any node</span>
2812                 <span class="comment">% Note: can also be tested by isempty(treePath)</span>
2813             <span class="keyword">end</span>
2814         <span class="keyword">end</span>
2815     <span class="keyword">end</span>  <span class="comment">% treeMousePressedCallback</span>
2816 
2817     <span class="comment">%% Remove the extra context menu item after display</span>
2818     <a name="_sub53" href="#_subfunctions" class="code">function menuRemoveItem(hObj,eventData,jmenu,item) </a><span class="comment">%#ok unused</span>
2819         jmenu.remove(item);
2820     <span class="keyword">end</span>  <span class="comment">% menuRemoveItem</span>
2821 
2822     <span class="comment">%% Get the title for the tooltip and context (right-click) menu</span>
2823     <a name="_sub54" href="#_subfunctions" class="code">function nodeTitleStr = getNodeTitleStr(obj,node)</a>
2824         <span class="keyword">try</span>
2825             <span class="comment">% Display the full classname and object name in the tooltip</span>
2826             <span class="comment">%nodeName = char(node.getName);</span>
2827             <span class="comment">%nodeName = strrep(nodeName, '&lt;HTML&gt;&lt;i&gt;&lt;font color=&quot;gray&quot;&gt;','');</span>
2828             <span class="comment">%nodeName = strrep(nodeName, '&lt;/font&gt;&lt;/i&gt;&lt;/html&gt;','');</span>
2829             nodeName = char(<a href="#_sub34" class="code" title="subfunction [nodeName, nodeTitle] = getNodeName(hndl,charsLimit)">getNodeName</a>(obj,99));
2830             [objClass,objName] = strtok(nodeName);
2831             objName = objName(3:end-1);  <span class="comment">% strip leading ( and trailing )</span>
2832             <span class="keyword">if</span> isempty(objName),  objName = <span class="string">'(none found)'</span>;  <span class="keyword">end</span>
2833             nodeName = char(node.getName);
2834             objClass = char(obj.getClass.getName);
2835             nodeTitleStr = sprintf(<span class="string">'&lt;html&gt;Class name: &lt;font color=&quot;blue&quot;&gt;%s&lt;/font&gt;&lt;br&gt;Text/title: %s'</span>,objClass,objName);
2836 
2837             <span class="comment">% If the component is invisible, state this in the tooltip</span>
2838             <span class="keyword">if</span> ~isempty(strfind(nodeName,<span class="string">'color=&quot;gray&quot;'</span>))
2839                 nodeTitleStr = [nodeTitleStr <span class="string">'&lt;br&gt;&lt;font color=&quot;gray&quot;&gt;&lt;i&gt;&lt;b&gt;*** Invisible ***&lt;/b&gt;&lt;/i&gt;&lt;/font&gt;'</span>];
2840             <span class="keyword">end</span>
2841             nodeTitleStr = [nodeTitleStr <span class="string">'&lt;hr&gt;Right-click for context-menu'</span>];
2842         <span class="keyword">catch</span>
2843             <span class="comment">% Possible not a Java object - try treating as an HG handle</span>
2844             <span class="keyword">try</span>
2845                 handleValueStr = sprintf(<span class="string">'#: &lt;font color=&quot;blue&quot;&gt;&lt;b&gt;%.99g&lt;b&gt;&lt;/font&gt;'</span>,double(obj));
2846                 <span class="keyword">try</span>
2847                     type = <span class="string">''</span>;
2848                     type = get(obj,<span class="string">'type'</span>);
2849                     type(1) = upper(type(1));
2850                 <span class="keyword">catch</span>
2851                     <span class="keyword">if</span> ~ishandle(obj)
2852                         type = [<span class="string">'&lt;font color=&quot;red&quot;&gt;&lt;b&gt;Invalid &lt;i&gt;'</span> char(node.getName) <span class="string">'&lt;/i&gt;'</span>];
2853                         handleValueStr = <span class="string">'!!!&lt;/b&gt;&lt;/font&gt;&lt;br&gt;Perhaps this handle was deleted after this UIInspect tree was&lt;br&gt;already drawn. Try to refresh by selecting any valid node handle'</span>;
2854                     <span class="keyword">end</span>
2855                 <span class="keyword">end</span>
2856                 nodeTitleStr = sprintf(<span class="string">'&lt;html&gt;%s handle %s'</span>,type,handleValueStr);
2857                 <span class="keyword">try</span>
2858                     <span class="comment">% If the component is invisible, state this in the tooltip</span>
2859                     <span class="keyword">if</span> strcmp(get(obj,<span class="string">'Visible'</span>),<span class="string">'off'</span>)
2860                         nodeTitleStr = [nodeTitleStr <span class="string">'&lt;br&gt;&lt;center&gt;&lt;font color=&quot;gray&quot;&gt;&lt;i&gt;Invisible&lt;/i&gt;&lt;/font&gt;'</span>];
2861                     <span class="keyword">end</span>
2862                 <span class="keyword">catch</span>
2863                     <span class="comment">% never mind...</span>
2864                 <span class="keyword">end</span>
2865             <span class="keyword">catch</span>
2866                 <span class="comment">% never mind... - ignore</span>
2867             <span class="keyword">end</span>
2868         <span class="keyword">end</span>
2869     <span class="keyword">end</span>  <span class="comment">% getNodeTitleStr</span>
2870 
2871     <span class="comment">%% Handle tree mouse movement callback - used to set the tooltip &amp; context-menu</span>
2872     <a name="_sub55" href="#_subfunctions" class="code">function treeMouseMovedCallback(hTree, eventData)</a>
2873           <span class="keyword">try</span>
2874               x = eventData.getX;
2875               y = eventData.getY;
2876               jtree = eventData.getSource;
2877               treePath = jtree.getPathForLocation(x, y);
2878               <span class="keyword">try</span>
2879                   <span class="comment">% Set the tooltip string based on the hovered node</span>
2880                   node = treePath.getLastPathComponent;
2881                   userdata = get(node,<span class="string">'userdata'</span>);
2882                   obj = userdata.obj;
2883                   tooltipStr = <a href="#_sub54" class="code" title="subfunction nodeTitleStr = getNodeTitleStr(obj,node)">getNodeTitleStr</a>(obj,node);
2884                   set(hTree,<span class="string">'ToolTipText'</span>,tooltipStr)
2885               <span class="keyword">catch</span>
2886                   <span class="comment">% clicked location is NOT on top of any node</span>
2887                   <span class="comment">% Note: can also be tested by isempty(treePath)</span>
2888               <span class="keyword">end</span>
2889           <span class="keyword">catch</span>
2890               <a href="#_sub49" class="code" title="subfunction dispError">dispError</a>;
2891           <span class="keyword">end</span>
2892           <span class="keyword">return</span>;  <span class="comment">% denug breakpoint</span>
2893     <span class="keyword">end</span>  <span class="comment">% treeMouseMovedCallback</span>
2894 
2895     <span class="comment">%% Request focus for a specific object handle</span>
2896     <a name="_sub56" href="#_subfunctions" class="code">function requestFocus(hTree, eventData, obj)  </a><span class="comment">%#ok hTree &amp; eventData are unused</span>
2897         <span class="comment">% Ensure the object handle is valid</span>
2898         <span class="keyword">if</span> isjava(obj)
2899             obj.requestFocus;
2900             <span class="keyword">return</span>;
2901         <span class="keyword">elseif</span> ~ishandle(obj)
2902             msgbox(<span class="string">'The selected object does not appear to be a valid handle as defined by the ishandle() function. Perhaps this object was deleted after this hierarchy tree was already drawn. Refresh this tree by selecting a valid node handle and then retry.'</span>,<span class="string">'FindJObj'</span>,<span class="string">'warn'</span>);
2903             beep;
2904             <span class="keyword">return</span>;
2905         <span class="keyword">end</span>
2906 
2907         <span class="keyword">try</span>
2908             foundFlag = 0;
2909             <span class="keyword">while</span> ~foundFlag
2910                 <span class="keyword">if</span> isempty(obj),  <span class="keyword">return</span>;  <span class="keyword">end</span>  <span class="comment">% sanity check</span>
2911                 type = get(obj,<span class="string">'type'</span>);
2912                 obj = double(obj);
2913                 foundFlag = any(strcmp(type,{<span class="string">'figure'</span>,<span class="string">'axes'</span>,<span class="string">'uicontrol'</span>}));
2914                 <span class="keyword">if</span> ~foundFlag
2915                     obj = get(obj,<span class="string">'Parent'</span>);
2916                 <span class="keyword">end</span>
2917             <span class="keyword">end</span>
2918             feval(type,obj);
2919         <span class="keyword">catch</span>
2920             <span class="comment">% never mind...</span>
2921             <a href="#_sub49" class="code" title="subfunction dispError">dispError</a>;
2922         <span class="keyword">end</span>
2923     <span class="keyword">end</span>  <span class="comment">% requestFocus</span>
2924 
2925 
2926 <span class="keyword">end</span>  <span class="comment">% FINDJOBJ</span>
2927 
2928 
2929 <span class="comment">%% TODO TODO TODO</span>
2930 <span class="comment">%{</span>
2931 - Enh: Improve performance - esp. <a href="#_sub24" class="code" title="subfunction expandNode(progressBar, tree, tree_h, parentNode, parentRow)">expandNode</a>() (performance solved in non-nteractive mode)
2932 - Enh: Add property listeners - same problem in MathWork's inspect.m
2933 - Enh: Display additional properties - same problem in MathWork's inspect.m
2934 - Enh: Add axis (plot, Graphics) component handles
2935 - Enh: Group callbacks according to the first word (up to 2nd cap letter)
2936 - Enh: Add figure thumbnail image below the java tree (&amp; indicate corresponding jObject when selected)
2937 - Enh: scroll initially-selected node into view (problem because treenode has no pixel location)
2938 - Fix: java exceptions when getting some fields (com.mathworks.mlwidgets.inspector.PropertyRootNode$PropertyListener$1$1.run)
2939 - Fix: use EDT <span class="keyword">if</span> available (especially in <a href="#_sub26" class="code" title="subfunction flashComponent(jComps,delaySecs,numTimes)">flashComponent</a>)
2940 <span class="comment">%}</span></pre></div>
<hr><address>Generated on Thu 07-Aug-2014 13:40:59 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>