<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of getNetfluxParams</title>
  <meta name="keywords" content="getNetfluxParams">
  <meta name="description" content="Extracts the parameters from Netflux Excel file">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">NetfluxSC_09b</a> &gt; <a href="index.html">+util</a> &gt; getNetfluxParams.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for NetfluxSC_09b\+util&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>getNetfluxParams
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>Extracts the parameters from Netflux Excel file</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [paramList, CNAerror] = getNetfluxParams(xlsfilename) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Extracts the parameters from Netflux Excel file

   GETNETFLUXPARAMS also checks the .xlsx file for syntax errors, some of
   which are corrected by assigning default parameters. 

   outputs:
       1) paramList: cell array containing the parameters
       2) CNAerror: cell array containing error messages, if any.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [noparams, w, n, EC50] = mismatchParams(reactionRules,reactionIDs, w, n, EC50)</a></li><li><a href="#_sub2" class="code">function [noSpecParams, y0, ymax, tau] = mismatchSpecParams(specID, y0, ymax, tau)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [paramList, CNAerror] = getNetfluxParams(xlsfilename)</a>
0002 <span class="comment">% Extracts the parameters from Netflux Excel file</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%   GETNETFLUXPARAMS also checks the .xlsx file for syntax errors, some of</span>
0005 <span class="comment">%   which are corrected by assigning default parameters.</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%   outputs:</span>
0008 <span class="comment">%       1) paramList: cell array containing the parameters</span>
0009 <span class="comment">%       2) CNAerror: cell array containing error messages, if any.</span>
0010 <span class="keyword">try</span>
0011     [speciesSheetNum,speciesSheetTxt,raw]=xlsread(xlsfilename,<span class="string">'species'</span>,<span class="string">''</span>,<span class="string">'basic'</span>);
0012     
0013     y0 = raw(3:<span class="keyword">end</span>,4);
0014     ymax = raw(3:<span class="keyword">end</span>,5);
0015     tau = raw(3:<span class="keyword">end</span>,6);
0016     
0017     y0 = cell2mat(y0);
0018     ymax = cell2mat(ymax);
0019     tau = cell2mat(tau);
0020     ymaxTxt = speciesSheetTxt (3:<span class="keyword">end</span>,4);
0021     
0022     [reactionsSheetNum,reactionsSheetTxt,rxnraw]=xlsread(xlsfilename,<span class="string">'reactions'</span>,<span class="string">''</span>,<span class="string">'basic'</span>);
0023     w = rxnraw(3:<span class="keyword">end</span>,4);
0024     n = rxnraw(3:<span class="keyword">end</span>,5);
0025     EC50 = rxnraw(3:<span class="keyword">end</span>,6);
0026     
0027     w = cell2mat(w);
0028     n = cell2mat(n);
0029     EC50 = cell2mat(EC50);
0030          
0031     reactionIDs = reactionsSheetTxt(3:<span class="keyword">end</span>,2);
0032     reactionRules = reactionsSheetTxt(3:<span class="keyword">end</span>,3);
0033     specID = strtrim(speciesSheetTxt(3:<span class="keyword">end</span>,2));
0034     
0035     <span class="comment">% make sure all reactions have parameters. mismatchParams returns the ID</span>
0036     <span class="comment">% and reaction rule strings which do not have corresponding reaction</span>
0037     <span class="comment">% parameters, and sets default parameters to those reactions.</span>
0038 
0039     noparams = <span class="string">''</span>;
0040     [noparams, w, n, EC50] = <a href="#_sub1" class="code" title="subfunction [noparams, w, n, EC50] = mismatchParams(reactionRules,reactionIDs, w, n, EC50)">mismatchParams</a>(reactionRules,reactionIDs, w, n, EC50);
0041 
0042     <span class="comment">% make sure all species have defined parameters, and set default</span>
0043     <span class="comment">% parameters for those that don't.</span>
0044     noSpecParams = <span class="string">''</span>;
0045     [noSpecParams, y0, ymax, tau] = <a href="#_sub2" class="code" title="subfunction [noSpecParams, y0, ymax, tau] = mismatchSpecParams(specID, y0, ymax, tau)">mismatchSpecParams</a>(specID, y0, ymax, tau);
0046     
0047     <span class="comment">% delete parameters that have no corresponding reaction rules.</span>
0048     noValue = cellfun(@isempty, reactionRules);
0049     w(noValue) = [];
0050     n(noValue) = [];
0051     EC50(noValue) = [];
0052     
0053     <span class="comment">% delete parameters that have no corresponding speciesID</span>
0054     noValue = cellfun(@isempty, specID);
0055     y0(noValue) = [];
0056     ymax(noValue) = [];
0057     tau(noValue) = [];
0058     
0059     <span class="comment">% delete cells with no values in them to remove gaps</span>
0060     noValue = cellfun(@isnan, num2cell(w)); <span class="comment">% reaction parameters</span>
0061     w(noValue) = [];
0062     noValue = cellfun(@isnan, num2cell(n));
0063     n(noValue) = [];
0064     noValue = cellfun(@isnan, num2cell(EC50));
0065     EC50(noValue) = [];
0066     
0067     noValue = cellfun(@isnan, num2cell(y0)); <span class="comment">% species parameters</span>
0068     y0(noValue) = [];
0069     noValue = cellfun(@isnan, num2cell(ymax));
0070     ymax(noValue) = [];
0071     noValue = cellfun(@isnan, num2cell(tau));
0072     tau(noValue) = [];
0073     
0074     <span class="comment">% 1) remove reaction and ID from respective lists if reaction rules aren't</span>
0075     <span class="comment">% present, if rules present but no ID, nothing is changed.</span>
0076     <span class="comment">% 2) make sure that all reactions have defined paramaters</span>
0077 
0078     noRules = cellfun(@isempty, reactionRules);
0079     reactionRules(noRules) = [];
0080     reactionIDs(noRules) = [];
0081     specID = strtrim(speciesSheetTxt(3:<span class="keyword">end</span>,2));
0082     
0083     <span class="comment">% delete species with no specID</span>
0084     noValue = cellfun(@isempty,specID);
0085     specID(noValue) = [];
0086     
0087     numspecies = length(specID);
0088    
0089     w = w';
0090     n = n';
0091     EC50 = EC50';    
0092     
0093     [duplicates, numRepeat, ind] = util.repval(specID);
0094     <span class="keyword">for</span> i = 1:length(duplicates)
0095         <span class="keyword">for</span> j = 1:numRepeat(i)
0096             <span class="keyword">if</span> i == 1
0097                 ids{i,j} = ind(j);
0098             <span class="keyword">else</span>
0099                 ids{i,j} = ind(sum(numRepeat(1:i-1)) + j);
0100             <span class="keyword">end</span>
0101         <span class="keyword">end</span>
0102     <span class="keyword">end</span>
0103     DuplicateErrs = {};
0104     <span class="keyword">for</span> i = 1:length(duplicates)
0105         idstr = <span class="string">''</span>;
0106         j = 1;
0107         <span class="keyword">while</span> j &lt;= length(ids(i,:)) &amp;&amp; ~isempty(cell2mat(ids(i,j)))
0108             <span class="keyword">if</span> j &gt; 1
0109                 idstr = sprintf(char(specID(ids{i,j})));
0110             <span class="keyword">else</span>
0111                 idstr = sprintf(char(specID(ids{i,j})));
0112             <span class="keyword">end</span>
0113             j = j+1;
0114         <span class="keyword">end</span>
0115         DuplicateErrs{end+1} = sprintf(idstr);
0116     <span class="keyword">end</span>
0117         
0118     <span class="keyword">if</span> ~isempty(noSpecParams) || ~isempty(noparams)
0119         error(<span class="string">'ParamErr:MissingParams'</span>,<span class="string">'Reaction or species parameters may be missing'</span>);
0120     <span class="keyword">end</span>
0121     
0122     <span class="keyword">if</span> ~isempty(DuplicateErrs)
0123         error(<span class="string">'DuplicateError:DuplicateSpecies'</span>, <span class="string">'Duplicate species detected'</span>);
0124     <span class="keyword">end</span>
0125         CNAerror = [<span class="string">''</span>]; <span class="comment">% if no error, then return empty string in error message</span>
0126 <span class="keyword">catch</span>
0127     disp(<span class="string">'No appropriate parameters supplied, using default parameters'</span>);
0128 
0129     CNAerror = {};
0130     <span class="keyword">if</span> ~isempty(noparams);
0131         CNAerror{end+1} = <span class="string">'Missing parameter(s) for following reactions:'</span>;
0132         CNAerror{end+1} = noparams{:};
0133         CNAerror{end+1} = <span class="string">''</span>;
0134     <span class="keyword">end</span>
0135     <span class="keyword">if</span> ~isempty(noSpecParams);
0136         CNAerror{end+1} = <span class="string">'Missing parameter(s) for following species:'</span>;
0137         CNAerror{end+1} = noSpecParams{:};
0138         CNAerror{end+1} = <span class="string">''</span>;
0139     <span class="keyword">end</span>
0140     <span class="keyword">if</span> ~isempty(DuplicateErrs);
0141         CNAerror{end+1} = <span class="string">'Warning: Duplicate species detected'</span>;
0142         <span class="keyword">for</span> m = 1:length(DuplicateErrs)
0143             CNAerror{end+1} = DuplicateErrs{m};
0144         <span class="keyword">end</span>
0145         CNAerror{end+1} = <span class="string">''</span>;
0146     <span class="keyword">end</span>
0147 <span class="keyword">end</span>
0148 paramList = {w,n,EC50,tau,ymax,y0}; <span class="comment">%parameter list for ODE.m</span>
0149 
0150 <span class="comment">%% Parameter mismatch functions</span>
0151 <a name="_sub1" href="#_subfunctions" class="code">function [noparams, w, n, EC50] = mismatchParams(reactionRules,reactionIDs, w, n, EC50)</a>
0152     <span class="comment">%Returns the reactionID and reaction rule strings that don't have</span>
0153     <span class="comment">%defined parameters, and changes parameters for those reactions to the</span>
0154     <span class="comment">%default values</span>
0155 noparams = {};
0156 ID = {};
0157 <span class="keyword">for</span> i = 1:length(reactionRules)
0158     missing = isnan(n(i)) || isnan(w(i)) || isnan(EC50(i));
0159     <span class="keyword">if</span>~ismember(<span class="string">''</span>,reactionRules(i)) &amp;&amp; missing
0160         noparams(end+1) = reactionRules(i);
0161         ID(end+1) = reactionIDs(i);
0162         noparams(end) = strcat(ID(end),<span class="string">': '</span>,noparams(end));
0163         <span class="comment">% change the parameters to the default for this reaction</span>
0164         w(i) = 1;
0165         n(i) = 1.4;
0166         EC50(i) = .5;
0167     <span class="keyword">end</span>
0168 <span class="keyword">end</span>
0169 <span class="comment">%%</span>
0170 <a name="_sub2" href="#_subfunctions" class="code">function [noSpecParams, y0, ymax, tau] = mismatchSpecParams(specID, y0, ymax, tau)</a>
0171 <span class="comment">% Returns the species IDs that don't have defined parameters and sets the</span>
0172 <span class="comment">% parameters to the default values for those species.</span>
0173 noSpecParams = {};
0174 <span class="keyword">for</span> i = 1:length(specID)
0175     missing = isnan(y0(i)) || isnan(ymax(i)) || isnan(tau(i));
0176     <span class="keyword">if</span> ~ismember(<span class="string">''</span>,specID(i)) &amp;&amp; missing
0177         noSpecParams(end+1) = specID(i);
0178         <span class="comment">% change the parameters to the default for this reaction</span>
0179         y0(i) = 0;
0180         ymax(i) = 1;
0181         tau(i) = 1;
0182     <span class="keyword">end</span>
0183 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 07-Aug-2014 13:40:59 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>