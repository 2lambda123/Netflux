<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of monitor</title>
  <meta name="keywords" content="monitor">
  <meta name="description" content="gui.monitor">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">NetfluxSC_09b</a> &gt; <a href="index.html">+gui</a> &gt; monitor.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for NetfluxSC_09b\+gui&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>monitor
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>gui.monitor</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> gui.monitor          
   A class for monitoring a set of widgets.

   M = gui.monitor(W1,W2,...,Wn) specifies that the widgets W1, W2 ... Wn
     should be monitored for changes to their Value property. There are
     two ways the caller can find out about the changes: 
       * wait until the Value is changed (the waitForInput method), or 
       * specify a function to be called (ValueChangedFcn property).
    All the widgets should be in the same figure  window; if that figure
    is deleted or closed, the monitor object M is  automatically deleted. 

   M = gui.monitor(ARR) takes the cell array ARR as the set of widgets to
     be monitored, i.e., ARR is {W1,W2...,Wn}.

  --------------------------------------------
  NOTE: The monitor method in the gui.autogui class is a
  convenient interface to the gui.monitor class. Use this class explicitly
  if you want to create multiple monitors, or if you need to specify
  timeouts when using waitForInput().
  --------------------------------------------

   Sample usage:
    g = gui.autogui;
    w1 = gui.edittext('Your name');
    w2 = gui.slider('Age in years', [1 100]);
    w3 = gui.slider('Proportion', [0 1]);

    m1 = gui.monitor(w1);      % monitors only w1
    m1.ValueChangedFcn = @(h) disp(['m1 monitor: ' h.Value]); 

    m2 = gui.monitor(w2,w3);   % monitors w2,w3
    while m2.waitForInput()
       disp(m2.LastInput.Value);
    end

    Also see:
    &lt;a href=&quot;matlab:help gui.monitor.LastInput&quot;&gt;LastInput&lt;/a&gt; (property)
    &lt;a href=&quot;matlab:help gui.monitor.ValueChangedFcn&quot;&gt;ValueChangedFcn&lt;/a&gt; (property)
    &lt;a href=&quot;matlab:help gui.monitor.waitForInput&quot;&gt;waitForInput&lt;/a&gt; (method)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="monitor.html" class="code" title="">monitor</a>	gui.monitor</li><li><a href="widget.html" class="code" title="">widget</a>	gui.widget</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="monitor.html" class="code" title="">monitor</a>	gui.monitor</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function obj = monitor(varargin)</a></li><li><a href="#_sub2" class="code">function delete(obj)</a></li><li><a href="#_sub3" class="code">function allOk = waitForInput(obj)</a></li><li><a href="#_sub4" class="code">function set.ValueChangedFcn(obj, f)</a></li><li><a href="#_sub5" class="code">function set.Timeout(obj,t)</a></li><li><a href="#_sub6" class="code">function out = isWaiting(obj)</a></li><li><a href="#_sub7" class="code">function valueChangedCallback(obj,widget)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% gui.monitor</span>
0002 <span class="comment">%   A class for monitoring a set of widgets.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%   M = gui.monitor(W1,W2,...,Wn) specifies that the widgets W1, W2 ... Wn</span>
0005 <span class="comment">%     should be monitored for changes to their Value property. There are</span>
0006 <span class="comment">%     two ways the caller can find out about the changes:</span>
0007 <span class="comment">%       * wait until the Value is changed (the waitForInput method), or</span>
0008 <span class="comment">%       * specify a function to be called (ValueChangedFcn property).</span>
0009 <span class="comment">%    All the widgets should be in the same figure  window; if that figure</span>
0010 <span class="comment">%    is deleted or closed, the monitor object M is  automatically deleted.</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%   M = gui.monitor(ARR) takes the cell array ARR as the set of widgets to</span>
0013 <span class="comment">%     be monitored, i.e., ARR is {W1,W2...,Wn}.</span>
0014 <span class="comment">%</span>
0015 <span class="comment">%  --------------------------------------------</span>
0016 <span class="comment">%  NOTE: The monitor method in the gui.autogui class is a</span>
0017 <span class="comment">%  convenient interface to the gui.monitor class. Use this class explicitly</span>
0018 <span class="comment">%  if you want to create multiple monitors, or if you need to specify</span>
0019 <span class="comment">%  timeouts when using waitForInput().</span>
0020 <span class="comment">%  --------------------------------------------</span>
0021 <span class="comment">%</span>
0022 <span class="comment">%   Sample usage:</span>
0023 <span class="comment">%    g = gui.autogui;</span>
0024 <span class="comment">%    w1 = gui.edittext('Your name');</span>
0025 <span class="comment">%    w2 = gui.slider('Age in years', [1 100]);</span>
0026 <span class="comment">%    w3 = gui.slider('Proportion', [0 1]);</span>
0027 <span class="comment">%</span>
0028 <span class="comment">%    m1 = gui.monitor(w1);      % monitors only w1</span>
0029 <span class="comment">%    m1.ValueChangedFcn = @(h) disp(['m1 monitor: ' h.Value]);</span>
0030 <span class="comment">%</span>
0031 <span class="comment">%    m2 = gui.monitor(w2,w3);   % monitors w2,w3</span>
0032 <span class="comment">%    while m2.waitForInput()</span>
0033 <span class="comment">%       disp(m2.LastInput.Value);</span>
0034 <span class="comment">%    end</span>
0035 <span class="comment">%</span>
0036 <span class="comment">%    Also see:</span>
0037 <span class="comment">%    &lt;a href=&quot;matlab:help gui.monitor.LastInput&quot;&gt;LastInput&lt;/a&gt; (property)</span>
0038 <span class="comment">%    &lt;a href=&quot;matlab:help gui.monitor.ValueChangedFcn&quot;&gt;ValueChangedFcn&lt;/a&gt; (property)</span>
0039 <span class="comment">%    &lt;a href=&quot;matlab:help gui.monitor.waitForInput&quot;&gt;waitForInput&lt;/a&gt; (method)</span>
0040 
0041 <span class="comment">%   Copyright 2009 The MathWorks, Inc.</span>
0042 
0043 classdef (Sealed) <a href="monitor.html" class="code" title="">monitor</a> &lt; handle
0044     
0045     properties(GetAccess=public,SetAccess=private)
0046         <span class="comment">% LastInput</span>
0047         <span class="comment">%   A handle to a widget, used in conjunction with the</span>
0048         <span class="comment">%   waitForInput() method. When waitForInput() returns</span>
0049         <span class="comment">%   successfully, the LastInput property indicates the</span>
0050         <span class="comment">%   widget with the most-recent input activity.</span>
0051         <span class="comment">%</span>
0052         <span class="comment">%   This is a READ-ONLY property.</span>
0053         <span class="comment">%</span>
0054         <span class="comment">%    Also see:</span>
0055         <span class="comment">%    &lt;a href=&quot;matlab:help gui.monitor.ValueChangedFcn&quot;&gt;ValueChangedFcn&lt;/a&gt; (property)</span>
0056         <span class="comment">%    &lt;a href=&quot;matlab:help gui.monitor.waitForInput&quot;&gt;waitForInput&lt;/a&gt; (method)</span>
0057         LastInput = []
0058         
0059         <span class="comment">% WaitTimedOut</span>
0060         <span class="comment">%   A boolean flag.</span>
0061         <span class="comment">%    true =&gt; the most recent waitForInput() timed out</span>
0062         <span class="comment">%    false =&gt; the most recent waitForInput() did not time out</span>
0063         <span class="comment">%   This is a READ-ONLY property.</span>
0064         WaitTimedOut
0065         
0066         <span class="comment">% MonitoredWidget</span>
0067         <span class="comment">%   A cell array of the monitored widgets.</span>
0068         <span class="comment">%   This is a READ-ONLY property.</span>
0069         MonitoredWidgets
0070     <span class="keyword">end</span>
0071     
0072     properties(Access=public)
0073         <span class="comment">% ValueChangedFcn</span>
0074         <span class="comment">%</span>
0075         <span class="comment">%   ValueChangedFcn specifies an optional function handle. This</span>
0076         <span class="comment">%   function is invoked if the Value property is changed in any of</span>
0077         <span class="comment">%   the monitored widgets. The function is invoked with one input</span>
0078         <span class="comment">%   argument (the handle to the widget).</span>
0079         <span class="comment">%</span>
0080         <span class="comment">%   To disable ValueChangedFcn, set it to []</span>
0081         ValueChangedFcn = []
0082         
0083         <span class="comment">% Timeout</span>
0084         <span class="comment">%    The timeout value (in seconds) to be used in conjunction with</span>
0085         <span class="comment">%    the waitForInput() method. By default, Timeout = inf.</span>
0086         <span class="comment">%</span>
0087         <span class="comment">%    The WaitTimedOut property reports whether the most recent</span>
0088         <span class="comment">%    call to waitForInput timed out or not.</span>
0089         <span class="comment">%</span>
0090         <span class="comment">%   Also see:</span>
0091         <span class="comment">%    &lt;a href=&quot;matlab:help gui.monitor.waitForInput&quot;&gt;waitForInput&lt;/a&gt; (method)</span>
0092         Timeout = inf  <span class="comment">% timeout in seconds</span>
0093     <span class="keyword">end</span>
0094     
0095     properties(Access=private)
0096         Listeners
0097         
0098         ParentContainer <span class="comment">% container of all the widgets</span>
0099         ParentFigure   <span class="comment">% HG Figure handle of container</span>
0100         ParentListener <span class="comment">% listener to the ParentContainer</span>
0101         ValueChangedFcnListener        
0102     <span class="keyword">end</span>
0103     
0104     methods
0105         <span class="comment">% conditions to test:</span>
0106         <span class="comment">% x check for repeated widgets</span>
0107         <span class="comment">% x zero arguments to constructor</span>
0108         <span class="comment">% x single cell array arg to constructor</span>
0109         <span class="comment">% x comma-sep list arg to constructor</span>
0110         <span class="comment">% multiple cells as arg to constructor</span>
0111         <span class="comment">% autogui gets deleted during a no-timeout waitForInput</span>
0112         <span class="comment">% autogui gets deleted during a timeout waitForInput</span>
0113         <a name="_sub0" href="#_subfunctions" class="code">function obj = monitor(varargin)</a>
0114             <span class="keyword">if</span> nargin==1 &amp;&amp; iscell(varargin{1})
0115                 widgetList = varargin{1};
0116             <span class="keyword">else</span>
0117                 widgetList = varargin;
0118             <span class="keyword">end</span>
0119             
0120             n = numel(widgetList);
0121             <span class="keyword">if</span> n &lt; 1
0122                 throw(MException(<span class="string">'monitor:InvalidInput'</span>, <span class="string">'Parameters should be one or more handles of type gui.widget'</span>));
0123             <span class="keyword">end</span>
0124             
0125             valid = false(1,n);
0126             fig = zeros(1,n);
0127             parent = num2cell(zeros(1,n));
0128             
0129             <span class="comment">% check validity of widgets</span>
0130             <span class="keyword">for</span> i=1:n
0131                 w = widgetList{i};
0132                 valid(i) = isa(w, <span class="string">'gui.widget'</span>) &amp;&amp; isvalid(w);
0133                 <span class="keyword">if</span> valid(i)
0134                     fig(i) = ancestor(w.Parent.UiHandle, <span class="string">'figure'</span>);
0135                     parent{i} = w.Parent; 
0136                 <span class="keyword">end</span>
0137             <span class="keyword">end</span>            
0138             sameParent = all(cellfun(@(p) p == parent{1}, parent));
0139             <span class="keyword">if</span> ~(all(valid) &amp;&amp; sameParent &amp;&amp; all(fig == fig(1)))
0140                 throw(MException(<span class="string">'monitor:InvalidInput'</span>, <span class="string">'Parameters should be one or more handles of type gui.widget'</span>));
0141             <span class="keyword">end</span>
0142                 
0143             <span class="comment">% remove repetitions in the widgetList</span>
0144             isDuplicate = false(1,n);
0145             <span class="keyword">for</span> i=1:(n-1)
0146                 <span class="keyword">for</span> j=i+1:n
0147                     <span class="keyword">if</span> widgetList{i} == widgetList{j}
0148                         isDuplicate(j) = true;
0149                     <span class="keyword">end</span>
0150                 <span class="keyword">end</span>
0151             <span class="keyword">end</span>
0152             widgetList(isDuplicate) = [];
0153 
0154             <span class="comment">% now set up the listeners</span>
0155             n = numel(widgetList);
0156             obj.Listeners = cell(1,n);            
0157             obj.ParentFigure = fig(1);
0158             obj.ParentContainer = parent{1};
0159             obj.ParentListener = event.listener(obj.ParentContainer, <span class="string">'ObjectBeingDestroyed'</span>, @(src,e) <a href="#_sub2" class="code" title="subfunction delete(obj)">delete</a>(obj));
0160             <span class="keyword">for</span> i=1:n
0161                 e = event.listener(widgetList{i}, <span class="string">'ValueChanged'</span>, @(src,e) <a href="#_sub7" class="code" title="subfunction valueChangedCallback(obj,widget)">valueChangedCallback</a>(obj,src));
0162                 e.Enabled = true;
0163                 e.Recursive = false;
0164                 obj.Listeners{i} = e;
0165             <span class="keyword">end</span>
0166             obj.MonitoredWidgets = widgetList;
0167         <span class="keyword">end</span>
0168 
0169         <a name="_sub1" href="#_subfunctions" class="code">function delete(obj)</a>
0170             <span class="keyword">for</span> i=1:numel(obj.Listeners)
0171                 <span class="keyword">if</span> ~isempty(obj.Listeners{i}) &amp;&amp; isvalid(obj.Listeners{i})
0172                     <a href="#_sub2" class="code" title="subfunction delete(obj)">delete</a>(obj.Listeners{i});
0173                 <span class="keyword">end</span>
0174             <span class="keyword">end</span>
0175             <a href="#_sub2" class="code" title="subfunction delete(obj)">delete</a>(obj.ParentListener);
0176         <span class="keyword">end</span>
0177         
0178         <a name="_sub2" href="#_subfunctions" class="code">function allOk = waitForInput(obj)</a>
0179             
0180             <span class="comment">% waitForInput            gui.monitor method</span>
0181             <span class="comment">%</span>
0182             <span class="comment">%   allOk = obj.waitForInput() waits for changes to the</span>
0183             <span class="comment">%   Value property in any of the monitored widgets .</span>
0184             <span class="comment">%</span>
0185             <span class="comment">%     allOk is true =&gt; there was a change (and the</span>
0186             <span class="comment">%     corresponding widget is given by the LastInput property)</span>
0187             <span class="comment">%     or the wait timed out (and WaitTimedOut is true).</span>
0188             <span class="comment">%</span>
0189             <span class="comment">%     allOk is false =&gt; the gui was closed or deleted in the</span>
0190             <span class="comment">%     meantime. The LastInput property is undefined.</span>
0191             <span class="comment">%</span>
0192             <span class="comment">%    Also see:</span>
0193             <span class="comment">%    &lt;a href=&quot;matlab:help gui.monitor.WaitTimedOut&quot;&gt;WaitTimedOut&lt;/a&gt; (property)</span>
0194             <span class="comment">%    &lt;a href=&quot;matlab:help gui.monitor.LastInput&quot;&gt;LastInput&lt;/a&gt; (property)</span>
0195 
0196             
0197             <span class="comment">% Potential race condition: after the obj.WaitTimedOut</span>
0198             <span class="comment">% assignment &amp; before the uiwait kicks in, the callback happens</span>
0199             <span class="comment">% to get invoked, so we enter the waitstate with</span>
0200             <span class="comment">% obj.WaitTimedOut==false. When uiwait returns, we have no</span>
0201             <span class="comment">% way of determining whether there was an actual timeout.</span>
0202             <span class="comment">%</span>
0203             <span class="comment">% Two possibilities: (1) there is an input during the wait, so</span>
0204             <span class="comment">% obj.WaitTimedout==false is the desired state anyway.</span>
0205             <span class="comment">% (2) there is no input during the wait, so obj.WaitTimedout</span>
0206             <span class="comment">% should be true. However, there really was an input just</span>
0207             <span class="comment">% before uiwait kicked in and obj.LastInput will be valid, so</span>
0208             <span class="comment">% the external behavior will be consistent.</span>
0209             <span class="comment">%</span>
0210             <span class="comment">% Conclusion: Leave the race condition alone.</span>
0211         
0212             obj.WaitTimedOut = true;            
0213             
0214             <span class="keyword">if</span> isinf(obj.Timeout)
0215                 uiwait(obj.ParentFigure);
0216             <span class="keyword">else</span>
0217                 uiwait(obj.ParentFigure, obj.Timeout);
0218             <span class="keyword">end</span>                                    
0219             
0220             <span class="comment">% figure got deleted and this object got deleted as well</span>
0221             allOk = isvalid(obj) &amp;&amp; isvalid(obj.ParentContainer);            
0222         <span class="keyword">end</span>
0223 
0224         <a name="_sub3" href="#_subfunctions" class="code">function set.ValueChangedFcn(obj, f)</a>
0225             <span class="keyword">if</span> isa(f, <span class="string">'function_handle'</span>) || isempty(f)
0226                 obj.ValueChangedFcn = f;
0227             <span class="keyword">else</span>
0228                 throw(MException(<span class="string">'monitor:ValueChangedFcn'</span>, <span class="string">'ValueChangedFcn should be a function handle'</span>));
0229             <span class="keyword">end</span>
0230         <span class="keyword">end</span>
0231 
0232         <a name="_sub4" href="#_subfunctions" class="code">function set.Timeout(obj,t)</a>
0233             <span class="keyword">if</span> ~(isnumeric(t) &amp;&amp; isscalar(t) &amp;&amp; isreal(t) &amp;&amp; t&gt;0)
0234                 throw(MException(<span class="string">'monitor:InvalidTimeout'</span>, <span class="string">'Timeout should be a positive number or Inf'</span>));
0235             <span class="keyword">end</span>
0236             obj.Timeout = round(t);
0237         <span class="keyword">end</span>
0238         
0239         <a name="_sub5" href="#_subfunctions" class="code">function out = isWaiting(obj)</a>
0240             out = strcmp( get(obj.ParentFigure, <span class="string">'waitstatus'</span>), <span class="string">'waiting'</span> );
0241         <span class="keyword">end</span>
0242         
0243     <span class="keyword">end</span>
0244 
0245     methods(Hidden)
0246         <span class="comment">% Note: this function is can be called asynchronously, so it has</span>
0247         <span class="comment">% the potential to modify instance variables that another method is</span>
0248         <span class="comment">% currently manipulating (and expecting to stay constant!).</span>
0249         <a name="_sub6" href="#_subfunctions" class="code">function valueChangedCallback(obj,widget)</a>
0250             obj.LastInput = <a href="widget.html" class="code" title="">widget</a>;
0251             obj.WaitTimedOut = false;
0252             
0253             <span class="keyword">if</span> ~isempty(obj.ValueChangedFcn)
0254                 feval(obj.ValueChangedFcn, <a href="widget.html" class="code" title="">widget</a>);
0255             <span class="keyword">end</span>
0256 
0257             uiresume(obj.ParentFigure);            
0258         <span class="keyword">end</span>
0259     <span class="keyword">end</span>
0260     
0261 <span class="keyword">end</span>
0262</pre></div>
<hr><address>Generated on Thu 07-Aug-2014 13:40:59 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>